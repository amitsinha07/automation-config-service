meta:
  domain: ONDC:RETeB2B
  version: 1.2.5
  flowId: Merchant_Side_RTO_and_Part_Order_Cancellation_Flow
transaction_data:
  transaction_id: 6db7d975-88a0-45f1-9c32-07c21547d7da
  latest_timestamp: 1970-01-01T00:00:00.000Z
  bap_id: sample-bap-id
  bap_uri: https://bap.example.com
  bpp_id: sample-bpp-id
  bpp_uri: https://bpp.example.com
steps:
  - api: select
    action_id: select
    owner: BAP
    responseFor: null
    unsolicited: false
    description: First Select where items are selected
    mock:
      generate: LyoqCiAqIEdlbmVyYXRlcyB0aGUgbW9jayBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgY3VzdG9taXphdGlvbiBvZiB0aGUgZGVmYXVsdCBwYXlsb2FkIHVzaW5nIHNlc3Npb24gZGF0YQogKiBmcm9tIHByZXZpb3VzIHN0ZXBzIGFuZCB1c2VyIGlucHV0cy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSBkZWZhdWx0UGF5bG9hZCAtIFRoZSBiYXNlIHBheWxvYWQgb2JqZWN0IHdpdGggY29udGV4dCBhbHJlYWR5IHBvcHVsYXRlZC4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhLnVzZXJfaW5wdXRzIC0gVXNlci1wcm92aWRlZCBpbnB1dCB2YWx1ZXMgZm9yIHRoaXMgc3RlcC4KICogQHBhcmFtIHsqfSBzZXNzaW9uRGF0YS5ba2V5XSAtIEFueSBzYXZlZCBkYXRhIGZyb20gcHJldmlvdXMgc3RlcHMgKGRlZmluZWQgaW4gc2F2ZURhdGEgY29uZmlnKS4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBnZW5lcmF0ZWQgcGF5bG9hZCBvYmplY3QgdG8gYmUgc2VudCBpbiB0aGUgQVBJIHJlcXVlc3QuCiAqLwphc3luYyBmdW5jdGlvbiBnZW5lcmF0ZShkZWZhdWx0UGF5bG9hZCwgc2Vzc2lvbkRhdGEpIHsKCWNvbnN0IGlucHV0cyA9IHNlc3Npb25EYXRhLnVzZXJfaW5wdXRzOwoJaWYgKCFpbnB1dHMpIHJldHVybiBkZWZhdWx0UGF5bG9hZDsKCWlmIChpbnB1dHMucHJvdmlkZXIpIHsKCQlkZWZhdWx0UGF5bG9hZC5tZXNzYWdlLm9yZGVyLnByb3ZpZGVyLmlkID0gaW5wdXRzLnByb3ZpZGVyOwoJfQoJaWYgKGlucHV0cy5wcm92aWRlcl9sb2NhdGlvbiAmJiBBcnJheS5pc0FycmF5KGlucHV0cy5wcm92aWRlcl9sb2NhdGlvbikpIHsKCQlkZWZhdWx0UGF5bG9hZC5tZXNzYWdlLm9yZGVyLnByb3ZpZGVyLmxvY2F0aW9ucyA9CgkJCWlucHV0cy5wcm92aWRlcl9sb2NhdGlvbi5tYXAoKGxvY2F0aW9uKSA9PiB7CgkJCQlyZXR1cm4gewoJCQkJCWlkOiBsb2NhdGlvbiwKCQkJCX07CgkJCX0pOwoJfSBlbHNlIGlmICgKCQlpbnB1dHMucHJvdmlkZXJfbG9jYXRpb24gJiYKCQl0eXBlb2YgaW5wdXRzLnByb3ZpZGVyX2xvY2F0aW9uID09PSAic3RyaW5nIgoJKSB7CgkJZGVmYXVsdFBheWxvYWQubWVzc2FnZS5vcmRlci5wcm92aWRlci5sb2NhdGlvbnMgPSBbCgkJCXsKCQkJCWlkOiBpbnB1dHMucHJvdmlkZXJfbG9jYXRpb24sCgkJCX0sCgkJXTsKCX0KCWlmIChpbnB1dHMubG9jYXRpb25fZ3BzKSB7CgkJZGVmYXVsdFBheWxvYWQubWVzc2FnZS5vcmRlci5mdWxmaWxsbWVudHNbMF0uZW5kLmxvY2F0aW9uLmdwcyA9CgkJCWlucHV0cy5sb2NhdGlvbl9ncHM7Cgl9CglpZiAoaW5wdXRzLmxvY2F0aW9uX3Bpbl9jb2RlKSB7CgkJZGVmYXVsdFBheWxvYWQubWVzc2FnZS5vcmRlci5mdWxmaWxsbWVudHNbMF0uZW5kLmxvY2F0aW9uLmFkZHJlc3MuYXJlYV9jb2RlID0KCQkJaW5wdXRzLmxvY2F0aW9uX3Bpbl9jb2RlOwoJCWRlZmF1bHRQYXlsb2FkLmNvbnRleHQuY2l0eSA9IHNlc3Npb25EYXRhLnVzZXJfaW5wdXRzLmNpdHlfY29kZTsKCX0KCWlmIChpbnB1dHMuaXRlbXMpIHsKCQlkZWZhdWx0UGF5bG9hZC5tZXNzYWdlLm9yZGVyLml0ZW1zID0gaW5wdXRzLml0ZW1zLm1hcCgoaXRlbSkgPT4gewoJCQlyZXR1cm4gewoJCQkJaWQ6IGl0ZW0uaXRlbUlkLAoJCQkJcXVhbnRpdHk6IHsKCQkJCQljb3VudDogaXRlbS5xdWFudGl0eSwKCQkJCX0sCgkJCQlsb2NhdGlvbjogaXRlbS5sb2NhdGlvbiwKCQkJfTsKCQl9KTsKCX0KCWNvbnN0IGlucHV0S2V5cyA9IE9iamVjdC5rZXlzKGlucHV0cyk7Cgljb25zdCBvZmZlcnMgPSBpbnB1dEtleXMuZmlsdGVyKChrKSA9PiBrLnN0YXJ0c1dpdGgoIm9mZmVyc18iKSk7CglpZiAob2ZmZXJzLmxlbmd0aCA+IDApIHsKCQlkZWZhdWx0UGF5bG9hZC5tZXNzYWdlLm9yZGVyLm9mZmVycyA9IG9mZmVycwoJCQkuZmlsdGVyKChvZmZlcikgPT4gaW5wdXRzW29mZmVyXSAhPT0gZmFsc2UgJiYgaW5wdXRzW29mZmVyXSAhPT0gbnVsbCkKCQkJLm1hcCgob2ZmZXIpID0+IHsKCQkJCXJldHVybiB7CgkJCQkJaWQ6IG9mZmVyLnJlcGxhY2UoIm9mZmVyc18iLCAiIiksCgkJCQkJLy8gdGFnczogWwoJCQkJCS8vIAl7CgkJCQkJLy8gCQljb2RlOiAic2VsZWN0aW9uIiwKCQkJCQkvLyAJCWxpc3Q6IFsKCQkJCQkvLyAJCQl7CgkJCQkJLy8gCQkJCWNvZGU6ICJhcHBseSIsCgkJCQkJLy8gCQkJCXZhbHVlOiAieWVzIiwKCQkJCQkvLyAJCQl9LAoJCQkJCS8vIAkJXSwKCQkJCQkvLyAJfSwKCQkJCQkvLyBdLAoJCQkJfTsKCQkJfSk7Cgl9CglyZXR1cm4gZGVmYXVsdFBheWxvYWQ7Cn0=
      validate: LyoqCiAqIFZhbGlkYXRlcyB0aGUgaW5jb21pbmcgcmVxdWVzdCBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXRQYXlsb2FkIC0gVGhlIGluY29taW5nIHJlcXVlc3QgcGF5bG9hZCB0byB2YWxpZGF0ZS4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiB2YWxpZGF0ZSh0YXJnZXRQYXlsb2FkLCBzZXNzaW9uRGF0YSkgewogIHJldHVybiB7IHZhbGlkOiB0cnVlLCBjb2RlOiAyMDAsIGRlc2NyaXB0aW9uOiAiVmFsaWQgcmVxdWVzdCIgfTsKfQ==
      requirements: LyoqCiAqIENoZWNrcyBpZiB0aGUgcmVxdWlyZW1lbnRzIGZvciBwcm9jZWVkaW5nIHdpdGggdGhlIEFQSSBjYWxsIGFyZSBtZXQuCiAqIAogKiBAcGFyYW0ge09iamVjdH0gc2Vzc2lvbkRhdGEgLSBEYXRhIGNvbGxlY3RlZCBmcm9tIHByZXZpb3VzIHRyYW5zYWN0aW9uIHN0ZXBzLgogKiAKICogQHJldHVybnMge09iamVjdH0geyB2YWxpZDogYm9vbGVhbiwgY29kZTogbnVtYmVyLCBkZXNjcmlwdGlvbjogc3RyaW5nIH0KICovCmZ1bmN0aW9uIG1lZXRzUmVxdWlyZW1lbnRzKHNlc3Npb25EYXRhKSB7CiAgcmV0dXJuIHsgdmFsaWQ6IHRydWUsIGNvZGU6IDIwMCwgZGVzY3JpcHRpb246ICJSZXF1aXJlbWVudHMgbWV0IiB9Owp9
      defaultPayload:
        context:
          action: select
          bap_id: dev-automation.ondc.org
          bap_uri: https://dev-automation.ondc.org/api-service/ONDC:RETeB2B/1.2.5/buyer
          bpp_id: dev-automation.ondc.org
          bpp_uri: https://dev-automation.ondc.org/api-service/ONDC:RETeB2B/1.2.5/seller
          city: std:011
          core_version: 1.2.5
          country: IND
          domain: ONDC:RETeB2B
          message_id: 7d0a1e43-ea5c-4d35-bb63-91451ef8ac0c
          timestamp: 2026-02-23T15:01:33.607Z
          transaction_id: 0ca8ea50-19af-457f-9dfc-76d8c7d04677
          ttl: PT30S
        message:
          order:
            provider:
              id: P1
              locations:
                - id: L1
            items:
              - id: I1
                location_id: L1
                quantity:
                  count: 1
            fulfillments:
              - type: Delivery
                customer:
                  id: CUST_001
                  organization:
                    descriptor:
                      name: Sharma Kirana Store
                  person:
                    creds:
                      - id: 29AABCU9603R1ZM
                        type: GSTIN
                      - id: AABCU9603R
                        type: PAN
                end:
                  location:
                    gps: 19.129076,72.825803
                    address:
                      area_code: "400053"
      saveData:
        bapId: $.context.bap_id
        message_id: $.context.message_id
        selected_items: $.message.order.items[*]
        payload_city: $.context.city
        selected_fulfillments: $.message.order.fulfillments[*]
        selected_offers: $.message.order.offers[*]
        provider: $.message.order.provider
        RET10Catalog: EVAL#ZnVuY3Rpb24gZ2V0U2F2ZShlKXtyZXR1cm57Y2F0YWxvZzp7ImJwcC9mdWxmaWxsbWVudHMiOlt7aWQ6IkYxIix0eXBlOiJEZWxpdmVyeSJ9LHtpZDoiRjIiLHR5cGU6IlNlbGYtUGlja3VwIn0se2lkOiJGMzI4MjIiLHR5cGU6IkJ1eWVyLURlbGl2ZXJ5In0sXSwiYnBwL2Rlc2NyaXB0b3IiOntuYW1lOiJNb2NrIFNlbGxlciBOUCIsc3ltYm9sOiJodHRwczovL3NlbGxlck5QLmNvbS9pbWFnZXMvbnAucG5nIixzaG9ydF9kZXNjOiJTZWxsZXIgTWFya2V0cGxhY2UiLGxvbmdfZGVzYzoiU2VsbGVyIE1hcmtldHBsYWNlIixpbWFnZXM6WyJodHRwczovL3NlbGxlck5QLmNvbS9pbWFnZXMvbnAucG5nIl0sdGFnczpbe2NvZGU6ImJwcF90ZXJtcyIsbGlzdDpbe2NvZGU6Im5wX3R5cGUiLHZhbHVlOiJNU04ifSxdfSxdfSwiYnBwL3Byb3ZpZGVycyI6W3t0aW1lOntsYWJlbDoiZW5hYmxlIix0aW1lc3RhbXA6IjIwMjQtMTItMjNUMDY6NTU6NDUuMDM1WiJ9LHJhdGluZzoiNCIsZGVzY3JpcHRvcjp7bmFtZToiU3RvcmUgMSIsc3ltYm9sOiJodHRwczovL3NlbGxlck5QLmNvbS9pbWFnZXMvc3RvcmUxLnBuZyIsc2hvcnRfZGVzYzoiU3RvcmUgMSIsbG9uZ19kZXNjOiJTdG9yZSAxIixpbWFnZXM6WyJodHRwczovL3NlbGxlck5QLmNvbS9pbWFnZXMvc3RvcmUxLnBuZyJdfSx0dGw6IlAxRCIsbG9jYXRpb25zOlt7aWQ6IkwxIix0aW1lOntsYWJlbDoiZW5hYmxlIix0aW1lc3RhbXA6IjIwMjQtMTItMjNUMDY6NTU6NDUuMDM1WiIsZGF5czoiMSwyLDMsNCw1LDYsNyIsc2NoZWR1bGU6e2hvbGlkYXlzOltdfSxyYW5nZTp7c3RhcnQ6IjAwMDAiLGVuZDoiMjM1OSJ9fSxncHM6IjE5LjEyOTA3Niw3Mi44MjU4MDMiLGFkZHJlc3M6e3N0cmVldDoiMSAmIDIsQU1BUiBKWU9USSBDSFMuQkxERy4sT1BQLk5BTkQgS1JJUEEgSEFMTCIsbG9jYWxpdHk6IkFOREhFUkkgRk9VUiBCVU5HTE9XIEFNQVIgSllPVEkgQ0hTIixjaXR5OiJtb2NrLXNlbGxlci1jaXR5IixzdGF0ZToibW9jay1zdGF0ZSIsYXJlYV9jb2RlOiI0MDAwNTMifSxjaXJjbGU6e2dwczoiMTkuMTI5MDc2LDcyLjgyNTgwMyIscmFkaXVzOnt1bml0OiJrbSIsdmFsdWU6IjMifX19LF0sZnVsZmlsbG1lbnRzOlt7aWQ6IkYxIix0eXBlOiJEZWxpdmVyeSIsY29udGFjdDp7cGhvbmU6Ijk1OTQ2NjM3MTAiLGVtYWlsOiJub2JvZHlAbm9tYWlsLmNvbSJ9fSx7aWQ6IkYyIix0eXBlOiJTZWxmLVBpY2t1cCIsY29udGFjdDp7cGhvbmU6Ijk1OTQ2NjM5OTkiLGVtYWlsOiJtb2NrQG5vbWFpbC5jb20ifX0se2lkOiJGMzI4MjIiLHR5cGU6IkJ1eWVyLURlbGl2ZXJ5Iixjb250YWN0OntwaG9uZToiOTU5NDY2Mzg4OCIsZW1haWw6Im1vY2syQG5vbWFpbC5jb20ifX0sXSxpdGVtczpbe2Rlc2NyaXB0b3I6e25hbWU6IlBsYWluIEF0dGEiLGNvZGU6IjE6OTc4MDIwMTM3OTYyIixzeW1ib2w6Imh0dHBzOi8vc2VsbGVyTlAuY29tL2ltYWdlcy9pMS5wbmciLHNob3J0X2Rlc2M6IlBsYWluIEF0dGEiLGxvbmdfZGVzYzoiUGxhaW4gQXR0YSIsaW1hZ2VzOlsiaHR0cHM6Ly9zZWxsZXJOUC5jb20vaW1hZ2VzL2kxLnBuZyJdfSxyYXRpbmc6IjQuMCIscHJpY2U6e2N1cnJlbmN5OiJJTlIiLHZhbHVlOiIyMDAuMDAiLG1heGltdW1fdmFsdWU6IjIwMC4wMCJ9LHF1YW50aXR5Ont1bml0aXplZDp7bWVhc3VyZTp7dW5pdDoia2lsb2dyYW0iLHZhbHVlOiIzIn19LGF2YWlsYWJsZTp7Y291bnQ6Ijk5In0sbWF4aW11bTp7Y291bnQ6Ijk5In19LGNhdGVnb3J5X2lkOiJBdHRhLCBGbG91cnMgYW5kIFNvb2ppIixmdWxmaWxsbWVudF9pZDoiRjEiLGxvY2F0aW9uX2lkOiJMMSIsIkBvbmRjL29yZy9yZXR1cm5hYmxlIjohMCwiQG9uZGMvb3JnL2NhbmNlbGxhYmxlIjohMCwiQG9uZGMvb3JnL3JldHVybl93aW5kb3ciOiJQN0QiLCJAb25kYy9vcmcvc2VsbGVyX3BpY2t1cF9yZXR1cm4iOiExLCJAb25kYy9vcmcvdGltZV90b19zaGlwIjoiUFQ1TSIsIkBvbmRjL29yZy9hdmFpbGFibGVfb25fY29kIjohMCwiQG9uZGMvb3JnL2NvbnRhY3RfZGV0YWlsc19jb25zdW1lcl9jYXJlIjoiUmFtZXNoLHJhbWVzaEBhYmMuY29tLDE4MDA0MjU0NDQ0IiwiQG9uZGMvb3JnL3N0YXR1dG9yeV9yZXFzX3BhY2thZ2VkX2NvbW1vZGl0aWVzIjp7bWFudWZhY3R1cmVyX29yX3BhY2tlcl9uYW1lOiJJVEMiLG1hbnVmYWN0dXJlcl9vcl9wYWNrZXJfYWRkcmVzczoiSVRDIFF1YWxpdHkgQ2FyZSBDZWxsLFAuTyBCb3ggTm8uNTkyLEJhbmdhbG9yZS01NjAwMDUiLGNvbW1vbl9vcl9nZW5lcmljX25hbWVfb2ZfY29tbW9kaXR5OiJBc2hpcndhZCBBdHRhIixtb250aF95ZWFyX29mX21hbnVmYWN0dXJlX3BhY2tpbmdfaW1wb3J0OiIwMS8yMDIzIn0sdGltZTp7bGFiZWw6ImVuYWJsZSIsdGltZXN0YW1wOiIyMDI0LTEyLTIzVDA2OjU1OjQ1LjAzNVoifSx0YWdzOlt7Y29kZToib3JpZ2luIixsaXN0Olt7Y29kZToiY291bnRyeSIsdmFsdWU6IklORCJ9LF19LF0saWQ6IkkxIixwYXJlbnRfaXRlbV9pZDoiVjEifSx7ZGVzY3JpcHRvcjp7bmFtZToiUGxhaW4gQXR0YSIsY29kZToiMTo0NzQxMzE4MTkxODk0IixzeW1ib2w6Imh0dHBzOi8vc2VsbGVyTlAuY29tL2ltYWdlcy9pMS5wbmciLHNob3J0X2Rlc2M6IlBsYWluIEF0dGEiLGxvbmdfZGVzYzoiUGxhaW4gQXR0YSIsaW1hZ2VzOlsiaHR0cHM6Ly9zZWxsZXJOUC5jb20vaW1hZ2VzL2kxLnBuZyJdfSxyYXRpbmc6IjMuMCIscHJpY2U6e2N1cnJlbmN5OiJJTlIiLHZhbHVlOiIzMDAuMDAiLG1heGltdW1fdmFsdWU6IjMwMC4wMCJ9LHF1YW50aXR5Ont1bml0aXplZDp7bWVhc3VyZTp7dW5pdDoia2lsb2dyYW0iLHZhbHVlOiI1In19LGF2YWlsYWJsZTp7Y291bnQ6Ijk5In0sbWF4aW11bTp7Y291bnQ6Ijk5In19LGNhdGVnb3J5X2lkOiJBdHRhLCBGbG91cnMgYW5kIFNvb2ppIixmdWxmaWxsbWVudF9pZDoiRjEiLGxvY2F0aW9uX2lkOiJMMSIsIkBvbmRjL29yZy9yZXR1cm5hYmxlIjohMCwiQG9uZGMvb3JnL2NhbmNlbGxhYmxlIjohMCwiQG9uZGMvb3JnL3JldHVybl93aW5kb3ciOiJQN0QiLCJAb25kYy9vcmcvc2VsbGVyX3BpY2t1cF9yZXR1cm4iOiExLCJAb25kYy9vcmcvdGltZV90b19zaGlwIjoiUFQ1TSIsIkBvbmRjL29yZy9hdmFpbGFibGVfb25fY29kIjohMCwiQG9uZGMvb3JnL2NvbnRhY3RfZGV0YWlsc19jb25zdW1lcl9jYXJlIjoiUmFtZXNoLHJhbWVzaEBhYmMuY29tLDE4MDA0MjU0NDQ0IiwiQG9uZGMvb3JnL3N0YXR1dG9yeV9yZXFzX3BhY2thZ2VkX2NvbW1vZGl0aWVzIjp7bWFudWZhY3R1cmVyX29yX3BhY2tlcl9uYW1lOiJJVEMiLG1hbnVmYWN0dXJlcl9vcl9wYWNrZXJfYWRkcmVzczoiSVRDIFF1YWxpdHkgQ2FyZSBDZWxsLFAuTyBCb3ggTm8uNTkyLEJhbmdhbG9yZS01NjAwMDUiLGNvbW1vbl9vcl9nZW5lcmljX25hbWVfb2ZfY29tbW9kaXR5OiJBc2hpcndhZCBBdHRhIixtb250aF95ZWFyX29mX21hbnVmYWN0dXJlX3BhY2tpbmdfaW1wb3J0OiIwMS8yMDIzIn0sdGltZTp7bGFiZWw6ImVuYWJsZSIsdGltZXN0YW1wOiIyMDI0LTEyLTIzVDA2OjU1OjQ1LjAzNVoifSx0YWdzOlt7Y29kZToib3JpZ2luIixsaXN0Olt7Y29kZToiY291bnRyeSIsdmFsdWU6IklORCJ9LF19LF0saWQ6IkkyIixwYXJlbnRfaXRlbV9pZDoiVjEifSx7ZGVzY3JpcHRvcjp7bmFtZToiQWxwaGFuc28gTWFuZ28iLGNvZGU6IjE6NzM5NjM3Mzk3NTk1NyIsc3ltYm9sOiJodHRwczovL3NlbGxlck5QLmNvbS9pbWFnZXMvaTEucG5nIixzaG9ydF9kZXNjOiJBbHBoYW5zbyIsbG9uZ19kZXNjOiJBbHBoYW5zbyBNYW5nbyBmcmVzaGx5IGhhbmQgcGlja2VkIixpbWFnZXM6WyJodHRwczovL3NlbGxlck5QLmNvbS9pbWFnZXMvaTEucG5nIl19LHJhdGluZzoiMy4wIixwcmljZTp7Y3VycmVuY3k6IklOUiIsdmFsdWU6IjI1MC4wMCIsbWF4aW11bV92YWx1ZToiMjUwLjAwIn0scXVhbnRpdHk6e3VuaXRpemVkOnttZWFzdXJlOnt1bml0OiJraWxvZ3JhbSIsdmFsdWU6IjEifX0sYXZhaWxhYmxlOntjb3VudDoiOTkifSxtYXhpbXVtOntjb3VudDoiOTkifX0sY2F0ZWdvcnlfaWQ6IkZydWl0cyBhbmQgVmVnZXRhYmxlcyIsZnVsZmlsbG1lbnRfaWQ6IkYxIixsb2NhdGlvbl9pZDoiTDEiLCJAb25kYy9vcmcvcmV0dXJuYWJsZSI6ITEsIkBvbmRjL29yZy9jYW5jZWxsYWJsZSI6ITEsIkBvbmRjL29yZy9yZXR1cm5fd2luZG93IjoiUDFEIiwiQG9uZGMvb3JnL3NlbGxlcl9waWNrdXBfcmV0dXJuIjohMSwiQG9uZGMvb3JnL3RpbWVfdG9fc2hpcCI6IlBUNU0iLCJAb25kYy9vcmcvYXZhaWxhYmxlX29uX2NvZCI6ITAsIkBvbmRjL29yZy9jb250YWN0X2RldGFpbHNfY29uc3VtZXJfY2FyZSI6IlJhbWVzaCxyYW1lc2hAYWJjLmNvbSwxODAwNDI1NDQ0NCIsdGltZTp7bGFiZWw6ImVuYWJsZSIsdGltZXN0YW1wOiIyMDI0LTEyLTIzVDA2OjU1OjQ1LjAzNVoifSx0YWdzOlt7Y29kZToib3JpZ2luIixsaXN0Olt7Y29kZToiY291bnRyeSIsdmFsdWU6IklORCJ9LF19LF0saWQ6IkkzIn0sXSx0YWdzOlt7Y29kZToidGltaW5nIixsaXN0Olt7Y29kZToidHlwZSIsdmFsdWU6IkFsbCJ9LHtjb2RlOiJsb2NhdGlvbiIsdmFsdWU6IkwxIn0se2NvZGU6ImRheV9mcm9tIix2YWx1ZToiMSJ9LHtjb2RlOiJkYXlfdG8iLHZhbHVlOiI3In0se2NvZGU6InRpbWVfZnJvbSIsdmFsdWU6IjAwMDAifSx7Y29kZToidGltZV90byIsdmFsdWU6IjIzNTkifSxdfSx7Y29kZToic2VydmljZWFiaWxpdHkiLGxpc3Q6W3tjb2RlOiJsb2NhdGlvbiIsdmFsdWU6IkwxIn0se2NvZGU6ImNhdGVnb3J5Iix2YWx1ZToiQXR0YSwgRmxvdXJzIGFuZCBTb29qaSJ9LHtjb2RlOiJ0eXBlIix2YWx1ZToiMTEifSx7Y29kZToidW5pdCIsdmFsdWU6InBpbmNvZGUifSx7Y29kZToidmFsIix2YWx1ZToiNTYwMDAxLTU2MDA3Niw1NjAwODMifSxdfSx7Y29kZToic2VydmljZWFiaWxpdHkiLGxpc3Q6W3tjb2RlOiJsb2NhdGlvbiIsdmFsdWU6IkwxIn0se2NvZGU6ImNhdGVnb3J5Iix2YWx1ZToiRnJ1aXRzIGFuZCBWZWdldGFibGVzIn0se2NvZGU6InR5cGUiLHZhbHVlOiIxMCJ9LHtjb2RlOiJ2YWwiLHZhbHVlOiIzIn0se2NvZGU6InVuaXQiLHZhbHVlOiJrbSJ9LF19LF0sY2F0ZWdvcmllczpbe2lkOiJWMSIsdGFnczpbe2NvZGU6InR5cGUiLGxpc3Q6W3tjb2RlOiJ0eXBlIix2YWx1ZToidmFyaWFudF9ncm91cCJ9LF19LHtjb2RlOiJhdHRyIixsaXN0Olt7Y29kZToibmFtZSIsdmFsdWU6Iml0ZW0ucXVhbnRpdHkudW5pdGl6ZWQubWVhc3VyZSJ9LHtjb2RlOiJzZXEiLHZhbHVlOiIxIn0sXX0sXSxkZXNjcmlwdG9yOntuYW1lOiJQbGFpbiBBdHRhIn19LF0saWQ6IlAxIixvZmZlcnM6W3tpZDoiRkxBVDUwIixkZXNjcmlwdG9yOntjb2RlOiJkaXNjb3VudCIsaW1hZ2VzOlsiaHR0cHM6Ly9zZWxsZXJOUC5jb20vaW1hZ2VzL29mZmVyMi1iYW5uZXIucG5nIl19LGxvY2F0aW9uX2lkczpbIkwxIl0saXRlbV9pZHM6WyJJMSIsIkkyIiwiSTMiXSx0aW1lOntsYWJlbDoidmFsaWQiLHJhbmdlOntzdGFydDoiMjAyNC0xMi0yM1QwNjo1NTo0NS4wMzVaIixlbmQ6IjIwMzAtMTItMjNUMDg6MTI6MTUuMDMzWiJ9fSx0YWdzOlt7Y29kZToicXVhbGlmaWVyIixsaXN0Olt7Y29kZToibWluX3ZhbHVlIix2YWx1ZToiMTAwLjAwIn0sXX0se2NvZGU6ImJlbmVmaXQiLGxpc3Q6W3tjb2RlOiJ2YWx1ZV90eXBlIix2YWx1ZToiYW1vdW50In0se2NvZGU6InZhbHVlIix2YWx1ZToiLTUwLjAwIn0sXX0se2NvZGU6Im1ldGEiLGxpc3Q6W3tjb2RlOiJhZGRpdGl2ZSIsdmFsdWU6Im5vIn0se2NvZGU6ImF1dG8iLHZhbHVlOiJubyJ9LF19LF19LHtpZDoiYnV5MmdldDMiLGRlc2NyaXB0b3I6e2NvZGU6ImJ1eVhnZXRZIixpbWFnZXM6WyJodHRwczovL3NucC5jb20vaW1hZ2VzL29mZmVyMS1iYW5uZXIud2VicCJdfSxsb2NhdGlvbl9pZHM6WyJMMSJdLGNhdGVnb3J5X2lkczpbXSxpdGVtX2lkczpbIkkxIiwiSTIiLCJJMyJdLHRpbWU6e2xhYmVsOiJ2YWxpZCIscmFuZ2U6e3N0YXJ0OiIyMDI1LTAxLTAxVDE2OjAwOjAwLjAwMFoiLGVuZDoiMjAzMC0wMS0wMVQyMzowMDowMC4wMDBaIn19LHRhZ3M6W3tjb2RlOiJxdWFsaWZpZXIiLGxpc3Q6W3tjb2RlOiJpdGVtX2NvdW50Iix2YWx1ZToiMiJ9LF19LHtjb2RlOiJiZW5lZml0IixsaXN0Olt7Y29kZToiaXRlbV9jb3VudCIsdmFsdWU6IjEifSx7Y29kZToiaXRlbV9pZCIsdmFsdWU6IkkyIn0se2NvZGU6Iml0ZW1fdmFsdWUiLHZhbHVlOiIwLjAwIn0sXX0se2NvZGU6Im1ldGEiLGxpc3Q6W3tjb2RlOiJhZGRpdGl2ZSIsdmFsdWU6Im5vIn0se2NvZGU6ImF1dG8iLHZhbHVlOiJubyJ9LF19LF19LF19LF19fX0=
      inputs:
        id: ExampleInputId
        jsonSchema:
          $schema: http://json-schema.org/draft-07/schema#
          type: object
          properties:
            city_code:
              type: string
              default: std:011
            provider:
              type: string
              default: P1
            provider_location:
              type: string
              default: L1
            location_gps:
              type: string
              default: 19.129076,72.825803
            location_pin_code:
              type: string
              default: "400053"
            items:
              type: array
              default: []
              items:
                type: object
                properties:
                  itemId:
                    type: string
                    default: I1
                  quantity:
                    type: number
                    default: 1
                  location:
                    type: string
                    default: L1
                additionalProperties: true
                default: {}
          additionalProperties: true
          default: {}
  - api: on_select
    action_id: on_select
    owner: BPP
    responseFor: select
    unsolicited: false
    description: On-select response to select
    mock:
      generate: LyoqCiAqIEdlbmVyYXRlcyB0aGUgbW9jayBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgY3VzdG9taXphdGlvbiBvZiB0aGUgZGVmYXVsdCBwYXlsb2FkIHVzaW5nIHNlc3Npb24gZGF0YQogKiBmcm9tIHByZXZpb3VzIHN0ZXBzIGFuZCB1c2VyIGlucHV0cy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSBkZWZhdWx0UGF5bG9hZCAtIFRoZSBiYXNlIHBheWxvYWQgb2JqZWN0IHdpdGggY29udGV4dCBhbHJlYWR5IHBvcHVsYXRlZC4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhLnVzZXJfaW5wdXRzIC0gVXNlci1wcm92aWRlZCBpbnB1dCB2YWx1ZXMgZm9yIHRoaXMgc3RlcC4KICogQHBhcmFtIHsqfSBzZXNzaW9uRGF0YS5ba2V5XSAtIEFueSBzYXZlZCBkYXRhIGZyb20gcHJldmlvdXMgc3RlcHMgKGRlZmluZWQgaW4gc2F2ZURhdGEgY29uZmlnKS4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBnZW5lcmF0ZWQgcGF5bG9hZCBvYmplY3QgdG8gYmUgc2VudCBpbiB0aGUgQVBJIHJlcXVlc3QuCiAqLwpmdW5jdGlvbiBjcmVhdGVRdW90ZSgKCXNlbGVjdGVkSXRlbXMsCglzZXNzaW9uRGF0YSwKCWRlZmF1bHRQYXlsb2FkLAoJZnVsZmlsbG1lbnRzLAoJY2FuY2VsbGVkID0gZmFsc2UKKSB7CgoJbGV0IHRvdGFsUHJpY2UgPSAwOwoJbGV0IHRvdGFsUXVhbnRpdHkgPSAwOwoJbGV0IGl0ZW1TZXQgPSBuZXcgU2V0KCk7CglsZXQgYnJlYWt1cE9iamVjdCA9IFtdOwoJY29uc3QgY2F0YWxvZ0l0ZW1zID0gc2Vzc2lvbkRhdGEuUkVUMTBDYXRhbG9nLmNhdGFsb2dbCgkJImJwcC9wcm92aWRlcnMiCgldWzBdLml0ZW1zLmZpbHRlcigoaSkgPT4gewoJCWNvbnN0IGlkTWFwID0gc2VsZWN0ZWRJdGVtcy5tYXAoKGl0ZW0pID0+IGl0ZW0uaWQpOwoJCXJldHVybiBpZE1hcC5pbmNsdWRlcyhpLmlkKTsKCX0pOwoJCglmb3IgKGNvbnN0IHNlbGVjdGVkSXRlbSBvZiBzZWxlY3RlZEl0ZW1zID8/IFtdKSB7CgkJY29uc3QgZnVsZmlsbG1lbnQgPSBmdWxmaWxsbWVudHMuZmluZCgKCQkJKGYpID0+IGYuaWQgPT09IHNlbGVjdGVkSXRlbS5mdWxmaWxsbWVudF9pZAoJCSk7CgkJaWYgKAoJCQkhZnVsZmlsbG1lbnQgfHwKCQkJIVsiRGVsaXZlcnkiLCAiU2VsZi1QaWNrdXAiLCAiQnV5ZXItRGVsaXZlcnkiXS5pbmNsdWRlcygKCQkJCWZ1bGZpbGxtZW50LnR5cGUgPz8gIiIKCQkJKQoJCSkgewoJCQljb250aW51ZTsKCQl9CgkJY29uc3QgY2F0YWxvZ0l0ZW0gPSBjYXRhbG9nSXRlbXMuZmluZCgoaSkgPT4gaS5pZCA9PT0gc2VsZWN0ZWRJdGVtLmlkKTsKCQlpZiAoIWNhdGFsb2dJdGVtKSBjb250aW51ZTsgLy8gU2tpcCBpZiBpdGVtIG5vdCBmb3VuZCBpbiBjYXRhbG9nCgoJCWNvbnN0IHF1YW50aXR5ID0gY2FuY2VsbGVkID8gMCA6IHNlbGVjdGVkSXRlbS5jb3VudCA/PyAxOwoJCWNvbnN0IHByaWNlID0gcGFyc2VGbG9hdChjYXRhbG9nSXRlbS5wcmljZS52YWx1ZSkgKiBxdWFudGl0eTsKCQl0b3RhbFByaWNlICs9IHByaWNlOwoKCQljb25zdCBicmVha3VwQ2xvbmUgPSBKU09OLnBhcnNlKAoJCQlKU09OLnN0cmluZ2lmeShicmVha3VwSXRlbSkKCQkpOwoJCWJyZWFrdXBDbG9uZVsiQG9uZGMvb3JnL2l0ZW1faWQiXSA9IGNhdGFsb2dJdGVtLmlkOwoJCWJyZWFrdXBDbG9uZS50aXRsZSA9IGNhdGFsb2dJdGVtLmRlc2NyaXB0b3IubmFtZTsKCQlicmVha3VwQ2xvbmVbIkBvbmRjL29yZy9pdGVtX3F1YW50aXR5Il0uY291bnQgPSBxdWFudGl0eTsKCQlicmVha3VwQ2xvbmUucHJpY2UudmFsdWUgPSBgJHtwcmljZS50b0ZpeGVkKDIpfWA7CgkJYnJlYWt1cENsb25lLml0ZW0ucHJpY2UudmFsdWUgPSBjYXRhbG9nSXRlbS5wcmljZS52YWx1ZTsKCQlicmVha3VwT2JqZWN0LnB1c2goYnJlYWt1cENsb25lKTsKCgkJaWYgKHNlc3Npb25EYXRhLm91dF9vZl9zdG9ja19pdGVtX2lkcz8uaW5jbHVkZXMoY2F0YWxvZ0l0ZW0uaWQpKSB7CgkJCWJyZWFrdXBDbG9uZS5pdGVtLnF1YW50aXR5LmF2YWlsYWJsZS5jb3VudCA9ICIwIjsKCQkJYnJlYWt1cENsb25lLml0ZW0ucXVhbnRpdHkubWF4aW11bS5jb3VudCA9ICIwIjsKCQkJYnJlYWt1cENsb25lWyJAb25kYy9vcmcvdGl0bGVfdHlwZSJdID0gIml0ZW0iOwoJCQlkZWZhdWx0UGF5bG9hZC5lcnJvciA9IHsKCQkJCXR5cGU6ICJET01BSU4tRVJST1IiLAoJCQkJY29kZTogIjQwMDAyIiwKCQkJCW1lc3NhZ2U6IGBJdGVtIHdpdGggaWQ6ICR7Y2F0YWxvZ0l0ZW0uaWR9IGlzIG91dCBvZiBzdG9ja2AsCgkJCX07CgkJfSBlbHNlIHsKCQkJdG90YWxRdWFudGl0eSArPSBzZWxlY3RlZEl0ZW0uY291bnQgPz8gMDsKCQkJaWYgKHF1YW50aXR5ID4gMCkgaXRlbVNldC5hZGQoY2F0YWxvZ0l0ZW0uaWQpOwoJCX0KCgkJaWYgKHNlc3Npb25EYXRhLnNlYXJjaF9iYXBfdGVybXM/Lmxpc3Q/LnNvbWUodCA9PiB0LmNvZGUgPT09ICIwMEEiKSkgewoJCQlmb3IgKGNvbnN0IGZlZSBvZiBucEZlZXNicmVha3VwKSB7CgkJCQljb25zdCBmZWVDbG9uZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZmVlKSk7CgkJCQlmZWVDbG9uZVsiQG9uZGMvb3JnL2l0ZW1faWQiXSA9IGNhdGFsb2dJdGVtLmlkOwoJCQkJYnJlYWt1cE9iamVjdC5wdXNoKGZlZUNsb25lKTsKCQkJCXRvdGFsUHJpY2UgKz0gcGFyc2VGbG9hdChmZWVDbG9uZS5wcmljZS52YWx1ZSA/PyAiMCIpOwoJCQl9CgkJfQoJfQoKCWJyZWFrdXBPYmplY3QucHVzaChicmVha3VwWzBdKTsKCWJyZWFrdXBPYmplY3QucHVzaChicmVha3VwWzFdKTsKCWlmIChzZXNzaW9uRGF0YS5zZWxlY3RlZF9vZmZlcnMgJiYgc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfb2ZmZXJzLmxlbmd0aCA+IDApIHsKCQlsZXQgb2ZmZXJRdW90ZSA9CgkJCW9mZmVyUXVvdGVzWwoJCQkJc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfb2ZmZXJzWzBdLmlkCgkJCV07CgoJCWNvbnN0IG9mZmVySWQgPSBzZXNzaW9uRGF0YS5zZWxlY3RlZF9vZmZlcnNbMF0uaWQ7CgoJCWlmIChvZmZlcklkID09PSAiRkxBVDUwIiAmJiB0b3RhbFF1YW50aXR5ID4gMCkgewoJCQlicmVha3VwT2JqZWN0LnB1c2gob2ZmZXJRdW90ZSk7CgkJCWxldCBvZmZlclByaWNlID0gcGFyc2VGbG9hdChvZmZlclF1b3RlLnByaWNlLnZhbHVlKTsKCQkJaWYgKGNhbmNlbGxlZCkgb2ZmZXJQcmljZSA9IDA7CgkJCXRvdGFsUHJpY2UgKz0gb2ZmZXJQcmljZTsKCQl9IGVsc2UgaWYgKG9mZmVySWQgPT09ICJjb21ibzEiICYmIGl0ZW1TZXQuc2l6ZSA+PSAzKSB7CgkJCWJyZWFrdXBPYmplY3QucHVzaChvZmZlclF1b3RlKTsKCQkJbGV0IG9mZmVyUHJpY2UgPSBwYXJzZUZsb2F0KG9mZmVyUXVvdGUucHJpY2UudmFsdWUpOwoJCQlpZiAoY2FuY2VsbGVkKSBvZmZlclByaWNlID0gMDsKCQkJdG90YWxQcmljZSArPSBvZmZlclByaWNlOwoJCX0gZWxzZSBpZiAoCgkJCW9mZmVySWQgPT09ICJidXkyZ2V0MyIgJiYKCQkJdG90YWxRdWFudGl0eSA+PSAyICYmCgkJCSFzZXNzaW9uRGF0YS5vdXRfb2Zfc3RvY2tfaXRlbV9pZHM/LmluY2x1ZGVzKCJJMiIpCgkJKSB7CgkJCWlmIChjYW5jZWxsZWQpIHsKCQkJCS8vQHRzLWlnbm9yZQoJCQkJb2ZmZXJRdW90ZVsiQG9uZGMvb3JnL2l0ZW1fcXVhbnRpdHkiXSA9IHsKCQkJCQljb3VudDogMCwKCQkJCX07CgkJCX0KCQkJYnJlYWt1cE9iamVjdC5wdXNoKG9mZmVyUXVvdGUpOwoJCX0KCX0KCXJldHVybiB7CgkJYnJlYWt1cDogYnJlYWt1cE9iamVjdCwKCQlwcmljZTogewoJCQljdXJyZW5jeTogIklOUiIsCgkJCXZhbHVlOiBgJHt0b3RhbFByaWNlLnRvRml4ZWQoMil9YCwKCQl9LAoJCXR0bDogIlAxRCIsCgl9Owp9Cgpjb25zdCBicmVha3VwSXRlbSA9IHsKICAiQG9uZGMvb3JnL2l0ZW1faWQiOiAiSTEiLAogICJAb25kYy9vcmcvaXRlbV9xdWFudGl0eSI6IHsKICAgIGNvdW50OiAxLAogIH0sCiAgdGl0bGU6ICJQbGFpbiBBdHRhIiwKICAiQG9uZGMvb3JnL3RpdGxlX3R5cGUiOiAiaXRlbSIsCiAgcHJpY2U6IHsKICAgIGN1cnJlbmN5OiAiSU5SIiwKICAgIHZhbHVlOiAiMTAwLjAwIiwKICB9LAogIGl0ZW06IHsKICAgIHF1YW50aXR5OiB7CiAgICAgIGF2YWlsYWJsZTogewogICAgICAgIGNvdW50OiAiOTkiLAogICAgICB9LAogICAgICBtYXhpbXVtOiB7CiAgICAgICAgY291bnQ6ICI5OSIsCiAgICAgIH0sCiAgICB9LAogICAgcHJpY2U6IHsKICAgICAgY3VycmVuY3k6ICJJTlIiLAogICAgICB2YWx1ZTogIjEwMC4wMCIsCiAgICB9LAogIH0sCn07Cgpjb25zdCBicmVha3VwID0gWwogIHsKICAgICJAb25kYy9vcmcvaXRlbV9pZCI6ICJGMSIsCiAgICB0aXRsZTogIkRlbGl2ZXJ5IGNoYXJnZXMiLAogICAgIkBvbmRjL29yZy90aXRsZV90eXBlIjogImRlbGl2ZXJ5IiwKICAgIHByaWNlOiB7CiAgICAgIGN1cnJlbmN5OiAiSU5SIiwKICAgICAgdmFsdWU6ICIwMC4wMCIsCiAgICB9LAogIH0sCiAgewogICAgIkBvbmRjL29yZy9pdGVtX2lkIjogIkYxIiwKICAgIHRpdGxlOiAiQ29udmVuaWVuY2UgRmVlIiwKICAgICJAb25kYy9vcmcvdGl0bGVfdHlwZSI6ICJtaXNjIiwKICAgIHByaWNlOiB7CiAgICAgIGN1cnJlbmN5OiAiSU5SIiwKICAgICAgdmFsdWU6ICIwMC4wMCIsCiAgICB9LAogIH0sCl07Cgphc3luYyBmdW5jdGlvbiBnZW5lcmF0ZSgKICBkZWZhdWx0UGF5bG9hZCwKICBzZXNzaW9uRGF0YQopIHsKICBjb25zdCBzZWxlY3RlZEl0ZW1zT2JqID0gc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfaXRlbXM7CiAgZGVmYXVsdFBheWxvYWQubWVzc2FnZS5vcmRlci5pdGVtcyA9IHNlbGVjdGVkSXRlbXNPYmoubWFwKChpdGVtKSA9PiB7CiAgICByZXR1cm4gewogICAgICBpZDogaXRlbS5pZCwKICAgICAgZnVsZmlsbG1lbnRfaWQ6ICJGMSIsCiAgICB9OwogIH0pOwogIGNvbnN0IHF1b3RlID0gY3JlYXRlUXVvdGUoCiAgICBzZWxlY3RlZEl0ZW1zT2JqLm1hcCgoaXRlbSkgPT4gewogICAgICByZXR1cm4gewogICAgICAgIGlkOiBpdGVtLmlkLAogICAgICAgIGNvdW50OiBpdGVtLnF1YW50aXR5LmNvdW50LAogICAgICAgIGZ1bGZpbGxtZW50X2lkOiAiRjEiLAogICAgICB9OwogICAgfSksCiAgICBzZXNzaW9uRGF0YSwKICAgIGRlZmF1bHRQYXlsb2FkLAogICAgZGVmYXVsdFBheWxvYWQubWVzc2FnZS5vcmRlci5mdWxmaWxsbWVudHMKICApOwoJZGVmYXVsdFBheWxvYWQubWVzc2FnZS5vcmRlci5xdW90ZSA9IHF1b3RlOwoJZGVmYXVsdFBheWxvYWQuY29udGV4dC5tZXNzYWdlX2lkID0gc2Vzc2lvbkRhdGEubWVzc2FnZV9pZFswXTsKICByZXR1cm4gZGVmYXVsdFBheWxvYWQ7Cn0K
      validate: LyoqCiAqIFZhbGlkYXRlcyB0aGUgaW5jb21pbmcgcmVxdWVzdCBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXRQYXlsb2FkIC0gVGhlIGluY29taW5nIHJlcXVlc3QgcGF5bG9hZCB0byB2YWxpZGF0ZS4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiB2YWxpZGF0ZSh0YXJnZXRQYXlsb2FkLCBzZXNzaW9uRGF0YSkgewogIHJldHVybiB7IHZhbGlkOiB0cnVlLCBjb2RlOiAyMDAsIGRlc2NyaXB0aW9uOiAiVmFsaWQgcmVxdWVzdCIgfTsKfQ==
      requirements: ZnVuY3Rpb24gbWVldFJlcXVpcmVtZW50cyhzZXNzaW9uRGF0YSl7CiAgLy8gQ2hlY2sgZm9yIHNlbGVjdGVkX2l0ZW1zCiAgaWYgKCFzZXNzaW9uRGF0YS5zZWxlY3RlZF9pdGVtcyB8fCBzZXNzaW9uRGF0YS5zZWxlY3RlZF9pdGVtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBzZWxlY3RlZF9pdGVtcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU0VMRUNURURfSVRFTVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBwYXlsb2FkX2NpdHkKICBpZiAoIXNlc3Npb25EYXRhLnBheWxvYWRfY2l0eSkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHBheWxvYWRfY2l0eSBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUEFZTE9BRF9DSVRZIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3Igc2VsZWN0ZWRfZnVsZmlsbG1lbnRzCiAgaWYgKAogICAgIXNlc3Npb25EYXRhLnNlbGVjdGVkX2Z1bGZpbGxtZW50cyB8fAogICAgc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfZnVsZmlsbG1lbnRzLmxlbmd0aCA9PT0gMAogICkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHNlbGVjdGVkX2Z1bGZpbGxtZW50cyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU0VMRUNURURfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgcHJvdmlkZXIKICBpZiAoIXNlc3Npb25EYXRhLnByb3ZpZGVyKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gcHJvdmlkZXIgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1BST1ZJREVSIiwKICAgIH07CiAgfQoKICAvLyBBbGwgcmVxdWlyZW1lbnRzIHNhdGlzZmllZAogIHJldHVybiB7CiAgICB2YWxpZDogdHJ1ZSwKICAgIGRlc2NyaXB0aW9uOiAiQWxsIENoZWNrcyBwYXNzZXMgc3VjY2Vzc2Z1bGx5IiwKICAgIGNvZGU6ICIyMDAiLAogIH07Cn0K
      defaultPayload:
        context:
          domain: ONDC:RETeB2B
          action: on_select
          timestamp: 2025-12-29T06:44:41.277Z
          transaction_id: T1
          message_id: M1
          bap_id: sample-bap-id
          bap_uri: https://bap.example.com
          ttl: PT30S
          bpp_id: sample-bpp-id
          bpp_uri: https://bpp.example.com
          country: IND
          city: "*"
          core_version: 1.2.5
        message:
          order:
            provider:
              id: P1
              locations:
                - id: L1
            fulfillments:
              - id: F1
                type: Delivery
                "@ondc/org/provider_name": LSP or Provider Name
                tracking: true
                "@ondc/org/category": Standard Delivery
                "@ondc/org/TAT": P2D
                state:
                  descriptor:
                    code: Serviceable
                customer:
                  id: CUST_001
                  organization:
                    descriptor:
                      name: Sharma Kirana Store
                  person:
                    creds:
                      - id: 29AABCU9603R1ZM
                        type: GSTIN
                      - id: AABCU9603R
                        type: PAN
            quote:
              price:
                value: "100.00"
                currency: INR
              breakup:
                - "@ondc/org/item_id": I1
                  "@ondc/org/item_quantity":
                    count: 1
                  title: Plain Atta
                  "@ondc/org/title_type": item
                  price:
                    currency: INR
                    value: "100.00"
                  item:
                    quantity:
                      available:
                        count: "99"
                      maximum:
                        count: "99"
                    price:
                      currency: INR
                      value: "100.00"
                - "@ondc/org/item_id": F1
                  title: Delivery charges
                  "@ondc/org/title_type": delivery
                  price:
                    currency: INR
                    value: "0.00"
                - "@ondc/org/item_id": F1
                  title: Convenience Fee
                  "@ondc/org/title_type": misc
                  price:
                    currency: INR
                    value: "0.00"
              ttl: P1D
            items:
              - id: I1
                fulfillment_id: F1
      saveData:
        transactionId: $.context.transaction_id
        latestMessage_id: $.context.message_id
        latestTimestamp: $.context.timestamp
        bapId: $.context.bap_id
        bapUri: $.context.bap_uri
        bppId: $.context.bpp_id
        bppUri: $.context.bpp_uri
        quote: $.message.order.quote
        on_select_fulfillments: $.message.order.fulfillments[*]
        on_select_items: $.message.order.items[*]
        tat: $.message.order.fulfillments[0]["@ondc/org/TAT"]
      inputs: {}
  - api: init
    action_id: init
    owner: BAP
    responseFor: null
    unsolicited: false
    description: "Init "
    mock:
      generate: LyoqCiAqIEdlbmVyYXRlcyB0aGUgbW9jayBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgY3VzdG9taXphdGlvbiBvZiB0aGUgZGVmYXVsdCBwYXlsb2FkIHVzaW5nIHNlc3Npb24gZGF0YQogKiBmcm9tIHByZXZpb3VzIHN0ZXBzIGFuZCB1c2VyIGlucHV0cy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSBkZWZhdWx0UGF5bG9hZCAtIFRoZSBiYXNlIHBheWxvYWQgb2JqZWN0IHdpdGggY29udGV4dCBhbHJlYWR5IHBvcHVsYXRlZC4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhLnVzZXJfaW5wdXRzIC0gVXNlci1wcm92aWRlZCBpbnB1dCB2YWx1ZXMgZm9yIHRoaXMgc3RlcC4KICogQHBhcmFtIHsqfSBzZXNzaW9uRGF0YS5ba2V5XSAtIEFueSBzYXZlZCBkYXRhIGZyb20gcHJldmlvdXMgc3RlcHMgKGRlZmluZWQgaW4gc2F2ZURhdGEgY29uZmlnKS4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBnZW5lcmF0ZWQgcGF5bG9hZCBvYmplY3QgdG8gYmUgc2VudCBpbiB0aGUgQVBJIHJlcXVlc3QuCiAqLwpmdW5jdGlvbiBnZXRVcGRhdGVkQmlsbGluZyhzYXZlZEJpbGxpbmcsIGluaXRpYWxpemUgPSBmYWxzZSkgewogIGlmIChpbml0aWFsaXplKSB7CiAgICBjb25zdCBuZXdJc28gPSBuZXcgRGF0ZShuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIDUgKiAxMDAwKS50b0lTT1N0cmluZygpOwogICAgc2F2ZWRCaWxsaW5nLmNyZWF0ZWRfYXQgPSBuZXdJc287CiAgICBzYXZlZEJpbGxpbmcudXBkYXRlZF9hdCA9IG5ld0lzbzsKICB9CiAgcmV0dXJuIHNhdmVkQmlsbGluZzsKfQpmdW5jdGlvbiBjcmVhdGVGdWxmaWxsbWVudHMoCiAgc2Vzc2lvbkRhdGEsCiAgZGVmYXVsdEZ1bGZpbGxtZW50cwopIHsKICBpZiAoZGVmYXVsdEZ1bGZpbGxtZW50cy5sZW5ndGggPCAxKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIkVtcHR5IGZ1bGZpbGxtZW50cyBmb3VuZCIpOwogIH0KICBjb25zdCBvblNlbGVjdEZ1bGZpbGxtZW50cyA9CiAgICBzZXNzaW9uRGF0YS5vbl9zZWxlY3RfZnVsZmlsbG1lbnRzOwogICAgY29uc3Qgc2VsZWN0ZWQgPSBzZXNzaW9uRGF0YS5zZWxlY3RlZF9mdWxmaWxsbWVudHM7CiAgICBjb25zdCBkZWZhdWx0RW5kID0gewogICAgICBlbmQ6IHsKICAgICAgICBjb250YWN0OiB7CiAgICAgICAgICBlbWFpbDogIm5vYm9keUBub21haWwuY29tIiwKICAgICAgICAgIHBob25lOiAiOTg5ODk4OTg5OCIsCiAgICAgICAgfSwKICAgICAgICBsb2NhdGlvbjogewogICAgICAgICAgZ3BzOiBzZWxlY3RlZFswXS5lbmQ/LmxvY2F0aW9uPy5ncHMsCiAgICAgICAgICBhZGRyZXNzOiB7CiAgICAgICAgICAgIGJ1aWxkaW5nOiAibW9jay1idWlsZGluZyIsCiAgICAgICAgICAgIGNpdHk6ICJtb2NrLWNpdHkiLAogICAgICAgICAgICBzdGF0ZTogIm1vY2stc3RhdGUiLAogICAgICAgICAgICBjb3VudHJ5OiAiSU5EIiwKICAgICAgICAgICAgYXJlYV9jb2RlOgogICAgICAgICAgICAgIHNlbGVjdGVkWzBdLmVuZD8ubG9jYXRpb24/LmFkZHJlc3M/LmFyZWFfY29kZSB8fCAiNDAwMDUzIiwKICAgICAgICAgICAgbG9jYWxpdHk6ICJtb2NrLWxvY2FsaXR5IiwKICAgICAgICAgICAgbmFtZTogIm1vY2staG91c2UtbmFtZSIsCiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgIH0sCiAgICB9OwoKICAgIGxldCB0YXJnZXRGdWxmaWxsbWVudCA9IHt9OwogICAgICB0YXJnZXRGdWxmaWxsbWVudCA9IG9uU2VsZWN0RnVsZmlsbG1lbnRzLmZpbmQoCiAgICAgICAgKGYpID0+IGYudHlwZSA9PT0gIkRlbGl2ZXJ5IgogICAgICApOwoKICAgIGNvbnN0IGluaXRGdWxmaWxsbWVudHMgPSBbCiAgICAgIHsKICAgICAgICBpZDogdGFyZ2V0RnVsZmlsbG1lbnQ/LmlkIHx8ICJGMyIsCiAgICAgICAgdHlwZTogdGFyZ2V0RnVsZmlsbG1lbnQ/LnR5cGUgfHwgIkRlbGl2ZXJ5IiwKICAgICAgICBlbmQ6IGRlZmF1bHRFbmQuZW5kLAogICAgICB9LAogICAgXTsKCiAgICByZXR1cm4gaW5pdEZ1bGZpbGxtZW50czsKfQphc3luYyBmdW5jdGlvbiBnZW5lcmF0ZShkZWZhdWx0UGF5bG9hZCwgc2Vzc2lvbkRhdGEpIHsKICBjb25zdCBpdGVtcyA9IHNlc3Npb25EYXRhLnNlbGVjdGVkX2l0ZW1zOwoJY29uc3Qgb25TZWxlY3REYXRhID0gc2Vzc2lvbkRhdGEub25fc2VsZWN0X2Z1bGZpbGxtZW50czsKCWNvbnN0IGZJZCA9IG9uU2VsZWN0RGF0YS5maW5kKChmKSA9PiBmLnR5cGUgPT09ICJEZWxpdmVyeSIpPy5pZCB8fCAiRjEiOwoKICBkZWZhdWx0UGF5bG9hZC5tZXNzYWdlLm9yZGVyLml0ZW1zID0gaXRlbXMubWFwKChpdGVtKSA9PiB7CgkJcmV0dXJuIHsKCQkJaWQ6IGl0ZW0uaWQsCgkJCWZ1bGZpbGxtZW50X2lkOiBmSWQsCgkJCXF1YW50aXR5OiB7CgkJCQljb3VudDogaXRlbS5xdWFudGl0eS5jb3VudCwKCQkJfSwKCQkJbG9jYXRpb25faWQ6IGl0ZW0ubG9jYXRpb25faWQsCgkJfTsKCX0pOwogIGRlZmF1bHRQYXlsb2FkLm1lc3NhZ2Uub3JkZXIuYmlsbGluZyA9IGdldFVwZGF0ZWRCaWxsaW5nKAoJCWRlZmF1bHRQYXlsb2FkLm1lc3NhZ2Uub3JkZXIuYmlsbGluZywKCQl0cnVlCgkpOwogIGRlZmF1bHRQYXlsb2FkLm1lc3NhZ2Uub3JkZXIuZnVsZmlsbG1lbnRzID0gY3JlYXRlRnVsZmlsbG1lbnRzKAoJCXNlc3Npb25EYXRhLAogICAgZGVmYXVsdFBheWxvYWQubWVzc2FnZS5vcmRlci5mdWxmaWxsbWVudHMKCSk7CiAgZGVmYXVsdFBheWxvYWQubWVzc2FnZS5vcmRlci5wcm92aWRlciA9IHNlc3Npb25EYXRhLnByb3ZpZGVyWzBdOwoJaWYgKHNlc3Npb25EYXRhLnNlbGVjdGVkX29mZmVycykgewogICAgZGVmYXVsdFBheWxvYWQubWVzc2FnZS5vcmRlci5vZmZlcnMgPSBzZXNzaW9uRGF0YS5zZWxlY3RlZF9vZmZlcnMubWFwKAoJCQkob2ZmZXIpID0+IHsKCQkJCXJldHVybiB7CgkJCQkJaWQ6IG9mZmVyLmlkLAoJCQkJCXRhZ3M6IFsKCQkJCQkJewoJCQkJCQkJY29kZTogInNlbGVjdGlvbiIsCgkJCQkJCQlsaXN0OiBbCgkJCQkJCQkJewoJCQkJCQkJCQljb2RlOiAiYXBwbHkiLAoJCQkJCQkJCQl2YWx1ZTogInllcyIsCgkJCQkJCQkJfSwKCQkJCQkJCV0sCgkJCQkJCX0sCgkJCQkJXSwKCQkJCX07CgkJCX0KCQkpOwoJfQoKICByZXR1cm4gZGVmYXVsdFBheWxvYWQ7Cn0=
      validate: LyoqCiAqIFZhbGlkYXRlcyB0aGUgaW5jb21pbmcgcmVxdWVzdCBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXRQYXlsb2FkIC0gVGhlIGluY29taW5nIHJlcXVlc3QgcGF5bG9hZCB0byB2YWxpZGF0ZS4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiB2YWxpZGF0ZSh0YXJnZXRQYXlsb2FkLCBzZXNzaW9uRGF0YSkgewogIHJldHVybiB7IHZhbGlkOiB0cnVlLCBjb2RlOiAyMDAsIGRlc2NyaXB0aW9uOiAiVmFsaWQgcmVxdWVzdCIgfTsKfQ==
      requirements: LyoqCiAqIENoZWNrcyBpZiB0aGUgcmVxdWlyZW1lbnRzIGZvciBwcm9jZWVkaW5nIHdpdGggdGhlIEFQSSBjYWxsIGFyZSBtZXQuCiAqIAogKiBAcGFyYW0ge09iamVjdH0gc2Vzc2lvbkRhdGEgLSBEYXRhIGNvbGxlY3RlZCBmcm9tIHByZXZpb3VzIHRyYW5zYWN0aW9uIHN0ZXBzLgogKiAKICogQHJldHVybnMge09iamVjdH0geyB2YWxpZDogYm9vbGVhbiwgY29kZTogbnVtYmVyLCBkZXNjcmlwdGlvbjogc3RyaW5nIH0KICovCmZ1bmN0aW9uIG1lZXRSZXF1aXJlbWVudHMoc2Vzc2lvbkRhdGEpewogIC8vIENoZWNrIGZvciBzZWxlY3RlZF9pdGVtcwogIGlmICghc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfaXRlbXMgfHwgc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfaXRlbXMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gc2VsZWN0ZWRfaXRlbXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1NFTEVDVEVEX0lURU1TIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgcGF5bG9hZF9jaXR5CiAgaWYgKCFzZXNzaW9uRGF0YS5wYXlsb2FkX2NpdHkpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBwYXlsb2FkX2NpdHkgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1BBWUxPQURfQ0lUWSIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHNlbGVjdGVkX2Z1bGZpbGxtZW50cwogIGlmICgKICAgICFzZXNzaW9uRGF0YS5zZWxlY3RlZF9mdWxmaWxsbWVudHMgfHwKICAgIHNlc3Npb25EYXRhLnNlbGVjdGVkX2Z1bGZpbGxtZW50cy5sZW5ndGggPT09IDAKICApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBzZWxlY3RlZF9mdWxmaWxsbWVudHMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1NFTEVDVEVEX0ZVTEZJTExNRU5UUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHByb3ZpZGVyCiAgaWYgKCFzZXNzaW9uRGF0YS5wcm92aWRlcikgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHByb3ZpZGVyIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19QUk9WSURFUiIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHF1b3RlCiAgaWYgKCFzZXNzaW9uRGF0YS5xdW90ZSB8fCB0eXBlb2Ygc2Vzc2lvbkRhdGEucXVvdGUgIT09ICJvYmplY3QiKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gcXVvdGUgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1FVT1RFIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3Igb25fc2VsZWN0X2Z1bGZpbGxtZW50cwogIGlmICgKICAgICFzZXNzaW9uRGF0YS5vbl9zZWxlY3RfZnVsZmlsbG1lbnRzIHx8CiAgICBzZXNzaW9uRGF0YS5vbl9zZWxlY3RfZnVsZmlsbG1lbnRzLmxlbmd0aCA9PT0gMAogICkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIG9uX3NlbGVjdF9mdWxmaWxsbWVudHMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX09OX1NFTEVDVF9GVUxGSUxMTUVOVFMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBvbl9zZWxlY3RfaXRlbXMKICBpZiAoCiAgICAhc2Vzc2lvbkRhdGEub25fc2VsZWN0X2l0ZW1zIHx8CiAgICBzZXNzaW9uRGF0YS5vbl9zZWxlY3RfaXRlbXMubGVuZ3RoID09PSAwCiAgKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gb25fc2VsZWN0X2l0ZW1zIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19PTl9TRUxFQ1RfSVRFTVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciB0YXQKICBpZiAoIXNlc3Npb25EYXRhLnRhdCkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHRhdCBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfVEFUIiwKICAgIH07CiAgfQoKICAvLyBBbGwgcmVxdWlyZW1lbnRzIHNhdGlzZmllZAogIHJldHVybiB7CiAgICB2YWxpZDogdHJ1ZSwKICAgIGRlc2NyaXB0aW9uOiAiQWxsIENoZWNrcyBwYXNzZWQgc3VjY2Vzc2Z1bGx5IiwKICAgIGNvZGU6ICIyMDAiLAogIH07Cn0K
      defaultPayload:
        context:
          domain: ONDC:RETeB2B
          action: init
          timestamp: 2025-12-29T07:50:43.211Z
          transaction_id: 3cd7243a-eef8-42e1-8d12-9c76eab6fcea
          message_id: c8681924-f1de-4e37-9456-cb43743ce863
          bap_id: sample-bap-id
          bap_uri: https://bap.example.com
          ttl: PT30S
          bpp_id: sample-bpp-id
          bpp_uri: https://bpp.example.com
          country: IND
          city: "*"
          core_version: 1.2.5
        message:
          order:
            provider:
              id: P1
              locations:
                - id: L1
            items:
              - id: I1
                quantity:
                  count: 1
                location_id: L1
                fulfillment_id: F1
            billing:
              address:
                building: my building name or house
                city: Mumbai
                state: Maharashtra
                country: IND
                area_code: "400053"
                locality: my street name
                name: my house or door or floor
              phone: "9898989898"
              name: ONDC buyer
              email: nobody@nomail.com
              created_at: 2024-12-23T07:01:43.145Z
              updated_at: 2024-12-23T07:01:43.145Z
            fulfillments:
              - id: F1
                type: Delivery
                customer:
                  id: CUST_001
                  organization:
                    descriptor:
                      name: Sharma Kirana Store
                  person:
                    creds:
                      - id: 29AABCU9603R1ZM
                        type: GSTIN
                      - id: AABCU9603R
                        type: PAN
                end:
                  contact:
                    email: nobody@nomail.com
                    phone: "9898989898"
                  location:
                    gps: 19.131140,72.834091
                    address:
                      building: mock-building
                      city: mock-city
                      state: mock-state
                      country: IND
                      area_code: "400053"
                      locality: mock-locality
                      name: mock-house-name
      saveData:
        transactionId: $.context.transaction_id
        latestTimestamp: $.context.timestamp
        bapId: $.context.bap_id
        bapUri: $.context.bap_uri
        bppId: $.context.bpp_id
        bppUri: $.context.bpp_uri
        message_id: $.context.message_id
        items: $.message.order.items[*]
        provider: $.message.order.provider
        billing: $.message.order.billing
        fulfillments: $.message.order.fulfillments[*]
        selected_np_fees: $.message.order.items[*].tags[?(@.code=="np_fees")].list[?(@.code=="id")].value
      inputs: {}
  - api: on_init
    action_id: on_init
    owner: BPP
    responseFor: init
    unsolicited: false
    description: Response to Init call
    mock:
      generate: ZnVuY3Rpb24gZ2V0VXBkYXRlZEJpbGxpbmcoc2F2ZWRCaWxsaW5nLCBpbml0aWFsaXplID0gZmFsc2UpIHsKCWlmIChpbml0aWFsaXplKSB7CgkJY29uc3QgbmV3SXNvID0gbmV3IERhdGUobmV3IERhdGUoKS5nZXRUaW1lKCkgLSA1ICogMTAwMCkudG9JU09TdHJpbmcoKTsKCQlzYXZlZEJpbGxpbmcuY3JlYXRlZF9hdCA9IG5ld0lzbzsKCQlzYXZlZEJpbGxpbmcudXBkYXRlZF9hdCA9IG5ld0lzbzsKCX0KCXJldHVybiBzYXZlZEJpbGxpbmc7Cn0KZnVuY3Rpb24gY3JlYXRlRnVsZmlsbG1lbnRzKAoJc2Vzc2lvbkRhdGEsCglkZWZhdWx0RnVsZmlsbG1lbnRzCikgewoJaWYgKGRlZmF1bHRGdWxmaWxsbWVudHMubGVuZ3RoIDwgMSkgewoJCXRocm93IG5ldyBFcnJvcigiRW1wdHkgZnVsZmlsbG1lbnRzIGZvdW5kIik7Cgl9CgoJCWNvbnN0IGZ1bGZpbGxtZW50cyA9IHNlc3Npb25EYXRhLmZ1bGZpbGxtZW50czsKCQlyZXR1cm4gZnVsZmlsbG1lbnRzLm1hcCgoZikgPT4gewoJCQlyZXR1cm4gewoJCQkJaWQ6IGYuaWQsCgkJCQl0eXBlOiBmLnR5cGUsCgkJCQllbmQ6IGYuZW5kLAoJCQkJdHJhY2tpbmc6IHRydWUsCgkJCX07CgkJfSk7Cgp9CmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlKAoJZGVmYXVsdFBheWxvYWQsCglzZXNzaW9uRGF0YQopIHsKCWRlZmF1bHRQYXlsb2FkLm1lc3NhZ2Uub3JkZXIuaXRlbXMgPSBzZXNzaW9uRGF0YS5pdGVtczsKCWRlZmF1bHRQYXlsb2FkLm1lc3NhZ2Uub3JkZXIuZnVsZmlsbG1lbnRzID0gY3JlYXRlRnVsZmlsbG1lbnRzKAoJCXNlc3Npb25EYXRhLAoJCWRlZmF1bHRQYXlsb2FkLm1lc3NhZ2Uub3JkZXIuZnVsZmlsbG1lbnRzCgkpOwoJZGVmYXVsdFBheWxvYWQubWVzc2FnZS5vcmRlci5iaWxsaW5nID0gZ2V0VXBkYXRlZEJpbGxpbmcoCgkJc2Vzc2lvbkRhdGEuYmlsbGluZ1swXQoJKTsKCWRlZmF1bHRQYXlsb2FkLm1lc3NhZ2Uub3JkZXIucHJvdmlkZXIgPSBzZXNzaW9uRGF0YS5wcm92aWRlclswXTsKCWRlZmF1bHRQYXlsb2FkLm1lc3NhZ2Uub3JkZXIucXVvdGUgPSBzZXNzaW9uRGF0YS5xdW90ZVswXTsKCWRlZmF1bHRQYXlsb2FkLm1lc3NhZ2Uub3JkZXIucXVvdGUuYnJlYWt1cCA9CgkJZGVmYXVsdFBheWxvYWQubWVzc2FnZS5vcmRlci5xdW90ZS5icmVha3VwLm1hcCgoYikgPT4gewoJCQlpZiAoYlsiQG9uZGMvb3JnL3RpdGxlX3R5cGUiXSA9PT0gIml0ZW0iKSB7CgkJCQlpZiAoYi5pdGVtICYmIGIuaXRlbS5xdWFudGl0eSkgZGVsZXRlIGIuaXRlbS5xdWFudGl0eTsKCQkJfQoJCQlyZXR1cm4gYjsKCQl9KTsKCWRlZmF1bHRQYXlsb2FkLmNvbnRleHQubWVzc2FnZV9pZCA9IHNlc3Npb25EYXRhLm1lc3NhZ2VfaWRbMF07CglyZXR1cm4gZGVmYXVsdFBheWxvYWQ7Cn0K
      validate: LyoqCiAqIFZhbGlkYXRlcyB0aGUgaW5jb21pbmcgcmVxdWVzdCBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXRQYXlsb2FkIC0gVGhlIGluY29taW5nIHJlcXVlc3QgcGF5bG9hZCB0byB2YWxpZGF0ZS4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiB2YWxpZGF0ZSh0YXJnZXRQYXlsb2FkLCBzZXNzaW9uRGF0YSkgewogIHJldHVybiB7IHZhbGlkOiB0cnVlLCBjb2RlOiAyMDAsIGRlc2NyaXB0aW9uOiAiVmFsaWQgcmVxdWVzdCIgfTsKfQ==
      requirements: LyoqCiAqIENoZWNrcyBpZiB0aGUgcmVxdWlyZW1lbnRzIGZvciBwcm9jZWVkaW5nIHdpdGggdGhlIEFQSSBjYWxsIGFyZSBtZXQuCiAqIAogKiBAcGFyYW0ge09iamVjdH0gc2Vzc2lvbkRhdGEgLSBEYXRhIGNvbGxlY3RlZCBmcm9tIHByZXZpb3VzIHRyYW5zYWN0aW9uIHN0ZXBzLgogKiAKICogQHJldHVybnMge09iamVjdH0geyB2YWxpZDogYm9vbGVhbiwgY29kZTogbnVtYmVyLCBkZXNjcmlwdGlvbjogc3RyaW5nIH0KICovCi8qKgogKiBDaGVja3MgaWYgdGhlIHJlcXVpcmVtZW50cyBmb3IgcHJvY2VlZGluZyB3aXRoIHRoZSBBUEkgY2FsbCBhcmUgbWV0LgogKiAKICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiBtZWV0UmVxdWlyZW1lbnRzKHNlc3Npb25EYXRhKSB7CiAgLy8gQ2hlY2sgZm9yIHNlbGVjdGVkX2l0ZW1zCiAgaWYgKCFzZXNzaW9uRGF0YS5zZWxlY3RlZF9pdGVtcyB8fCBzZXNzaW9uRGF0YS5zZWxlY3RlZF9pdGVtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBzZWxlY3RlZF9pdGVtcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU0VMRUNURURfSVRFTVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBwYXlsb2FkX2NpdHkKICBpZiAoIXNlc3Npb25EYXRhLnBheWxvYWRfY2l0eSkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHBheWxvYWRfY2l0eSBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUEFZTE9BRF9DSVRZIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3Igc2VsZWN0ZWRfZnVsZmlsbG1lbnRzCiAgaWYgKAogICAgIXNlc3Npb25EYXRhLnNlbGVjdGVkX2Z1bGZpbGxtZW50cyB8fAogICAgc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfZnVsZmlsbG1lbnRzLmxlbmd0aCA9PT0gMAogICkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHNlbGVjdGVkX2Z1bGZpbGxtZW50cyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU0VMRUNURURfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgcHJvdmlkZXIKICBpZiAoIXNlc3Npb25EYXRhLnByb3ZpZGVyKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gcHJvdmlkZXIgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1BST1ZJREVSIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgcXVvdGUKICBpZiAoIXNlc3Npb25EYXRhLnF1b3RlIHx8IHR5cGVvZiBzZXNzaW9uRGF0YS5xdW90ZSAhPT0gIm9iamVjdCIpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBxdW90ZSBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUVVPVEUiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBvbl9zZWxlY3RfZnVsZmlsbG1lbnRzCiAgaWYgKAogICAgIXNlc3Npb25EYXRhLm9uX3NlbGVjdF9mdWxmaWxsbWVudHMgfHwKICAgIHNlc3Npb25EYXRhLm9uX3NlbGVjdF9mdWxmaWxsbWVudHMubGVuZ3RoID09PSAwCiAgKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gb25fc2VsZWN0X2Z1bGZpbGxtZW50cyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfT05fU0VMRUNUX0ZVTEZJTExNRU5UUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9uX3NlbGVjdF9pdGVtcwogIGlmICgKICAgICFzZXNzaW9uRGF0YS5vbl9zZWxlY3RfaXRlbXMgfHwKICAgIHNlc3Npb25EYXRhLm9uX3NlbGVjdF9pdGVtcy5sZW5ndGggPT09IDAKICApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBvbl9zZWxlY3RfaXRlbXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX09OX1NFTEVDVF9JVEVNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHRhdAogIGlmICghc2Vzc2lvbkRhdGEudGF0KSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gdGF0IGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19UQVQiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBpdGVtcyAoTkVXKQogIGlmICghc2Vzc2lvbkRhdGEuaXRlbXMgfHwgc2Vzc2lvbkRhdGEuaXRlbXMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gaXRlbXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0lURU1TIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgYmlsbGluZyAoTkVXKQogIGlmICghc2Vzc2lvbkRhdGEuYmlsbGluZyB8fCB0eXBlb2Ygc2Vzc2lvbkRhdGEuYmlsbGluZyAhPT0gIm9iamVjdCIpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBiaWxsaW5nIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19CSUxMSU5HIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgZnVsZmlsbG1lbnRzIChORVcpCiAgaWYgKCFzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHMgfHwgc2Vzc2lvbkRhdGEuZnVsZmlsbG1lbnRzLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIGZ1bGZpbGxtZW50cyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3Igc2VsZWN0ZWRfbnBfZmVlcyAoTkVXKQogIGlmICghc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfbnBfZmVlcykgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHNlbGVjdGVkX25wX2ZlZXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1NFTEVDVEVEX05QX0ZFRVMiLAogICAgfTsKICB9CgogIC8vIEFsbCByZXF1aXJlbWVudHMgc2F0aXNmaWVkCiAgcmV0dXJuIHsKICAgIHZhbGlkOiB0cnVlLAogICAgZGVzY3JpcHRpb246ICJBbGwgQ2hlY2tzIHBhc3NlZCBzdWNjZXNzZnVsbHkiLAogICAgY29kZTogIjIwMCIsCiAgfTsKfQo=
      defaultPayload:
        context:
          domain: ONDC:RETeB2B
          action: on_init
          timestamp: 2025-12-29T08:10:19.239Z
          transaction_id: 3cd7243a-eef8-42e1-8d12-9c76eab6fcea
          message_id: c2d4ecdb-b863-4eb0-ab35-8851e9c789be
          bap_id: sample-bap-id
          bap_uri: https://bap.example.com
          ttl: PT30S
          bpp_id: sample-bpp-id
          bpp_uri: https://bpp.example.com
          country: IND
          city: "*"
          core_version: 1.2.5
        message:
          order:
            provider:
              id: P1
              locations:
                - id: L1
            items:
              - id: I1
                quantity:
                  count: 1
                location_id: L1
                fulfillment_id: F1
            billing:
              address:
                building: my building name or house
                city: Mumbai
                state: Maharashtra
                country: IND
                area_code: "400053"
                locality: my street name
                name: my house or door or floor
              phone: "9898989898"
              name: ONDC buyer
              email: nobody@nomail.com
              created_at: 2024-12-23T07:01:43.145Z
              updated_at: 2024-12-23T07:01:43.145Z
            fulfillments:
              - id: F1
                type: Delivery
                tracking: true
                customer:
                  id: CUST_001
                  organization:
                    descriptor:
                      name: Sharma Kirana Store
                  person:
                    creds:
                      - id: 29AABCU9603R1ZM
                        type: GSTIN
                      - id: ABCDE1234F
                        type: PAN
                end:
                  contact:
                    email: nobody@nomail.com
                    phone: "9898989898"
                  location:
                    gps: 19.131140,72.834091
                    address:
                      building: my building name or house
                      city: Mumbai
                      state: Maharashtra
                      country: IND
                      area_code: "400053"
                      locality: my street name
                      name: my house or door or floor
            quote:
              price:
                value: "100.00"
                currency: INR
              breakup:
                - "@ondc/org/item_id": I1
                  "@ondc/org/item_quantity":
                    count: 1
                  title: Plain Atta
                  "@ondc/org/title_type": item
                  price:
                    currency: INR
                    value: "100.00"
                  item:
                    price:
                      currency: INR
                      value: "100.00"
                - "@ondc/org/item_id": F1
                  title: Delivery charges
                  "@ondc/org/title_type": delivery
                  price:
                    currency: INR
                    value: "0.00"
                - "@ondc/org/item_id": F1
                  title: Convenience Fee
                  "@ondc/org/title_type": misc
                  price:
                    currency: INR
                    value: "0.00"
              ttl: P1D
            payment:
              "@ondc/org/buyer_app_finder_fee_type": percent
              "@ondc/org/buyer_app_finder_fee_amount": "3"
              "@ondc/org/settlement_details":
                - settlement_counterparty: seller-app
                  settlement_phase: sale-amount
                  settlement_type: neft
                  beneficiary_name: xxxx
                  settlement_bank_account_no: XXXX
                  settlement_ifsc_code: XXXX
                  bank_name: XXXX
                  branch_name: XXXX
            tags:
              - code: bpp_terms
                list:
                  - code: np_type
                    value: MSN
                  - code: tax_number
                    value: 00ABCCH7409R1ZZ
                  - code: provider_tax_number
                    value: ABCDE1234F
      saveData:
        transactionId: $.context.transaction_id
        latestMessage_id: $.context.message_id
        latestTimestamp: $.context.timestamp
        bapId: $.context.bap_id
        bapUri: $.context.bap_uri
        bppId: $.context.bpp_id
        bppUri: $.context.bpp_uri
        quote: $.message.order.quote
        bpp_terms: $.message.order.tags[?(@.code == 'bpp_terms')]
        tags: $.message.order.tags[*]
        fulfillments: $.message.order.fulfillments[*]
      inputs: {}
  - api: confirm
    action_id: confirm
    owner: BAP
    responseFor: null
    unsolicited: false
    description: Confirming the Order after Init
    mock:
      generate: LyoqCiAqIEdlbmVyYXRlcyB0aGUgbW9jayBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgY3VzdG9taXphdGlvbiBvZiB0aGUgZGVmYXVsdCBwYXlsb2FkIHVzaW5nIHNlc3Npb24gZGF0YQogKiBmcm9tIHByZXZpb3VzIHN0ZXBzIGFuZCB1c2VyIGlucHV0cy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSBkZWZhdWx0UGF5bG9hZCAtIFRoZSBiYXNlIHBheWxvYWQgb2JqZWN0IHdpdGggY29udGV4dCBhbHJlYWR5IHBvcHVsYXRlZC4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhLnVzZXJfaW5wdXRzIC0gVXNlci1wcm92aWRlZCBpbnB1dCB2YWx1ZXMgZm9yIHRoaXMgc3RlcC4KICogQHBhcmFtIHsqfSBzZXNzaW9uRGF0YS5ba2V5XSAtIEFueSBzYXZlZCBkYXRhIGZyb20gcHJldmlvdXMgc3RlcHMgKGRlZmluZWQgaW4gc2F2ZURhdGEgY29uZmlnKS4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBnZW5lcmF0ZWQgcGF5bG9hZCBvYmplY3QgdG8gYmUgc2VudCBpbiB0aGUgQVBJIHJlcXVlc3QuCiAqLwpmdW5jdGlvbiBnZXRVcGRhdGVkQmlsbGluZyhzYXZlZEJpbGxpbmcsIGluaXRpYWxpemUgPSBmYWxzZSkgewoJaWYgKGluaXRpYWxpemUpIHsKCQljb25zdCBuZXdJc28gPSBuZXcgRGF0ZShuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIDUgKiAxMDAwKS50b0lTT1N0cmluZygpOwoJCXNhdmVkQmlsbGluZy5jcmVhdGVkX2F0ID0gbmV3SXNvOwoJCXNhdmVkQmlsbGluZy51cGRhdGVkX2F0ID0gbmV3SXNvOwoJfQoJcmV0dXJuIHNhdmVkQmlsbGluZzsKfQpmdW5jdGlvbiBjcmVhdGVGdWxmaWxsbWVudHMoCglzZXNzaW9uRGF0YSwKCWRlZmF1bHRGdWxmaWxsbWVudHMKKSB7CglpZiAoZGVmYXVsdEZ1bGZpbGxtZW50cy5sZW5ndGggPCAxKSB7CgkJdGhyb3cgbmV3IEVycm9yKCJFbXB0eSBmdWxmaWxsbWVudHMgZm91bmQiKTsKCX0KCWNvbnN0IG9uU2VsZWN0RnVsZmlsbG1lbnRzID0KCQlzZXNzaW9uRGF0YS5vbl9zZWxlY3RfZnVsZmlsbG1lbnRzOwoJCWNvbnN0IGZ1bGZpbGxtZW50cyA9IHNlc3Npb25EYXRhLmZ1bGZpbGxtZW50czsKCQlyZXR1cm4gZnVsZmlsbG1lbnRzLm1hcCgoZikgPT4gewoJCQljb25zdCBvblNlbGVjdEZ1bGZpbGxtZW50ID0gb25TZWxlY3RGdWxmaWxsbWVudHMuZmluZCgKCQkJCShvZikgPT4gb2YuaWQgPT09IGYuaWQKCQkJKTsKCQkJcmV0dXJuIHsKCQkJCWlkOiBmLmlkLAoJCQkJdHlwZTogZi50eXBlLAoJCQkJZW5kOiB7CgkJCQkJY29udGFjdDogZi5lbmQ/LmNvbnRhY3QsCgkJCQkJcGVyc29uOiB7CgkJCQkJCW5hbWU6ICJtb2NrLXBlcnNvbiIsCgkJCQkJfSwKCQkJCQlsb2NhdGlvbjogZi5lbmQ/LmxvY2F0aW9uLAoJCQkJfSwKCQkJCXRyYWNraW5nOiBmLnRyYWNraW5nLAoJCQkJIkBvbmRjL29yZy9jYXRlZ29yeSI6IG9uU2VsZWN0RnVsZmlsbG1lbnQ/LlsiQG9uZGMvb3JnL2NhdGVnb3J5Il0sCgkJCQkiQG9uZGMvb3JnL1RBVCI6IG9uU2VsZWN0RnVsZmlsbG1lbnQ/LlsiQG9uZGMvb3JnL1RBVCJdLAoJCQl9OwoJCX0pOwoJcmV0dXJuIGRlZmF1bHRGdWxmaWxsbWVudHM7Cn0KYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGUoCglkZWZhdWx0UGF5bG9hZCwKCXNlc3Npb25EYXRhCikgewoJY29uc3QgdGltZUlzbyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTsKICBkZWZhdWx0UGF5bG9hZC5tZXNzYWdlLm9yZGVyLmlkID0gZ2VuZXJhdGVTaXhEaWdpdENvZGUoKTsKICBkZWZhdWx0UGF5bG9hZC5tZXNzYWdlLm9yZGVyLmNyZWF0ZWRfYXQgPSB0aW1lSXNvOwogIGRlZmF1bHRQYXlsb2FkLm1lc3NhZ2Uub3JkZXIudXBkYXRlZF9hdCA9IHRpbWVJc287CiAgZGVmYXVsdFBheWxvYWQubWVzc2FnZS5vcmRlci5xdW90ZSA9IHNlc3Npb25EYXRhLnF1b3RlWzBdOwogIGRlZmF1bHRQYXlsb2FkLm1lc3NhZ2Uub3JkZXIuYmlsbGluZyA9IGdldFVwZGF0ZWRCaWxsaW5nKAoJCXNlc3Npb25EYXRhLmJpbGxpbmdbMF0KCSk7CiAgZGVmYXVsdFBheWxvYWQubWVzc2FnZS5vcmRlci5pdGVtcyA9IHNlc3Npb25EYXRhLml0ZW1zOwogIGRlZmF1bHRQYXlsb2FkLm1lc3NhZ2Uub3JkZXIucHJvdmlkZXIgPSBzZXNzaW9uRGF0YS5wcm92aWRlclswXTsKICBkZWZhdWx0UGF5bG9hZC5tZXNzYWdlLm9yZGVyLnBheW1lbnQucGFyYW1zLmFtb3VudCA9CgkJc2Vzc2lvbkRhdGEucXVvdGVbMF0/LnByaWNlPy52YWx1ZTsKICBkZWZhdWx0UGF5bG9hZC5tZXNzYWdlLm9yZGVyLnBheW1lbnQucGFyYW1zLnRyYW5zYWN0aW9uX2lkID0KCQkibW9ja19wYXltZW50X2lkXzEyMyI7CiAgZGVmYXVsdFBheWxvYWQubWVzc2FnZS5vcmRlci5mdWxmaWxsbWVudHMgPSBjcmVhdGVGdWxmaWxsbWVudHMoCgkJc2Vzc2lvbkRhdGEsCiAgICBkZWZhdWx0UGF5bG9hZC5tZXNzYWdlLm9yZGVyLmZ1bGZpbGxtZW50cwoJKTsKICBjb25zdCBleGlzdGluZ1RhZ3MgPSBkZWZhdWx0UGF5bG9hZC5tZXNzYWdlLm9yZGVyLnRhZ3M7Cgljb25zdCBicHBUZXJtcyA9IGV4aXN0aW5nVGFncy5maW5kKChmKSA9PiBmLmNvZGUgPT09ICJicHBfdGVybXMiKTsKCWlmIChicHBUZXJtcykgewoJCWJwcFRlcm1zLmxpc3QgPSBzZXNzaW9uRGF0YS5icHBfdGVybXMubGlzdDsKCX0KCXJldHVybiBkZWZhdWx0UGF5bG9hZDsKfQoKZnVuY3Rpb24gZ2VuZXJhdGVTaXhEaWdpdENvZGUoKSB7CglyZXR1cm4gTWF0aC5mbG9vcigxMDAwMDAgKyBNYXRoLnJhbmRvbSgpICogOTAwMDAwKS50b1N0cmluZygpOwp9
      validate: LyoqCiAqIFZhbGlkYXRlcyB0aGUgaW5jb21pbmcgcmVxdWVzdCBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXRQYXlsb2FkIC0gVGhlIGluY29taW5nIHJlcXVlc3QgcGF5bG9hZCB0byB2YWxpZGF0ZS4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiB2YWxpZGF0ZSh0YXJnZXRQYXlsb2FkLCBzZXNzaW9uRGF0YSkgewogIHJldHVybiB7IHZhbGlkOiB0cnVlLCBjb2RlOiAyMDAsIGRlc2NyaXB0aW9uOiAiVmFsaWQgcmVxdWVzdCIgfTsKfQ==
      requirements: LyoqCiAqIENoZWNrcyBpZiB0aGUgcmVxdWlyZW1lbnRzIGZvciBwcm9jZWVkaW5nIHdpdGggdGhlIEFQSSBjYWxsIGFyZSBtZXQuCiAqIAogKiBAcGFyYW0ge09iamVjdH0gc2Vzc2lvbkRhdGEgLSBEYXRhIGNvbGxlY3RlZCBmcm9tIHByZXZpb3VzIHRyYW5zYWN0aW9uIHN0ZXBzLgogKiAKICogQHJldHVybnMge09iamVjdH0geyB2YWxpZDogYm9vbGVhbiwgY29kZTogbnVtYmVyLCBkZXNjcmlwdGlvbjogc3RyaW5nIH0KICovCi8qKgogKiBDaGVja3MgaWYgdGhlIHJlcXVpcmVtZW50cyBmb3IgcHJvY2VlZGluZyB3aXRoIHRoZSBBUEkgY2FsbCBhcmUgbWV0LgogKiAKICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiBtZWV0UmVxdWlyZW1lbnRzKHNlc3Npb25EYXRhKSB7CiAgLy8gQ2hlY2sgZm9yIHNlbGVjdGVkX2l0ZW1zCiAgaWYgKCFzZXNzaW9uRGF0YS5zZWxlY3RlZF9pdGVtcyB8fCBzZXNzaW9uRGF0YS5zZWxlY3RlZF9pdGVtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBzZWxlY3RlZF9pdGVtcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU0VMRUNURURfSVRFTVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBwYXlsb2FkX2NpdHkKICBpZiAoIXNlc3Npb25EYXRhLnBheWxvYWRfY2l0eSkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHBheWxvYWRfY2l0eSBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUEFZTE9BRF9DSVRZIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3Igc2VsZWN0ZWRfZnVsZmlsbG1lbnRzCiAgaWYgKAogICAgIXNlc3Npb25EYXRhLnNlbGVjdGVkX2Z1bGZpbGxtZW50cyB8fAogICAgc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfZnVsZmlsbG1lbnRzLmxlbmd0aCA9PT0gMAogICkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHNlbGVjdGVkX2Z1bGZpbGxtZW50cyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU0VMRUNURURfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgcHJvdmlkZXIKICBpZiAoIXNlc3Npb25EYXRhLnByb3ZpZGVyKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gcHJvdmlkZXIgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1BST1ZJREVSIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgcXVvdGUKICBpZiAoIXNlc3Npb25EYXRhLnF1b3RlIHx8IHR5cGVvZiBzZXNzaW9uRGF0YS5xdW90ZSAhPT0gIm9iamVjdCIpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBxdW90ZSBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUVVPVEUiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBvbl9zZWxlY3RfZnVsZmlsbG1lbnRzCiAgaWYgKAogICAgIXNlc3Npb25EYXRhLm9uX3NlbGVjdF9mdWxmaWxsbWVudHMgfHwKICAgIHNlc3Npb25EYXRhLm9uX3NlbGVjdF9mdWxmaWxsbWVudHMubGVuZ3RoID09PSAwCiAgKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gb25fc2VsZWN0X2Z1bGZpbGxtZW50cyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfT05fU0VMRUNUX0ZVTEZJTExNRU5UUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9uX3NlbGVjdF9pdGVtcwogIGlmICgKICAgICFzZXNzaW9uRGF0YS5vbl9zZWxlY3RfaXRlbXMgfHwKICAgIHNlc3Npb25EYXRhLm9uX3NlbGVjdF9pdGVtcy5sZW5ndGggPT09IDAKICApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBvbl9zZWxlY3RfaXRlbXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX09OX1NFTEVDVF9JVEVNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHRhdAogIGlmICghc2Vzc2lvbkRhdGEudGF0KSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gdGF0IGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19UQVQiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBpdGVtcwogIGlmICghc2Vzc2lvbkRhdGEuaXRlbXMgfHwgc2Vzc2lvbkRhdGEuaXRlbXMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gaXRlbXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0lURU1TIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgYmlsbGluZwogIGlmICghc2Vzc2lvbkRhdGEuYmlsbGluZyB8fCB0eXBlb2Ygc2Vzc2lvbkRhdGEuYmlsbGluZyAhPT0gIm9iamVjdCIpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBiaWxsaW5nIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19CSUxMSU5HIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgZnVsZmlsbG1lbnRzCiAgaWYgKCFzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHMgfHwgc2Vzc2lvbkRhdGEuZnVsZmlsbG1lbnRzLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIGZ1bGZpbGxtZW50cyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3Igc2VsZWN0ZWRfbnBfZmVlcwogIGlmICghc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfbnBfZmVlcykgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHNlbGVjdGVkX25wX2ZlZXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1NFTEVDVEVEX05QX0ZFRVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBicHBfdGVybXMgKE5FVykKICBpZiAoIXNlc3Npb25EYXRhLmJwcF90ZXJtcyB8fCBzZXNzaW9uRGF0YS5icHBfdGVybXMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gYnBwX3Rlcm1zIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19CUFBfVEVSTVMiLAogICAgfTsKICB9CgogIC8vIEFsbCByZXF1aXJlbWVudHMgc2F0aXNmaWVkCiAgcmV0dXJuIHsKICAgIHZhbGlkOiB0cnVlLAogICAgZGVzY3JpcHRpb246ICJBbGwgQ2hlY2tzIHBhc3NlZCBzdWNjZXNzZnVsbHkiLAogICAgY29kZTogIjIwMCIsCiAgfTsKfQo=
      defaultPayload:
        context:
          domain: ONDC:RETeB2B
          action: confirm
          timestamp: 2025-12-29T08:39:38.573Z
          transaction_id: 3cd7243a-eef8-42e1-8d12-9c76eab6fcea
          message_id: 60f5adb8-cc0b-4954-8742-265b5e03593b
          bap_id: sample-bap-id
          bap_uri: https://bap.example.com
          ttl: PT30S
          bpp_id: sample-bpp-id
          bpp_uri: https://bpp.example.com
          country: IND
          city: "*"
          core_version: 1.2.5
        message:
          order:
            id: O1
            state: Created
            billing:
              address:
                building: my building name or house
                city: Mumbai
                state: Maharashtra
                country: IND
                area_code: "400053"
                locality: my street name
                name: my house or door or floor
              phone: "9898989898"
              name: ONDC buyer
              email: nobody@nomail.com
              created_at: 2024-12-23T07:01:43.145Z
              updated_at: 2024-12-23T07:01:43.145Z
            items:
              - id: I1
                quantity:
                  count: 1
                fulfillment_id: F1
            provider:
              id: P1
              locations:
                - id: L1
            fulfillments:
              - "@ondc/org/category": Standard Delivery
                "@ondc/org/TAT": P2D
                id: F1
                tracking: true
                customer:
                  id: CUST_001
                  organization:
                    descriptor:
                      name: Sharma Kirana Store
                  person:
                    creds:
                      - id: 29AABCU9603R1ZM
                        type: GSTIN
                      - id: AABCU9603R
                        type: PAN
                end:
                  contact:
                    email: nobody@nomail.com
                    phone: "9898989898"
                  person:
                    name: ONDC Buyer
                  location:
                    gps: 19.131140,72.834091
                    address:
                      building: my building name or house
                      city: Mumbai
                      state: Maharashtra
                      country: IND
                      area_code: "400053"
                      locality: my street name
                      name: my house or door or floor
                type: Delivery
            payment:
              params:
                amount: "100.00"
                currency: INR
                transaction_id: order_PjggJp7MccQmAa
              status: PAID
              type: ON-ORDER
              collected_by: BAP
              "@ondc/org/buyer_app_finder_fee_type": percent
              "@ondc/org/buyer_app_finder_fee_amount": "3.0"
              "@ondc/org/settlement_basis": delivery
              "@ondc/org/settlement_window": P1D
              "@ondc/org/withholding_amount": "00.00"
              "@ondc/org/settlement_details":
                - settlement_counterparty: seller-app
                  settlement_phase: sale-amount
                  settlement_type: neft
                  beneficiary_name: xxxx
                  settlement_bank_account_no: xxxx
                  settlement_ifsc_code: xxxx
                  bank_name: xxxx
                  branch_name: xxxx
            quote:
              price:
                currency: INR
                value: "100.00"
              breakup:
                - "@ondc/org/item_id": I1
                  "@ondc/org/item_quantity":
                    count: 1
                  title: Plain Atta
                  "@ondc/org/title_type": item
                  price:
                    currency: INR
                    value: "100"
                  item:
                    price:
                      currency: INR
                      value: "100.00"
                - "@ondc/org/item_id": I1
                  title: Delivery charges
                  "@ondc/org/title_type": delivery
                  price:
                    currency: INR
                    value: "00.00"
                - "@ondc/org/item_id": I1
                  title: Convenience Fee
                  "@ondc/org/title_type": misc
                  price:
                    currency: INR
                    value: "00.00"
              ttl: P1D
            tags:
              - code: bpp_terms
                list:
                  - code: np_type
                    value: MSN
                  - code: tax_number
                    value: np-number
                  - code: provider_tax_number
                    value: PAN_number_of_provider
              - code: bap_terms
                list:
                  - code: accept_bpp_terms
                    value: Y
                  - code: static_terms
                    value: https://github.com/ONDC-Official/NP-Static-Terms/buyerNP_BNP/1.0/tc.pdf
                  - code: tax_number
                    value: 00ABCCH7409R1ZZ
            created_at: 2024-12-23T07:03:30.516Z
            updated_at: 2024-12-23T07:03:30.516Z
      saveData:
        transactionId: $.context.transaction_id
        latestTimestamp: $.context.timestamp
        bapId: $.context.bap_id
        bapUri: $.context.bap_uri
        bppId: $.context.bpp_id
        bppUri: $.context.bpp_uri
        message_id: $.context.message_id
        payment: $.message.order.payment
        order_state: $.message.order.state
        order_created_at: $.message.order.created_at
        bap_terms: $.message.order.tags[?(@.code == 'bap_terms')]
        fulfillments: $.message.order.fulfillments[*]
        order_id: $.message.order.id
      inputs: {}
  - api: on_confirm
    action_id: on_confirm
    owner: BPP
    responseFor: confirm
    unsolicited: false
    description: On-confirm Response to the confirm call
    mock:
      generate: LyoqCiAqIEdlbmVyYXRlcyB0aGUgbW9jayBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgY3VzdG9taXphdGlvbiBvZiB0aGUgZGVmYXVsdCBwYXlsb2FkIHVzaW5nIHNlc3Npb24gZGF0YQogKiBmcm9tIHByZXZpb3VzIHN0ZXBzIGFuZCB1c2VyIGlucHV0cy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSBkZWZhdWx0UGF5bG9hZCAtIFRoZSBiYXNlIHBheWxvYWQgb2JqZWN0IHdpdGggY29udGV4dCBhbHJlYWR5IHBvcHVsYXRlZC4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhLnVzZXJfaW5wdXRzIC0gVXNlci1wcm92aWRlZCBpbnB1dCB2YWx1ZXMgZm9yIHRoaXMgc3RlcC4KICogQHBhcmFtIHsqfSBzZXNzaW9uRGF0YS5ba2V5XSAtIEFueSBzYXZlZCBkYXRhIGZyb20gcHJldmlvdXMgc3RlcHMgKGRlZmluZWQgaW4gc2F2ZURhdGEgY29uZmlnKS4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBnZW5lcmF0ZWQgcGF5bG9hZCBvYmplY3QgdG8gYmUgc2VudCBpbiB0aGUgQVBJIHJlcXVlc3QuCiAqLwpmdW5jdGlvbiBnZXRVcGRhdGVkQmlsbGluZyhzYXZlZEJpbGxpbmcsIGluaXRpYWxpemUgPSBmYWxzZSkgewoJaWYgKGluaXRpYWxpemUpIHsKCQljb25zdCBuZXdJc28gPSBuZXcgRGF0ZShuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIDUgKiAxMDAwKS50b0lTT1N0cmluZygpOwoJCXNhdmVkQmlsbGluZy5jcmVhdGVkX2F0ID0gbmV3SXNvOwoJCXNhdmVkQmlsbGluZy51cGRhdGVkX2F0ID0gbmV3SXNvOwoJfQoJcmV0dXJuIHNhdmVkQmlsbGluZzsKfQpmdW5jdGlvbiBjcmVhdGVGdWxmaWxsbWVudHMoCiAgc2Vzc2lvbkRhdGEsCiAgZGVmYXVsdEZ1bGZpbGxtZW50cwopIHsKICBpZiAoZGVmYXVsdEZ1bGZpbGxtZW50cy5sZW5ndGggPCAxKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIkVtcHR5IGZ1bGZpbGxtZW50cyBmb3VuZCIpOwogIH0KICBjb25zdCBvblNlbGVjdEZ1bGZpbGxtZW50cyA9CiAgICBzZXNzaW9uRGF0YS5vbl9zZWxlY3RfZnVsZmlsbG1lbnRzOwoKICBjb25zdCBmdWxmaWxsbWVudHMgPSBzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHM7CiAgICByZXR1cm4gZnVsZmlsbG1lbnRzCiAgICAgIC5maWx0ZXIoKGYpID0+IG9uU2VsZWN0RnVsZmlsbG1lbnRzLnNvbWUoKHNmKSA9PiBzZi5pZCA9PT0gZi5pZCkpCiAgICAgIC5tYXAoKGYsIGluZGV4KSA9PiB7CiAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPQogICAgICAgICAgb25TZWxlY3RGdWxmaWxsbWVudHMuZmluZCgoc2YpID0+IHNmLmlkID09PSBmLmlkKSB8fCB7fTsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGlkOiBmLmlkLAogICAgICAgICAgdHlwZTogZi50eXBlLAogICAgICAgICAgdHJhY2tpbmc6IGYudHJhY2tpbmcsCiAgICAgICAgICBzdGF0ZTogewogICAgICAgICAgICBkZXNjcmlwdG9yOiB7CiAgICAgICAgICAgICAgY29kZTogIlBlbmRpbmciLAogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgICJAb25kYy9vcmcvVEFUIjogc2VsZWN0ZWRbIkBvbmRjL29yZy9UQVQiXSwKICAgICAgICAgICJAb25kYy9vcmcvcHJvdmlkZXJfbmFtZSI6ICJTdG9yZSAxIiwKICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgIGxvY2F0aW9uOiB7CiAgICAgICAgICAgICAgaWQ6ICJMMSIsCiAgICAgICAgICAgICAgZGVzY3JpcHRvcjogewogICAgICAgICAgICAgICAgbmFtZTogIlN0b3JlIDEiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZ3BzOiAiMTkuMTI5MDc2LDcyLjgyNTgwMyIsCiAgICAgICAgICAgICAgYWRkcmVzczogewogICAgICAgICAgICAgICAgc3RyZWV0OiAiMSAmIDIsQU1BUiBKWU9USSBDSFMuQkxERy4sT1BQLk5BTkQgS1JJUEEgSEFMTCIsCiAgICAgICAgICAgICAgICBsb2NhbGl0eTogIkFOREhFUkkgRk9VUiBCVU5HTE9XIEFNQVIgSllPVEkgQ0hTIiwKICAgICAgICAgICAgICAgIGNpdHk6ICJtb2NrLXNlbGxlci1jaXR5IiwKICAgICAgICAgICAgICAgIHN0YXRlOiAibW9jay1zdGF0ZSIsCiAgICAgICAgICAgICAgICBhcmVhX2NvZGU6ICI0MDAwNTMiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNvbnRhY3Q6IHsKICAgICAgICAgICAgICBwaG9uZTogIjk1OTQ2NjM3MTAiLAogICAgICAgICAgICAgIGVtYWlsOiAibm9ib2R5QG5vbWFpbC5jb20iLAogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIGVuZDogZi5lbmQsCiAgICAgICAgfTsKICAgICAgfSk7CiAgCn0KCmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlKAogIGRlZmF1bHRQYXlsb2FkLAogIHNlc3Npb25EYXRhCikgewogIGNvbnN0IHRpbWVJc28gPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7CiAgZGVmYXVsdFBheWxvYWQubWVzc2FnZS5vcmRlci51cGRhdGVkX2F0ID0gdGltZUlzbzsKICBkZWZhdWx0UGF5bG9hZC5tZXNzYWdlLm9yZGVyLmNyZWF0ZWRfYXQgPSBzZXNzaW9uRGF0YS5vcmRlcl9jcmVhdGVkX2F0WzBdOwogIGRlZmF1bHRQYXlsb2FkLm1lc3NhZ2Uub3JkZXIuaWQgPSBzZXNzaW9uRGF0YS5vcmRlcl9pZFswXTsKICBkZWZhdWx0UGF5bG9hZC5tZXNzYWdlLm9yZGVyLmJpbGxpbmcgPSBnZXRVcGRhdGVkQmlsbGluZygKICAgIHNlc3Npb25EYXRhLmJpbGxpbmdbMF0KICApOwogIGRlZmF1bHRQYXlsb2FkLm1lc3NhZ2Uub3JkZXIuaXRlbXMgPSBzZXNzaW9uRGF0YS5pdGVtczsKICBkZWZhdWx0UGF5bG9hZC5tZXNzYWdlLm9yZGVyLnByb3ZpZGVyID0gc2Vzc2lvbkRhdGEucHJvdmlkZXJbMF07CiAgZGVmYXVsdFBheWxvYWQubWVzc2FnZS5vcmRlci5mdWxmaWxsbWVudHMgPSBjcmVhdGVGdWxmaWxsbWVudHMoCiAgICBzZXNzaW9uRGF0YSwKICAgIGRlZmF1bHRQYXlsb2FkLm1lc3NhZ2Uub3JkZXIuZnVsZmlsbG1lbnRzCiAgKTsKICBkZWZhdWx0UGF5bG9hZC5tZXNzYWdlLm9yZGVyLnF1b3RlID0gc2Vzc2lvbkRhdGEucXVvdGVbMF07CiAgZGVmYXVsdFBheWxvYWQubWVzc2FnZS5vcmRlci5wYXltZW50ID0gc2Vzc2lvbkRhdGEucGF5bWVudFswXTsKICBjb25zdCBleGlzdGluZ1RhZ3MgPSBkZWZhdWx0UGF5bG9hZC5tZXNzYWdlLm9yZGVyLnRhZ3MKICBjb25zdCBiYXBUZXJtcyA9IGV4aXN0aW5nVGFncy5maW5kKChmKSA9PiBmLmNvZGUgPT09ICJiYXBfdGVybXMiKTsKICBpZiAoYmFwVGVybXMpIHsKICAgIGJhcFRlcm1zLmxpc3QgPSBzZXNzaW9uRGF0YS5iYXBfdGVybXNbMF0ubGlzdAogICAgICAuZmlsdGVyKChpKSA9PiBpLmNvZGUgIT09ICJhY2NlcHRfYnBwX3Rlcm1zIikKICAgICAgLm1hcCgoaSkgPT4KICAgICAgICBpLmNvZGUgPT09ICJzdGF0aWNfdGVybXMiCiAgICAgICAgICA/IHsgLi4uaSwgdmFsdWU6ICJodHRwczovL2dpdGh1Yi5jb20vT05EQy1PZmZpY2lhbC9wcm90b2NvbC1uZXR3b3JrLWV4dGVuc2lvbi9kaXNjdXNzaW9ucy83OSIgfQogICAgICAgICAgOiBpCiAgICAgICk7CiAgfQogIGRlZmF1bHRQYXlsb2FkLmNvbnRleHQubWVzc2FnZV9pZCA9IHNlc3Npb25EYXRhLm1lc3NhZ2VfaWRbMF07CiAgcmV0dXJuIGRlZmF1bHRQYXlsb2FkOwp9Cg==
      validate: LyoqCiAqIFZhbGlkYXRlcyB0aGUgaW5jb21pbmcgcmVxdWVzdCBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXRQYXlsb2FkIC0gVGhlIGluY29taW5nIHJlcXVlc3QgcGF5bG9hZCB0byB2YWxpZGF0ZS4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiB2YWxpZGF0ZSh0YXJnZXRQYXlsb2FkLCBzZXNzaW9uRGF0YSkgewogIHJldHVybiB7IHZhbGlkOiB0cnVlLCBjb2RlOiAyMDAsIGRlc2NyaXB0aW9uOiAiVmFsaWQgcmVxdWVzdCIgfTsKfQ==
      requirements: LyoqCiAqIENoZWNrcyBpZiB0aGUgcmVxdWlyZW1lbnRzIGZvciBwcm9jZWVkaW5nIHdpdGggdGhlIEFQSSBjYWxsIGFyZSBtZXQuCiAqIAogKiBAcGFyYW0ge09iamVjdH0gc2Vzc2lvbkRhdGEgLSBEYXRhIGNvbGxlY3RlZCBmcm9tIHByZXZpb3VzIHRyYW5zYWN0aW9uIHN0ZXBzLgogKiAKICogQHJldHVybnMge09iamVjdH0geyB2YWxpZDogYm9vbGVhbiwgY29kZTogbnVtYmVyLCBkZXNjcmlwdGlvbjogc3RyaW5nIH0KICovCi8qKgogKiBDaGVja3MgaWYgdGhlIHJlcXVpcmVtZW50cyBmb3IgcHJvY2VlZGluZyB3aXRoIHRoZSBBUEkgY2FsbCBhcmUgbWV0LgogKiAKICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiBtZWV0UmVxdWlyZW1lbnRzKHNlc3Npb25EYXRhKSB7CiAgLy8gQ2hlY2sgZm9yIHNlbGVjdGVkX2l0ZW1zCiAgaWYgKCFzZXNzaW9uRGF0YS5zZWxlY3RlZF9pdGVtcyB8fCBzZXNzaW9uRGF0YS5zZWxlY3RlZF9pdGVtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBzZWxlY3RlZF9pdGVtcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU0VMRUNURURfSVRFTVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBwYXlsb2FkX2NpdHkKICBpZiAoIXNlc3Npb25EYXRhLnBheWxvYWRfY2l0eSkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHBheWxvYWRfY2l0eSBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUEFZTE9BRF9DSVRZIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3Igc2VsZWN0ZWRfZnVsZmlsbG1lbnRzCiAgaWYgKAogICAgIXNlc3Npb25EYXRhLnNlbGVjdGVkX2Z1bGZpbGxtZW50cyB8fAogICAgc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfZnVsZmlsbG1lbnRzLmxlbmd0aCA9PT0gMAogICkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHNlbGVjdGVkX2Z1bGZpbGxtZW50cyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU0VMRUNURURfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgcHJvdmlkZXIKICBpZiAoIXNlc3Npb25EYXRhLnByb3ZpZGVyKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gcHJvdmlkZXIgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1BST1ZJREVSIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgcXVvdGUKICBpZiAoIXNlc3Npb25EYXRhLnF1b3RlIHx8IHR5cGVvZiBzZXNzaW9uRGF0YS5xdW90ZSAhPT0gIm9iamVjdCIpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBxdW90ZSBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUVVPVEUiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBvbl9zZWxlY3RfZnVsZmlsbG1lbnRzCiAgaWYgKAogICAgIXNlc3Npb25EYXRhLm9uX3NlbGVjdF9mdWxmaWxsbWVudHMgfHwKICAgIHNlc3Npb25EYXRhLm9uX3NlbGVjdF9mdWxmaWxsbWVudHMubGVuZ3RoID09PSAwCiAgKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gb25fc2VsZWN0X2Z1bGZpbGxtZW50cyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfT05fU0VMRUNUX0ZVTEZJTExNRU5UUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9uX3NlbGVjdF9pdGVtcwogIGlmICgKICAgICFzZXNzaW9uRGF0YS5vbl9zZWxlY3RfaXRlbXMgfHwKICAgIHNlc3Npb25EYXRhLm9uX3NlbGVjdF9pdGVtcy5sZW5ndGggPT09IDAKICApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBvbl9zZWxlY3RfaXRlbXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX09OX1NFTEVDVF9JVEVNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHRhdAogIGlmICghc2Vzc2lvbkRhdGEudGF0KSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gdGF0IGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19UQVQiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBpdGVtcwogIGlmICghc2Vzc2lvbkRhdGEuaXRlbXMgfHwgc2Vzc2lvbkRhdGEuaXRlbXMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gaXRlbXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0lURU1TIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgYmlsbGluZwogIGlmICghc2Vzc2lvbkRhdGEuYmlsbGluZyB8fCB0eXBlb2Ygc2Vzc2lvbkRhdGEuYmlsbGluZyAhPT0gIm9iamVjdCIpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBiaWxsaW5nIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19CSUxMSU5HIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgZnVsZmlsbG1lbnRzCiAgaWYgKCFzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHMgfHwgc2Vzc2lvbkRhdGEuZnVsZmlsbG1lbnRzLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIGZ1bGZpbGxtZW50cyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3Igc2VsZWN0ZWRfbnBfZmVlcwogIGlmICghc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfbnBfZmVlcykgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHNlbGVjdGVkX25wX2ZlZXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1NFTEVDVEVEX05QX0ZFRVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBicHBfdGVybXMKICBpZiAoIXNlc3Npb25EYXRhLmJwcF90ZXJtcyB8fCBzZXNzaW9uRGF0YS5icHBfdGVybXMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gYnBwX3Rlcm1zIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19CUFBfVEVSTVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBvcmRlcl9pZCAoTkVXKQogIGlmICghc2Vzc2lvbkRhdGEub3JkZXJfaWQpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBvcmRlcl9pZCBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfT1JERVJfSUQiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBiYXBfdGVybXMgKE5FVykKICBpZiAoIXNlc3Npb25EYXRhLmJhcF90ZXJtcyB8fCBzZXNzaW9uRGF0YS5iYXBfdGVybXMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gYmFwX3Rlcm1zIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19CQVBfVEVSTVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBzdGF0ZSAoTkVXKQogIGlmICghc2Vzc2lvbkRhdGEuc3RhdGUpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBzdGF0ZSBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU1RBVEUiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBwYXltZW50IChORVcpCiAgaWYgKCFzZXNzaW9uRGF0YS5wYXltZW50IHx8IHR5cGVvZiBzZXNzaW9uRGF0YS5wYXltZW50ICE9PSAib2JqZWN0IikgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHBheW1lbnQgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1BBWU1FTlQiLAogICAgfTsKICB9CgogIC8vIEFsbCByZXF1aXJlbWVudHMgc2F0aXNmaWVkCiAgcmV0dXJuIHsKICAgIHZhbGlkOiB0cnVlLAogICAgZGVzY3JpcHRpb246ICJBbGwgQ2hlY2tzIHBhc3NlZCBzdWNjZXNzZnVsbHkiLAogICAgY29kZTogIjIwMCIsCiAgfTsKfQo=
      defaultPayload:
        context:
          domain: ONDC:RETeB2B
          action: on_confirm
          timestamp: 2025-12-29T08:51:49.239Z
          transaction_id: 3cd7243a-eef8-42e1-8d12-9c76eab6fcea
          message_id: 2280275d-5d9a-413c-8c83-6ddc1db4e761
          bap_id: sample-bap-id
          bap_uri: https://bap.example.com
          ttl: PT30S
          bpp_id: sample-bpp-id
          bpp_uri: https://bpp.example.com
          country: IND
          city: "*"
          core_version: 1.2.5
        message:
          order:
            id: O1
            state: Created
            provider:
              id: P1
              locations:
                - id: L1
            items:
              - id: I1
                quantity:
                  count: 1
                fulfillment_id: F1
            billing:
              address:
                building: my building name or house
                city: Mumbai
                state: Maharashtra
                country: IND
                area_code: "400053"
                locality: my street name
                name: my house or door or floor
              phone: "9898989898"
              name: ONDC buyer
              email: nobody@nomail.com
              created_at: 2024-12-23T07:01:43.145Z
              updated_at: 2024-12-23T07:01:43.145Z
            fulfillments:
              - id: F1
                "@ondc/org/provider_name": Store 1
                state:
                  descriptor:
                    code: Pending
                customer:
                  id: CUST_001
                  organization:
                    descriptor:
                      name: Sharma Kirana Store
                  person:
                    creds:
                      - id: 29AABCU9603R1ZM
                        type: GSTIN
                      - id: AABCU9603R
                        type: PAN
                type: Delivery
                tracking: true
                "@ondc/org/TAT": PT60M
                start:
                  location:
                    id: L1
                    descriptor:
                      name: ABC Store
                    gps: 19.129076,72.825803
                    address:
                      building: my building name or house
                      city: Mumbai
                      state: Maharashtra
                      country: IND
                      area_code: "400053"
                      locality: my street name
                      name: my house or door or floor
                  time:
                    range:
                      start: 2024-12-23T07:03:32.230Z
                      end: 2024-12-23T07:08:32.230Z
                  contact:
                    phone: "9594663710"
                    email: nobody@nomail.com
                end:
                  person:
                    name: John Doe
                  contact:
                    email: nobody@nomail.com
                    phone: "9898989898"
                  location:
                    gps: 19.131140,72.834091
                    address:
                      building: my building name or house
                      city: Mumbai
                      state: Maharashtra
                      country: IND
                      area_code: "400053"
                      locality: my street name
                      name: my house or door or floor
                  time:
                    range:
                      start: 2024-12-23T07:33:32.230Z
                      end: 2024-12-23T07:04:32.230Z
            quote:
              price:
                currency: INR
                value: "100.00"
              breakup:
                - "@ondc/org/item_id": I1
                  "@ondc/org/item_quantity":
                    count: 1
                  title: Plain Atta
                  "@ondc/org/title_type": item
                  price:
                    currency: INR
                    value: "100"
                  item:
                    price:
                      currency: INR
                      value: "100.00"
                - "@ondc/org/item_id": I1
                  title: Delivery charges
                  "@ondc/org/title_type": delivery
                  price:
                    currency: INR
                    value: "00.00"
                - "@ondc/org/item_id": I1
                  title: Convenience Fee
                  "@ondc/org/title_type": misc
                  price:
                    currency: INR
                    value: "00.00"
              ttl: P1D
            payment:
              params:
                amount: "100.00"
                currency: INR
                transaction_id: order_PjggJp7MccQmAa
              status: PAID
              type: ON-ORDER
              collected_by: BAP
              "@ondc/org/buyer_app_finder_fee_type": percent
              "@ondc/org/buyer_app_finder_fee_amount": "3.0"
              "@ondc/org/settlement_details":
                - settlement_counterparty: seller-app
                  settlement_phase: sale-amount
                  settlement_type: neft
                  beneficiary_name: xxxx
                  settlement_bank_account_no: xxxx
                  settlement_ifsc_code: xxxx
                  bank_name: xxxx
                  branch_name: xxxx
            tags:
              - code: bpp_terms
                list:
                  - code: np_type
                    value: MSN
                  - code: tax_number
                    value: 00ABCCH7409R1ZZ
                  - code: provider_tax_number
                    value: ABCDE1234F
                  - code: accept_bap_terms
                    value: Y
              - code: bap_terms
                list:
                  - code: static_terms
                    value: https://github.com/ONDC-Official/protocol-network-extension/discussions/79
                  - code: tax_number
                    value: gst_number_of_buyerNP
            created_at: 2024-12-23T07:03:30.516Z
            updated_at: 2024-12-23T07:03:32.230Z
      saveData:
        transactionId: $.context.transaction_id
        latestMessage_id: $.context.message_id
        latestTimestamp: $.context.timestamp
        bapId: $.context.bap_id
        bapUri: $.context.bap_uri
        bppId: $.context.bpp_id
        bppUri: $.context.bpp_uri
        order_state: $.message.order.state
        fulfillments: $.message.order.fulfillments[*]
      inputs: {}
  - api: on_update
    action_id: on_update_part_cancel
    owner: BPP
    responseFor: null
    unsolicited: true
    description: please add relevant description
    mock:
      generate: Y29uc3QgYnJlYWt1cEl0ZW0gPSB7CgkiQG9uZGMvb3JnL2l0ZW1faWQiOiAiSTEiLAoJIkBvbmRjL29yZy9pdGVtX3F1YW50aXR5IjogewoJCWNvdW50OiAxLAoJfSwKCXRpdGxlOiAiUGxhaW4gQXR0YSIsCgkiQG9uZGMvb3JnL3RpdGxlX3R5cGUiOiAiaXRlbSIsCglwcmljZTogewoJCWN1cnJlbmN5OiAiSU5SIiwKCQl2YWx1ZTogIjEwMC4wMCIsCgl9LAoJaXRlbTogewoJCXF1YW50aXR5OiB7CgkJCWF2YWlsYWJsZTogewoJCQkJY291bnQ6ICI5OSIsCgkJCX0sCgkJCW1heGltdW06IHsKCQkJCWNvdW50OiAiOTkiLAoJCQl9LAoJCX0sCgkJcHJpY2U6IHsKCQkJY3VycmVuY3k6ICJJTlIiLAoJCQl2YWx1ZTogIjEwMC4wMCIsCgkJfSwKCX0sCn07CmNvbnN0IGJyZWFrdXAgPSBbCgl7CgkJIkBvbmRjL29yZy9pdGVtX2lkIjogIkYxIiwKCQl0aXRsZTogIkRlbGl2ZXJ5IGNoYXJnZXMiLAoJCSJAb25kYy9vcmcvdGl0bGVfdHlwZSI6ICJkZWxpdmVyeSIsCgkJcHJpY2U6IHsKCQkJY3VycmVuY3k6ICJJTlIiLAoJCQl2YWx1ZTogIjAwLjAwIiwKCQl9LAoJfSwKCXsKCQkiQG9uZGMvb3JnL2l0ZW1faWQiOiAiRjEiLAoJCXRpdGxlOiAiQ29udmVuaWVuY2UgRmVlIiwKCQkiQG9uZGMvb3JnL3RpdGxlX3R5cGUiOiAibWlzYyIsCgkJcHJpY2U6IHsKCQkJY3VycmVuY3k6ICJJTlIiLAoJCQl2YWx1ZTogIjAwLjAwIiwKCQl9LAoJfSwKXTsKY29uc3QgbnBGZWVzYnJlYWt1cCA9IFsKCXsKCQkiQG9uZGMvb3JnL2l0ZW1faWQiOiAiSTEiLAoJCXRpdGxlOiAiQ29udmVuaWVuY2UgRmVlIiwKCQkiQG9uZGMvb3JnL3RpdGxlX3R5cGUiOiAibWlzYyIsCgkJInByaWNlIjogewoJCQkiY3VycmVuY3kiOiAiSU5SIiwKCQkJInZhbHVlIjogIjAuNTAiCgkJfSwKCQkiaXRlbSI6IHsKCQkJInRhZ3MiOiBbCgkJCQl7CgkJCQkJImNvZGUiOiAicXVvdGUiLAoJCQkJCSJsaXN0IjogWwoJCQkJCQl7ICJjb2RlIjogInR5cGUiLCAidmFsdWUiOiAiaXRlbSIgfQoJCQkJCV0KCQkJCX0sCgkJCQl7CgkJCQkJImNvZGUiOiAibnBfZmVlcyIsCgkJCQkJImxpc3QiOiBbCgkJCQkJCXsgImNvZGUiOiAiaWQiLCAidmFsdWUiOiAiMSIgfSwKCQkJCQkJeyAiY29kZSI6ICJjaGFubmVsX21hcmdpbl90eXBlIiwgInZhbHVlIjogInBlcmNlbnQiIH0sCgkJCQkJCXsgImNvZGUiOiAiY2hhbm5lbF9tYXJnaW5fdmFsdWUiLCAidmFsdWUiOiAiMC41MCIgfQoJCQkJCV0KCQkJCX0KCQkJXQoJCX0KCX0sCgl7CgkJIkBvbmRjL29yZy9pdGVtX2lkIjogIkkxIiwKCQl0aXRsZTogIkNvbnZlbmllbmNlIEZlZSIsCgkJIkBvbmRjL29yZy90aXRsZV90eXBlIjogIm1pc2MiLAoJCSJwcmljZSI6IHsKCQkJImN1cnJlbmN5IjogIklOUiIsCgkJCSJ2YWx1ZSI6ICI3LjAwIgoJCX0sCgkJIml0ZW0iOiB7CgkJCSJ0YWdzIjogWwoJCQkJewoJCQkJCSJjb2RlIjogInF1b3RlIiwKCQkJCQkibGlzdCI6IFsKCQkJCQkJeyAiY29kZSI6ICJ0eXBlIiwgInZhbHVlIjogIml0ZW0iIH0KCQkJCQldCgkJCQl9LAoJCQkJewoJCQkJCSJjb2RlIjogIm5wX2ZlZXMiLAoJCQkJCSJsaXN0IjogWwoJCQkJCQl7ICJjb2RlIjogImlkIiwgInZhbHVlIjogIjIiIH0sCgkJCQkJCXsgImNvZGUiOiAiY2hhbm5lbF9tYXJnaW5fdHlwZSIsICJ2YWx1ZSI6ICJhbW91bnQiIH0sCgkJCQkJCXsgImNvZGUiOiAiY2hhbm5lbF9tYXJnaW5fdmFsdWUiLCAidmFsdWUiOiAiNy4wMCIgfQoJCQkJCV0KCQkJCX0KCQkJXQoJCX0KCX0sCgl7CgkJIkBvbmRjL29yZy9pdGVtX2lkIjogIkkxIiwKCQl0aXRsZTogIlRheCIsCgkJIkBvbmRjL29yZy90aXRsZV90eXBlIjogInRheCIsCgkJInByaWNlIjogewoJCQkiY3VycmVuY3kiOiAiSU5SIiwKCQkJInZhbHVlIjogIjAuMDkiCgkJfSwKCQkiaXRlbSI6IHsKCQkJInRhZ3MiOiBbCgkJCQl7CgkJCQkJImNvZGUiOiAicXVvdGUiLAoJCQkJCSJsaXN0IjogWwoJCQkJCQl7ICJjb2RlIjogInR5cGUiLCAidmFsdWUiOiAiaXRlbSIgfSwKCQkJCQkJeyAiY29kZSI6ICJzdWJ0eXBlIiwgInZhbHVlIjogIm1pc2MiIH0KCQkJCQldCgkJCQl9LAoJCQkJewoJCQkJCSJjb2RlIjogIm5wX2ZlZXMiLAoJCQkJCSJsaXN0IjogWwoJCQkJCQl7ICJjb2RlIjogImlkIiwgInZhbHVlIjogIjEiIH0KCQkJCQldCgkJCQl9CgkJCV0KCQl9Cgl9LAoJewoJCSJAb25kYy9vcmcvaXRlbV9pZCI6ICJJMSIsCgkJdGl0bGU6ICJUYXgiLAoJCSJAb25kYy9vcmcvdGl0bGVfdHlwZSI6ICJ0YXgiLAoJCSJwcmljZSI6IHsKCQkJImN1cnJlbmN5IjogIklOUiIsCgkJCSJ2YWx1ZSI6ICIxLjI2IgoJCX0sCgkJIml0ZW0iOiB7CgkJCSJ0YWdzIjogWwoJCQkJewoJCQkJCSJjb2RlIjogInF1b3RlIiwKCQkJCQkibGlzdCI6IFsKCQkJCQkJeyAiY29kZSI6ICJ0eXBlIiwgInZhbHVlIjogIml0ZW0iIH0sCgkJCQkJCXsgImNvZGUiOiAic3VidHlwZSIsICJ2YWx1ZSI6ICJtaXNjIiB9CgkJCQkJXQoJCQkJfSwKCQkJCXsKCQkJCQkiY29kZSI6ICJucF9mZWVzIiwKCQkJCQkibGlzdCI6IFsKCQkJCQkJeyAiY29kZSI6ICJpZCIsICJ2YWx1ZSI6ICIyIiB9CgkJCQkJXQoJCQkJfQoJCQldCgkJfQoJfQpdCgpmdW5jdGlvbiBnZXRSYW5kb21JdGVtKGl0ZW1zKSB7CmlmICghQXJyYXkuaXNBcnJheShpdGVtcykgfHwgaXRlbXMubGVuZ3RoID09PSAwKSB7CglyZXR1cm4gbnVsbDsKfQogIGNvbnN0IHJhbmRvbUluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogaXRlbXMubGVuZ3RoKTsKICByZXR1cm4gaXRlbXNbcmFuZG9tSW5kZXhdOwp9CmZ1bmN0aW9uIGNyZWF0ZVF1b3RlKAogIHNlbGVjdGVkSXRlbXMsCiAgc2Vzc2lvbkRhdGEsCiAgZXhpc3RpbmdQYXlsb2FkLAogIGZ1bGZpbGxtZW50cywKICBjYW5jZWxsZWQKKSB7CgogIGxldCB0b3RhbFByaWNlID0gMDsKICBsZXQgdG90YWxRdWFudGl0eSA9IDA7CiAgbGV0IGl0ZW1TZXQgPSBuZXcgU2V0ICgpOwogIGNvbnN0IGJyZWFrdXBPYmplY3QgPSBbXTsKICBjb25zdCBjYXRhbG9nSXRlbXMgPSBzZXNzaW9uRGF0YS5SRVQxMENhdGFsb2cuY2F0YWxvZ1sKICAgICJicHAvcHJvdmlkZXJzIgogIF1bMF0uaXRlbXMuZmlsdGVyKChpKSA9PiB7CiAgICBjb25zdCBpZE1hcCA9IHNlbGVjdGVkSXRlbXMubWFwKChpdGVtKSA9PiBpdGVtLmlkKTsKICAgIHJldHVybiBpZE1hcC5pbmNsdWRlcyhpLmlkKTsKICB9KTsKCiAgZm9yIChjb25zdCBzZWxlY3RlZEl0ZW0gb2Ygc2VsZWN0ZWRJdGVtcyA/PyBbXSkgewogICAgY29uc3QgZnVsZmlsbG1lbnQgPSBmdWxmaWxsbWVudHMuZmluZCgKICAgICAgKGYpID0+IGYuaWQgPT09IHNlbGVjdGVkSXRlbS5mdWxmaWxsbWVudF9pZAogICAgKTsKICAgIGlmICgKICAgICAgIWZ1bGZpbGxtZW50IHx8CiAgICAgICFbIkRlbGl2ZXJ5IiwgIlNlbGYtUGlja3VwIiwgIkJ1eWVyLURlbGl2ZXJ5Il0uaW5jbHVkZXMoCiAgICAgICAgZnVsZmlsbG1lbnQudHlwZSA/PyAiIgogICAgICApCiAgICApIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBjb25zdCBjYXRhbG9nSXRlbSA9IGNhdGFsb2dJdGVtcy5maW5kKChpKSA9PiBpLmlkID09PSBzZWxlY3RlZEl0ZW0uaWQpOwogICAgaWYgKCFjYXRhbG9nSXRlbSkgY29udGludWU7IC8vIFNraXAgaWYgaXRlbSBub3QgZm91bmQgaW4gY2F0YWxvZwoKICAgIGNvbnN0IHF1YW50aXR5ID0gY2FuY2VsbGVkID8gMCA6IHNlbGVjdGVkSXRlbS5jb3VudCA/PyAxOwogICAgY29uc3QgcHJpY2UgPSBwYXJzZUZsb2F0KGNhdGFsb2dJdGVtLnByaWNlLnZhbHVlKSAqIHF1YW50aXR5OwogICAgdG90YWxQcmljZSArPSBwcmljZTsKCiAgICBjb25zdCBicmVha3VwQ2xvbmUgPSBKU09OLnBhcnNlKAogICAgICBKU09OLnN0cmluZ2lmeShicmVha3VwSXRlbSkKICAgICkKICAgIGJyZWFrdXBDbG9uZVsiQG9uZGMvb3JnL2l0ZW1faWQiXSA9IGNhdGFsb2dJdGVtLmlkOwogICAgYnJlYWt1cENsb25lLnRpdGxlID0gY2F0YWxvZ0l0ZW0uZGVzY3JpcHRvci5uYW1lOwogICAgYnJlYWt1cENsb25lWyJAb25kYy9vcmcvaXRlbV9xdWFudGl0eSJdLmNvdW50ID0gcXVhbnRpdHk7CiAgICBicmVha3VwQ2xvbmUucHJpY2UudmFsdWUgPSBgJHtwcmljZS50b0ZpeGVkKDIpfWA7CiAgICBicmVha3VwQ2xvbmUuaXRlbS5wcmljZS52YWx1ZSA9IGNhdGFsb2dJdGVtLnByaWNlLnZhbHVlOwogICAgYnJlYWt1cE9iamVjdC5wdXNoKGJyZWFrdXBDbG9uZSk7CgogICAgaWYgKHNlc3Npb25EYXRhLm91dF9vZl9zdG9ja19pdGVtX2lkcz8uaW5jbHVkZXMoY2F0YWxvZ0l0ZW0uaWQpKSB7CiAgICAgIGJyZWFrdXBDbG9uZS5pdGVtLnF1YW50aXR5LmF2YWlsYWJsZS5jb3VudCA9ICIwIjsKICAgICAgYnJlYWt1cENsb25lLml0ZW0ucXVhbnRpdHkubWF4aW11bS5jb3VudCA9ICIwIjsKICAgICAgYnJlYWt1cENsb25lWyJAb25kYy9vcmcvdGl0bGVfdHlwZSJdID0gIml0ZW0iOwogICAgICBleGlzdGluZ1BheWxvYWQuZXJyb3IgPSB7CiAgICAgICAgdHlwZTogIkRPTUFJTi1FUlJPUiIsCiAgICAgICAgY29kZTogIjQwMDAyIiwKICAgICAgICBtZXNzYWdlOiBgSXRlbSB3aXRoIGlkOiAke2NhdGFsb2dJdGVtLmlkfSBpcyBvdXQgb2Ygc3RvY2tgLAogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgdG90YWxRdWFudGl0eSArPSBzZWxlY3RlZEl0ZW0uY291bnQgPz8gMDsKICAgICAgaWYgKHF1YW50aXR5ID4gMCkgaXRlbVNldC5hZGQoY2F0YWxvZ0l0ZW0uaWQpOwogICAgfQoKICAgIGlmIChzZXNzaW9uRGF0YS5zZWFyY2hfYmFwX3Rlcm1zPy5saXN0Py5zb21lKCh0KSA9PiB0LmNvZGUgPT09ICIwMEEiKSkgewogICAgICBmb3IgKGNvbnN0IGZlZSBvZiBucEZlZXNicmVha3VwKSB7CiAgICAgICAgY29uc3QgZmVlQ2xvbmUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGZlZSkpOwogICAgICAgIGZlZUNsb25lWyJAb25kYy9vcmcvaXRlbV9pZCJdID0gY2F0YWxvZ0l0ZW0uaWQ7CiAgICAgICAgYnJlYWt1cE9iamVjdC5wdXNoKGZlZUNsb25lKTsKICAgICAgICB0b3RhbFByaWNlICs9IHBhcnNlRmxvYXQoZmVlQ2xvbmUucHJpY2UudmFsdWUgPz8gIjAiKTsKICAgICAgfQogICAgfQogIH0KCiAgYnJlYWt1cE9iamVjdC5wdXNoKGJyZWFrdXBbMF0pOwogIGJyZWFrdXBPYmplY3QucHVzaChicmVha3VwWzFdKTsKICBpZiAoc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfb2ZmZXJzICYmIHNlc3Npb25EYXRhLnNlbGVjdGVkX29mZmVycy5sZW5ndGggPiAwKSB7CiAgICBsZXQgb2ZmZXJRdW90ZSA9CiAgICAgIG9mZmVyUXVvdGVzWwogICAgICBzZXNzaW9uRGF0YS5zZWxlY3RlZF9vZmZlcnNbMF0uaWQKICAgICAgXTsKCiAgICBjb25zdCBvZmZlcklkID0gc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfb2ZmZXJzWzBdLmlkOwoKICAgIGlmIChvZmZlcklkID09PSAiRkxBVDUwIiAmJiB0b3RhbFF1YW50aXR5ID4gMCkgewogICAgICBicmVha3VwT2JqZWN0LnB1c2gob2ZmZXJRdW90ZSk7CiAgICAgIGxldCBvZmZlclByaWNlID0gcGFyc2VGbG9hdChvZmZlclF1b3RlLnByaWNlLnZhbHVlKTsKICAgICAgaWYgKGNhbmNlbGxlZCkgb2ZmZXJQcmljZSA9IDA7CiAgICAgIHRvdGFsUHJpY2UgKz0gb2ZmZXJQcmljZTsKICAgIH0gZWxzZSBpZiAob2ZmZXJJZCA9PT0gImNvbWJvMSIgJiYgaXRlbVNldC5zaXplID49IDMpIHsKICAgICAgYnJlYWt1cE9iamVjdC5wdXNoKG9mZmVyUXVvdGUpOwogICAgICBsZXQgb2ZmZXJQcmljZSA9IHBhcnNlRmxvYXQob2ZmZXJRdW90ZS5wcmljZS52YWx1ZSk7CiAgICAgIGlmIChjYW5jZWxsZWQpIG9mZmVyUHJpY2UgPSAwOwogICAgICB0b3RhbFByaWNlICs9IG9mZmVyUHJpY2U7CiAgICB9IGVsc2UgaWYgKAogICAgICBvZmZlcklkID09PSAiYnV5MmdldDMiICYmCiAgICAgIHRvdGFsUXVhbnRpdHkgPj0gMiAmJgogICAgICAhc2Vzc2lvbkRhdGEub3V0X29mX3N0b2NrX2l0ZW1faWRzPy5pbmNsdWRlcygiSTIiKQogICAgKSB7CiAgICAgIGlmIChjYW5jZWxsZWQpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBvZmZlclF1b3RlWyJAb25kYy9vcmcvaXRlbV9xdWFudGl0eSJdID0gewogICAgICAgICAgY291bnQ6IDAsCiAgICAgICAgfTsKICAgICAgfQogICAgICBicmVha3VwT2JqZWN0LnB1c2gob2ZmZXJRdW90ZSk7CiAgICB9CiAgfQogIHJldHVybiB7CiAgICBicmVha3VwOiBicmVha3VwT2JqZWN0LAogICAgcHJpY2U6IHsKICAgICAgY3VycmVuY3k6ICJJTlIiLAogICAgICB2YWx1ZTogYCR7dG90YWxQcmljZS50b0ZpeGVkKDIpfWAsCiAgICB9LAogICAgdHRsOiAiUDFEIiwKICB9Owp9CmNvbnN0IGNhbmNlbEZ1bGZpbGxtZW50ID0gewoJaWQ6ICJwYXJ0X2NhbmNlbF9pZF8xMjM5MSIsCgl0eXBlOiAiQ2FuY2VsIiwKCXN0YXRlOiB7CgkJZGVzY3JpcHRvcjogewoJCQljb2RlOiAiQ2FuY2VsbGVkIiwKCQl9LAoJfSwKCXRhZ3M6IFsKCQl7CgkJCWNvZGU6ICJjYW5jZWxfcmVxdWVzdCIsCgkJCWxpc3Q6IFsKCQkJCXsKCQkJCQljb2RlOiAicmVhc29uX2lkIiwKCQkJCQl2YWx1ZTogIjAwMiIsCgkJCQl9LAoJCQkJewoJCQkJCWNvZGU6ICJpbml0aWF0ZWRfYnkiLAoJCQkJCXZhbHVlOiAic2VsbGVyTlAuY29tIiwKCQkJCX0sCgkJCV0sCgkJfSwKCQl7CgkJCWNvZGU6ICJxdW90ZV90cmFpbCIsCgkJCWxpc3Q6IFsKCQkJCXsKCQkJCQljb2RlOiAidHlwZSIsCgkJCQkJdmFsdWU6ICJpdGVtIiwKCQkJCX0sCgkJCQl7CgkJCQkJY29kZTogImlkIiwKCQkJCQl2YWx1ZTogIm9jXzcyIiwKCQkJCX0sCgkJCQl7CgkJCQkJY29kZTogImN1cnJlbmN5IiwKCQkJCQl2YWx1ZTogIklOUiIsCgkJCQl9LAoJCQkJewoJCQkJCWNvZGU6ICJ2YWx1ZSIsCgkJCQkJdmFsdWU6ICItNTAwIiwKCQkJCX0sCgkJCV0sCgkJfSwKCV0sCn07Cgphc3luYyBmdW5jdGlvbiBnZW5lcmF0ZSgKCWV4aXN0aW5nUGF5bG9hZCwKCXNlc3Npb25EYXRhCikgewoJZXhpc3RpbmdQYXlsb2FkLm1lc3NhZ2Uub3JkZXIuaWQgPSBzZXNzaW9uRGF0YS5vcmRlcl9pZFswXTsKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLnByb3ZpZGVyID0gc2Vzc2lvbkRhdGEucHJvdmlkZXJbMF07CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5iaWxsaW5nID0gc2Vzc2lvbkRhdGEuYmlsbGluZ1swXTsKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLnBheW1lbnQgPSBzZXNzaW9uRGF0YS5wYXltZW50WzBdOwoJZXhpc3RpbmdQYXlsb2FkLm1lc3NhZ2Uub3JkZXIuY3JlYXRlZF9hdCA9IHNlc3Npb25EYXRhLm9yZGVyX2NyZWF0ZWRfYXRbMF07CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci51cGRhdGVkX2F0ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpOwoKCWNvbnN0IGl0ZW1zSWRzID0gc2Vzc2lvbkRhdGEuaXRlbXMubWFwKChpdGVtKSA9PiBpdGVtLmlkKTsKCWNvbnN0IGNhbmNlbElkID0gZ2V0UmFuZG9tSXRlbShpdGVtc0lkcykgfHwgIkkxIjsKCWNvbnN0IGNhbmNlbEl0ZW0gPSBzZXNzaW9uRGF0YS5pdGVtcy5maW5kKAoJCShpdGVtKSA9PiBpdGVtLmlkID09PSBjYW5jZWxJZAoJKTsKCWNvbnN0IGNvcHlJdGVtID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjYW5jZWxJdGVtKSk7Cgljb3B5SXRlbS5mdWxmaWxsbWVudF9pZCA9IGNhbmNlbEZ1bGZpbGxtZW50LmlkOwoJc2Vzc2lvbkRhdGEuaXRlbXMucHVzaChjb3B5SXRlbSk7CgljYW5jZWxJdGVtLnF1YW50aXR5LmNvdW50ID0gMDsKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLml0ZW1zID0gc2Vzc2lvbkRhdGEuaXRlbXM7CgljYW5jZWxGdWxmaWxsbWVudC50YWdzWzBdLmxpc3RbMV0udmFsdWUgPSBleGlzdGluZ1BheWxvYWQuY29udGV4dC5icHBfaWQ7CgljYW5jZWxGdWxmaWxsbWVudC50YWdzWzFdLmxpc3RbMV0udmFsdWUgPSBjYW5jZWxJZDsKCWxldCBpdGVtUXVvdGUgPSBzZXNzaW9uRGF0YS5xdW90ZVswXS5icmVha3VwLmZpbmQoCgkJKGIpID0+IGJbIkBvbmRjL29yZy9pdGVtX2lkIl0gPT09IGNhbmNlbElkCgkpOwoJbGV0IHByaWNlID0gaXRlbVF1b3RlLnByaWNlLnZhbHVlOwoJY2FuY2VsRnVsZmlsbG1lbnQudGFnc1sxXS5saXN0WzNdLnZhbHVlID0gIi0iICsgcHJpY2U7Cgljb25zdCBmdWxmaWxsbWVudHMgPSBzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHM7CglmdWxmaWxsbWVudHMucHVzaChjYW5jZWxGdWxmaWxsbWVudCk7CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5mdWxmaWxsbWVudHMgPSBmdWxmaWxsbWVudHM7CgoJY29uc3QgbmV3SXRlbXMgPSBzZXNzaW9uRGF0YS5pdGVtcwoJCS8vIC5maWx0ZXIoKGl0ZW06IGFueSkgPT4gaXRlbS5pZCAhPT0gY2FuY2VsSWQpCgkJLm1hcCgoaXRlbSkgPT4gewoJCQlyZXR1cm4gewoJCQkJaWQ6IGl0ZW0uaWQsCgkJCQljb3VudDogaXRlbS5pZCA9PT0gY2FuY2VsSWQgPyAwIDogaXRlbS5xdWFudGl0eS5jb3VudCwKCQkJCWZ1bGZpbGxtZW50X2lkOiBpdGVtLmZ1bGZpbGxtZW50X2lkLAoJCQl9OwoJCX0pOwoKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLnF1b3RlID0gY3JlYXRlUXVvdGUoCgkJbmV3SXRlbXMsCgkJc2Vzc2lvbkRhdGEsCgkJZXhpc3RpbmdQYXlsb2FkLAoJCWZ1bGZpbGxtZW50cwoJKTsKCWNvbnN0IG9mZmVyT2JqZWN0cyA9IGdldE9mZmVyT2JqZWN0cyhzZXNzaW9uRGF0YSwgbmV3SXRlbXMpOwoJaWYgKG9mZmVyT2JqZWN0cz8ubGVuZ3RoID4gMCkgewoJCWNhbmNlbEZ1bGZpbGxtZW50LnRhZ3MucHVzaChvZmZlck9iamVjdHNbMF0pOwoJCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLnF1b3RlLmJyZWFrdXAucHVzaChvZmZlck9iamVjdHNbMV0pOwoJfQoJcmV0dXJuIGV4aXN0aW5nUGF5bG9hZDsKfQoKZnVuY3Rpb24gZ2V0T2ZmZXJPYmplY3RzKAoJc2Vzc2lvbkRhdGEsCgluZXdJdGVtcwopIHsKCWlmICghc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfb2ZmZXJzKSByZXR1cm4gW107Cgljb25zdCBvZmZlcklkID0gc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfb2ZmZXJzWzBdPy5pZCA/PyAiIjsKCglpZiAob2ZmZXJJZCA9PT0gIkZMQVQ1MCIpIHsKCQlyZXR1cm4gW107Cgl9CglpZiAob2ZmZXJJZCA9PT0gImNvbWJvMSIpIHsKCQlyZXR1cm4gWwoJCQl7CgkJCQljb2RlOiAicXVvdGVfdHJhaWwiLAoJCQkJbGlzdDogWwoJCQkJCXsKCQkJCQkJY29kZTogInR5cGUiLAoJCQkJCQl2YWx1ZTogIm9mZmVyIiwKCQkJCQl9LAoJCQkJCXsKCQkJCQkJY29kZTogImlkIiwKCQkJCQkJdmFsdWU6ICJjb21ibzEiLAoJCQkJCX0sCgkJCQkJewoJCQkJCQljb2RlOiAiY3VycmVuY3kiLAoJCQkJCQl2YWx1ZTogIklOUiIsCgkJCQkJfSwKCQkJCQl7CgkJCQkJCWNvZGU6ICJ2YWx1ZSIsCgkJCQkJCXZhbHVlOiAiNzUuMDAiLAoJCQkJCX0sCgkJCQldLAoJCQl9LAoJCQl7CgkJCQkiQG9uZGMvb3JnL2l0ZW1faWQiOiAiY29tYm8xIiwKCQkJCXRpdGxlOiAiRmxhdCBkaXNjb3VudCBvZiDigrk3NSBvbiBjb21ibyIsCgkJCQkiQG9uZGMvb3JnL3RpdGxlX3R5cGUiOiAib2ZmZXIiLAoJCQkJcHJpY2U6IHsKCQkJCQljdXJyZW5jeTogIklOUiIsCgkJCQkJdmFsdWU6ICIwIiwKCQkJCX0sCgkJCQlpdGVtOiB7CgkJCQkJdGFnczogWwoJCQkJCQl7CgkJCQkJCQljb2RlOiAicXVvdGUiLAoJCQkJCQkJbGlzdDogWwoJCQkJCQkJCXsKCQkJCQkJCQkJY29kZTogInR5cGUiLAoJCQkJCQkJCQl2YWx1ZTogIm9yZGVyIiwKCQkJCQkJCQl9LAoJCQkJCQkJXSwKCQkJCQkJfSwKCQkJCQkJewoJCQkJCQkJY29kZTogIm9mZmVyIiwKCQkJCQkJCWxpc3Q6IFsKCQkJCQkJCQl7CgkJCQkJCQkJCWNvZGU6ICJ0eXBlIiwKCQkJCQkJCQkJdmFsdWU6ICJjb21ibyIsCgkJCQkJCQkJfSwKCQkJCQkJCQl7CgkJCQkJCQkJCWNvZGU6ICJhZGRpdGl2ZSIsCgkJCQkJCQkJCXZhbHVlOiAibm8iLAoJCQkJCQkJCX0sCgkJCQkJCQkJewoJCQkJCQkJCQljb2RlOiAiYXV0byIsCgkJCQkJCQkJCXZhbHVlOiAibm8iLAoJCQkJCQkJCX0sCgkJCQkJCQldLAoJCQkJCQl9LAoJCQkJCV0sCgkJCQl9LAoJCQl9LAoJCV07Cgl9CglsZXQgdG90YWxRdWFudGl0eSA9IDA7Cglmb3IgKGNvbnN0IGl0ZW0gb2YgbmV3SXRlbXMpIHsKCQl0b3RhbFF1YW50aXR5ICs9IGl0ZW0uY291bnQ7Cgl9CglpZiAob2ZmZXJJZCA9PT0gImJ1eTJnZXQzIiAmJiB0b3RhbFF1YW50aXR5IDwgMikgewoJCXJldHVybiBbCgkJCXsKCQkJCWNvZGU6ICJxdW90ZV90cmFpbCIsCgkJCQlsaXN0OiBbCgkJCQkJewoJCQkJCQljb2RlOiAidHlwZSIsCgkJCQkJCXZhbHVlOiAib2ZmZXIiLAoJCQkJCX0sCgkJCQkJewoJCQkJCQljb2RlOiAiaWQiLAoJCQkJCQl2YWx1ZTogImJ1eTJnZXQzIiwKCQkJCQl9LAoJCQkJCXsKCQkJCQkJY29kZTogImN1cnJlbmN5IiwKCQkJCQkJdmFsdWU6ICJJTlIiLAoJCQkJCX0sCgkJCQkJewoJCQkJCQljb2RlOiAidmFsdWUiLAoJCQkJCQl2YWx1ZTogIjAiLAoJCQkJCX0sCgkJCQldLAoJCQl9LAoJCQl7CgkJCQkiQG9uZGMvb3JnL2l0ZW1faWQiOiAiYnV5MmdldDMiLAoJCQkJIkBvbmRjL29yZy9pdGVtX3F1YW50aXR5IjogewoJCQkJCWNvdW50OiAwLAoJCQkJfSwKCQkJCXRpdGxlOiAiYnV5IDIgaXRlbXMsIGdldCAzcmQgZm9yIGZyZWUgb3IgYXQgb2ZmZXJlZCBwcmljZSIsCgkJCQkiQG9uZGMvb3JnL3RpdGxlX3R5cGUiOiAib2ZmZXIiLAoJCQkJcHJpY2U6IHsKCQkJCQljdXJyZW5jeTogIklOUiIsCgkJCQkJdmFsdWU6ICIwLjAwIiwKCQkJCX0sCgkJCQlpdGVtOiB7CgkJCQkJdGFnczogWwoJCQkJCQl7CgkJCQkJCQljb2RlOiAicXVvdGUiLAoJCQkJCQkJbGlzdDogWwoJCQkJCQkJCXsKCQkJCQkJCQkJY29kZTogInR5cGUiLAoJCQkJCQkJCQl2YWx1ZTogIm9yZGVyIiwKCQkJCQkJCQl9LAoJCQkJCQkJXSwKCQkJCQkJfSwKCQkJCQkJewoJCQkJCQkJY29kZTogIm9mZmVyIiwKCQkJCQkJCWxpc3Q6IFsKCQkJCQkJCQl7CgkJCQkJCQkJCWNvZGU6ICJ0eXBlIiwKCQkJCQkJCQkJdmFsdWU6ICJidXlYZ2V0WSIsCgkJCQkJCQkJfSwKCQkJCQkJCQl7CgkJCQkJCQkJCWNvZGU6ICJhdXRvIiwKCQkJCQkJCQkJdmFsdWU6ICJ5ZXMiLAoJCQkJCQkJCX0sCgkJCQkJCQkJewoJCQkJCQkJCQljb2RlOiAiYWRkaXRpdmUiLAoJCQkJCQkJCQl2YWx1ZTogIm5vIiwKCQkJCQkJCQl9LAoJCQkJCQkJCXsKCQkJCQkJCQkJY29kZTogIml0ZW1faWQiLAoJCQkJCQkJCQl2YWx1ZTogIkkyIiwKCQkJCQkJCQl9LAoJCQkJCQkJCXsKCQkJCQkJCQkJY29kZTogIml0ZW1fY291bnQiLAoJCQkJCQkJCQl2YWx1ZTogIjEiLAoJCQkJCQkJCX0sCgkJCQkJCQkJewoJCQkJCQkJCQljb2RlOiAiaXRlbV92YWx1ZSIsCgkJCQkJCQkJCXZhbHVlOiAiMC4wMCIsCgkJCQkJCQkJfSwKCQkJCQkJCV0sCgkJCQkJCX0sCgkJCQkJXSwKCQkJCX0sCgkJCX0sCgkJXTsKCX0KCXJldHVybiBbXTsKfQo=
      validate: LyoqCiAqIFZhbGlkYXRlcyB0aGUgaW5jb21pbmcgcmVxdWVzdCBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXRQYXlsb2FkIC0gVGhlIGluY29taW5nIHJlcXVlc3QgcGF5bG9hZCB0byB2YWxpZGF0ZS4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiB2YWxpZGF0ZSh0YXJnZXRQYXlsb2FkLCBzZXNzaW9uRGF0YSkgewogIHJldHVybiB7IHZhbGlkOiB0cnVlLCBjb2RlOiAyMDAsIGRlc2NyaXB0aW9uOiAiVmFsaWQgcmVxdWVzdCIgfTsKfQ==
      requirements: LyoqCiAqIENoZWNrcyBpZiB0aGUgcmVxdWlyZW1lbnRzIGZvciBwcm9jZWVkaW5nIHdpdGggdGhlIEFQSSBjYWxsIGFyZSBtZXQuCiAqIAogKiBAcGFyYW0ge09iamVjdH0gc2Vzc2lvbkRhdGEgLSBEYXRhIGNvbGxlY3RlZCBmcm9tIHByZXZpb3VzIHRyYW5zYWN0aW9uIHN0ZXBzLgogKiAKICogQHJldHVybnMge09iamVjdH0geyB2YWxpZDogYm9vbGVhbiwgY29kZTogbnVtYmVyLCBkZXNjcmlwdGlvbjogc3RyaW5nIH0KICovCi8qKgogKiBDaGVja3MgaWYgdGhlIHJlcXVpcmVtZW50cyBmb3IgcHJvY2VlZGluZyB3aXRoIHRoZSBBUEkgY2FsbCBhcmUgbWV0LgogKiAKICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiBtZWV0UmVxdWlyZW1lbnRzKHNlc3Npb25EYXRhKSB7CiAgLy8gQ2hlY2sgZm9yIHNlbGVjdGVkX2l0ZW1zCiAgaWYgKCFzZXNzaW9uRGF0YS5zZWxlY3RlZF9pdGVtcyB8fCBzZXNzaW9uRGF0YS5zZWxlY3RlZF9pdGVtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBzZWxlY3RlZF9pdGVtcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU0VMRUNURURfSVRFTVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBwYXlsb2FkX2NpdHkKICBpZiAoIXNlc3Npb25EYXRhLnBheWxvYWRfY2l0eSkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHBheWxvYWRfY2l0eSBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUEFZTE9BRF9DSVRZIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3Igc2VsZWN0ZWRfZnVsZmlsbG1lbnRzCiAgaWYgKAogICAgIXNlc3Npb25EYXRhLnNlbGVjdGVkX2Z1bGZpbGxtZW50cyB8fAogICAgc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfZnVsZmlsbG1lbnRzLmxlbmd0aCA9PT0gMAogICkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHNlbGVjdGVkX2Z1bGZpbGxtZW50cyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU0VMRUNURURfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgcHJvdmlkZXIKICBpZiAoIXNlc3Npb25EYXRhLnByb3ZpZGVyKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gcHJvdmlkZXIgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1BST1ZJREVSIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgcXVvdGUKICBpZiAoIXNlc3Npb25EYXRhLnF1b3RlIHx8IHR5cGVvZiBzZXNzaW9uRGF0YS5xdW90ZSAhPT0gIm9iamVjdCIpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBxdW90ZSBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUVVPVEUiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBvbl9zZWxlY3RfZnVsZmlsbG1lbnRzCiAgaWYgKAogICAgIXNlc3Npb25EYXRhLm9uX3NlbGVjdF9mdWxmaWxsbWVudHMgfHwKICAgIHNlc3Npb25EYXRhLm9uX3NlbGVjdF9mdWxmaWxsbWVudHMubGVuZ3RoID09PSAwCiAgKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gb25fc2VsZWN0X2Z1bGZpbGxtZW50cyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfT05fU0VMRUNUX0ZVTEZJTExNRU5UUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9uX3NlbGVjdF9pdGVtcwogIGlmICgKICAgICFzZXNzaW9uRGF0YS5vbl9zZWxlY3RfaXRlbXMgfHwKICAgIHNlc3Npb25EYXRhLm9uX3NlbGVjdF9pdGVtcy5sZW5ndGggPT09IDAKICApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBvbl9zZWxlY3RfaXRlbXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX09OX1NFTEVDVF9JVEVNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHRhdAogIGlmICghc2Vzc2lvbkRhdGEudGF0KSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gdGF0IGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19UQVQiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBpdGVtcwogIGlmICghc2Vzc2lvbkRhdGEuaXRlbXMgfHwgc2Vzc2lvbkRhdGEuaXRlbXMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gaXRlbXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0lURU1TIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgYmlsbGluZwogIGlmICghc2Vzc2lvbkRhdGEuYmlsbGluZyB8fCB0eXBlb2Ygc2Vzc2lvbkRhdGEuYmlsbGluZyAhPT0gIm9iamVjdCIpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBiaWxsaW5nIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19CSUxMSU5HIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgZnVsZmlsbG1lbnRzCiAgaWYgKCFzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHMgfHwgc2Vzc2lvbkRhdGEuZnVsZmlsbG1lbnRzLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIGZ1bGZpbGxtZW50cyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3Igc2VsZWN0ZWRfbnBfZmVlcwogIGlmICghc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfbnBfZmVlcykgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHNlbGVjdGVkX25wX2ZlZXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1NFTEVDVEVEX05QX0ZFRVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBicHBfdGVybXMKICBpZiAoIXNlc3Npb25EYXRhLmJwcF90ZXJtcyB8fCBzZXNzaW9uRGF0YS5icHBfdGVybXMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gYnBwX3Rlcm1zIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19CUFBfVEVSTVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBvcmRlcl9pZCAoTkVXKQogIGlmICghc2Vzc2lvbkRhdGEub3JkZXJfaWQpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBvcmRlcl9pZCBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfT1JERVJfSUQiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBiYXBfdGVybXMgKE5FVykKICBpZiAoIXNlc3Npb25EYXRhLmJhcF90ZXJtcyB8fCBzZXNzaW9uRGF0YS5iYXBfdGVybXMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gYmFwX3Rlcm1zIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19CQVBfVEVSTVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBzdGF0ZSAoTkVXKQogIGlmICghc2Vzc2lvbkRhdGEuc3RhdGUpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBzdGF0ZSBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU1RBVEUiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBwYXltZW50IChORVcpCiAgaWYgKCFzZXNzaW9uRGF0YS5wYXltZW50IHx8IHR5cGVvZiBzZXNzaW9uRGF0YS5wYXltZW50ICE9PSAib2JqZWN0IikgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHBheW1lbnQgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1BBWU1FTlQiLAogICAgfTsKICB9CgogIC8vIEFsbCByZXF1aXJlbWVudHMgc2F0aXNmaWVkCiAgcmV0dXJuIHsKICAgIHZhbGlkOiB0cnVlLAogICAgZGVzY3JpcHRpb246ICJBbGwgQ2hlY2tzIHBhc3NlZCBzdWNjZXNzZnVsbHkiLAogICAgY29kZTogIjIwMCIsCiAgfTsKfQo=
      defaultPayload:
        context:
          domain: ONDC:RETeB2B
          action: on_update
          core_version: 1.2.5
          bap_id: buyerNP.com
          bap_uri: https://buyerNP.com/ondc
          bpp_id: sellerNP.com
          bpp_uri: https://sellerNP.com/ondc
          transaction_id: T2
          message_id: M5
          city: std:080
          country: IND
          timestamp: 2023-06-03T10:30:30.000Z
        message:
          order:
            id: O1
            state: Accepted
            provider:
              id: P1
              locations:
                - id: L1
            items:
              - id: I1
                fulfillment_id: F1
                quantity:
                  count: 1
              - id: I1
                fulfillment_id: C1
                quantity:
                  count: 1
            billing:
              name: ONDC buyer
              address:
                name: "my house or door or floor #"
                building: "my building name or house #"
                locality: my street name
                city: Bengaluru
                state: Karnataka
                country: IND
                area_code: "560037"
              email: nobody@nomail.com
              phone: "9886098860"
              created_at: 2023-06-03T09:00:00.000Z
              updated_at: 2023-06-03T09:00:00.000Z
            fulfillments:
              - id: F1
                type: Delivery
                tracking: true
                "@ondc/org/provider_name": LSP or Provider Name
                "@ondc/org/TAT": PT60M
                state:
                  descriptor:
                    code: Pending
                customer:
                  id: CUST_001
                  organization:
                    descriptor:
                      name: Sharma Kirana Store
                  person:
                    creds:
                      - id: 29AABCU9603R1ZM
                        type: GSTIN
                      - id: ABCDE1234F
                        type: PAN
                start:
                  location:
                    id: L1
                    descriptor:
                      name: ABC Store
                    gps: 12.956399,77.636803
                    address:
                      locality: Jayanagar
                      city: Bengaluru
                      area_code: "560076"
                      state: KA
              - id: C1
                type: Cancel
                state:
                  descriptor:
                    code: Cancelled
                customer:
                  id: CUST_001
                  organization:
                    descriptor:
                      name: Sharma Kirana Store
                  person:
                    creds:
                      - id: 29AABCU9603R1ZM
                        type: GSTIN
                      - id: ABCDE1234F
                        type: PAN
                tags:
                  - code: cancel_request
                    list:
                      - code: reason_id
                        value: "002"
                      - code: initiated_by
                        value: sellerNP.com
            quote:
              price:
                currency: INR
                value: "254.00"
              ttl: P1D
            payment:
              uri: https://ondc.transaction.com/payment
              params:
                currency: INR
                transaction_id: "3937"
                amount: "424.00"
              status: PAID
              type: ON-ORDER
              collected_by: BAP
              "@ondc/org/buyer_app_finder_fee_type": percent
              "@ondc/org/buyer_app_finder_fee_amount": "3"
            created_at: 2023-06-03T09:30:00.000Z
            updated_at: 2023-06-03T10:31:30.000Z
      saveData:
        transactionId: $.context.transaction_id
        latestTimestamp: $.context.timestamp
        bapId: $.context.bap_id
        bapUri: $.context.bap_uri
        bppId: $.context.bpp_id
        bppUri: $.context.bpp_uri
        quote: $.message.order.quote
        items: $.message.order.items[*]
        fulfillments: $.message.order.fulfillments[*]
      inputs: {}
  - api: update
    action_id: update_settlement_trail
    owner: BAP
    responseFor: null
    unsolicited: false
    description: please add relevant description
    mock:
      generate: ZnVuY3Rpb24gZmluZFF1b3RlVHJhaWxUYWdzKG9iaikgewogIGNvbnN0IHJlc3VsdCA9IFtdOwoKICBmdW5jdGlvbiB3YWxrKG5vZGUpIHsKICAgIGlmICghbm9kZSB8fCB0eXBlb2Ygbm9kZSAhPT0gIm9iamVjdCIpIHJldHVybjsKCiAgICAvLyBJZiB0aGlzIG5vZGUgaGFzIGEgdGFncyBhcnJheSwgaW5zcGVjdCBpdAogICAgaWYgKEFycmF5LmlzQXJyYXkobm9kZS50YWdzKSkgewogICAgICBmb3IgKGNvbnN0IHRhZyBvZiBub2RlLnRhZ3MpIHsKICAgICAgICBpZiAodGFnICYmIHRhZy5jb2RlID09PSAicXVvdGVfdHJhaWwiKSB7CiAgICAgICAgICByZXN1bHQucHVzaCh0YWcpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIC8vIFJlY3Vyc2UgaW50byBjaGlsZHJlbgogICAgZm9yIChjb25zdCBrZXkgaW4gbm9kZSkgewogICAgICB3YWxrKG5vZGVba2V5XSk7CiAgICB9CiAgfQoKICB3YWxrKG9iaik7CiAgcmV0dXJuIHJlc3VsdDsKfQphc3luYyBmdW5jdGlvbiBnZW5lcmF0ZSgKCWV4aXN0aW5nUGF5bG9hZCwKCXNlc3Npb25EYXRhCikgewoJZXhpc3RpbmdQYXlsb2FkLm1lc3NhZ2Uub3JkZXIuaWQgPSBzZXNzaW9uRGF0YS5vcmRlcl9pZFswXTsKICBjb25zdCBmdWxmaWxsbWVudHMgPSBzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHM7CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5mdWxmaWxsbWVudHMgPSBbXTsKCWNvbnN0IGNhbmNlbElkID0KCQlmdWxmaWxsbWVudHMuZmlsdGVyKChmKSA9PiBmLnR5cGUgPT09ICJDYW5jZWwiKVswXT8uaWQgfHwgdW5kZWZpbmVkOwoJaWYgKGNhbmNlbElkKSB7CgkJZXhpc3RpbmdQYXlsb2FkLm1lc3NhZ2Uub3JkZXIuZnVsZmlsbG1lbnRzID0gWwoJCQl7IGlkOiBjYW5jZWxJZCwgdHlwZTogIkNhbmNlbCIgfSwKCQldOwoJfQoJY29uc3QgcmV0dXJuSWQgPQoJCWZ1bGZpbGxtZW50cy5maWx0ZXIoKGYpID0+IGYudHlwZSA9PT0gIlJldHVybiIpWzBdPy5pZCB8fCB1bmRlZmluZWQ7CglpZiAocmV0dXJuSWQpIHsKCQlleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5mdWxmaWxsbWVudHMucHVzaCh7CgkJCWlkOiByZXR1cm5JZCwKCQkJdHlwZTogIlJldHVybiIsCgkJfSk7Cgl9CgogIGNvbnN0IHRyYWlsID0gZmluZFF1b3RlVHJhaWxUYWdzKHNlc3Npb25EYXRhLmZ1bGZpbGxtZW50cyk7CgoJY29uc3QgYW1vdW50cyA9IHRyYWlsLmZsYXRNYXAoKHQpID0+IHsKCQlyZXR1cm4gdC5saXN0CgkJCS5maWx0ZXIoKGwpID0+IGwuY29kZSA9PT0gInZhbHVlIikKCQkJLm1hcCgobCkgPT4gewoJCQkJcmV0dXJuIHBhcnNlSW50KGwudmFsdWUpOwoJCQl9KTsKCX0pOwoJY29uc3QgdG90YWxBbW91bnQgPSBhbW91bnRzLnJlZHVjZSgoYWNjLCBjdXJyKSA9PiBhY2MgKyBjdXJyLCAwKTsKCglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5wYXltZW50ID0gewoJCSJAb25kYy9vcmcvc2V0dGxlbWVudF9kZXRhaWxzIjogWwoJCQl7CgkJCQlzZXR0bGVtZW50X2NvdW50ZXJwYXJ0eTogImJ1eWVyIiwKCQkJCXNldHRsZW1lbnRfcGhhc2U6ICJyZWZ1bmQiLAoJCQkJc2V0dGxlbWVudF90eXBlOiAibmV0YmFua2luZyIsCgkJCQlzZXR0bGVtZW50X2Ftb3VudDogYCR7LTEgKiB0b3RhbEFtb3VudH1gLAoJCQkJc2V0dGxlbWVudF90aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKCQkJfSwKCQldLAoJfTsKCglyZXR1cm4gZXhpc3RpbmdQYXlsb2FkOwp9Cg==
      validate: LyoqCiAqIFZhbGlkYXRlcyB0aGUgaW5jb21pbmcgcmVxdWVzdCBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXRQYXlsb2FkIC0gVGhlIGluY29taW5nIHJlcXVlc3QgcGF5bG9hZCB0byB2YWxpZGF0ZS4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiB2YWxpZGF0ZSh0YXJnZXRQYXlsb2FkLCBzZXNzaW9uRGF0YSkgewogIHJldHVybiB7IHZhbGlkOiB0cnVlLCBjb2RlOiAyMDAsIGRlc2NyaXB0aW9uOiAiVmFsaWQgcmVxdWVzdCIgfTsKfQ==
      requirements: LyoqCiAqIENoZWNrcyBpZiB0aGUgcmVxdWlyZW1lbnRzIGZvciBwcm9jZWVkaW5nIHdpdGggdGhlIEFQSSBjYWxsIGFyZSBtZXQuCiAqCiAqIEBwYXJhbSB7T2JqZWN0fSBzZXNzaW9uRGF0YSAtIERhdGEgY29sbGVjdGVkIGZyb20gcHJldmlvdXMgdHJhbnNhY3Rpb24gc3RlcHMuCiAqCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IHN0cmluZywgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiBtZWV0UmVxdWlyZW1lbnRzKHNlc3Npb25EYXRhKSB7CiAgLy8gQ2hlY2sgZm9yIG9yZGVyX2lkCiAgaWYgKCFzZXNzaW9uRGF0YS5vcmRlcl9pZCkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIG9yZGVyX2lkIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19PUkRFUl9JRCIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIGZ1bGZpbGxtZW50cwogIGlmICghc2Vzc2lvbkRhdGEuZnVsZmlsbG1lbnRzIHx8IHNlc3Npb25EYXRhLmZ1bGZpbGxtZW50cy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBmdWxmaWxsbWVudHMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0ZVTEZJTExNRU5UUyIsCiAgICB9OwogIH0KCiAgLy8gQWxsIHJlcXVpcmVtZW50cyBzYXRpc2ZpZWQKICByZXR1cm4gewogICAgdmFsaWQ6IHRydWUsCiAgICBkZXNjcmlwdGlvbjogIkFsbCBDaGVja3MgcGFzc2VkIHN1Y2Nlc3NmdWxseSIsCiAgICBjb2RlOiAiMjAwIiwKICB9Owp9Cg==
      defaultPayload:
        context:
          domain: ONDC:RETeB2B
          action: update
          timestamp: 2025-12-30T10:07:55.917Z
          transaction_id: 6db7d975-88a0-45f1-9c32-07c21547d7da
          message_id: 185768f5-3f7c-4c55-8a68-ca346fa9aaac
          bap_id: sample-bap-id
          bap_uri: https://bap.example.com
          ttl: PT30S
          bpp_id: sample-bpp-id
          bpp_uri: https://bpp.example.com
          country: IND
          city: "*"
          core_version: 1.2.5
        message:
          update_target: payment
          order:
            id: 2025-02-10-293522
            fulfillments:
              - id: c_e1ef592c-5ccf-476b-97c8-85f276f07b53_1
                type: Cancel
                state:
                  descriptor:
                    code: Cancelled
                customer:
                  id: CUST_001
                  organization:
                    descriptor:
                      name: Sharma Kirana Store
                  person:
                    creds:
                      - id: 29AABCU9603R1ZM
                        type: GSTIN
                      - id: ABCDE1234F
                        type: PAN
                tags:
                  - code: cancel_request
                    list:
                      - code: reason_id
                        value: "002"
                      - code: initiated_by
                        value: sellerNP.com
            payment:
              "@ondc/org/settlement_details":
                - settlement_counterparty: buyer
                  settlement_phase: refund
                  settlement_type: netbanking
                  settlement_amount: "500.00"
                  settlement_timestamp: 2025-02-10T07:32:18.275Z
      saveData:
        transactionId: $.context.transaction_id
        latestTimestamp: $.context.timestamp
        bapId: $.context.bap_id
        bapUri: $.context.bap_uri
        bppId: $.context.bpp_id
        bppUri: $.context.bpp_uri
        message_id: $.context.message_id
        update_fulfillments: $.message.order.fulfillments[*]
        update_payment: $.message.order.payment["@ondc/org/settlement_details"]
      inputs: {}
  - api: on_status
    action_id: on_status_packed
    owner: BPP
    responseFor: null
    unsolicited: true
    description: On-status call which is sent when the order is packed
    mock:
      generate: LyoqCiAqIEdlbmVyYXRlcyB0aGUgbW9jayBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgY3VzdG9taXphdGlvbiBvZiB0aGUgZGVmYXVsdCBwYXlsb2FkIHVzaW5nIHNlc3Npb24gZGF0YQogKiBmcm9tIHByZXZpb3VzIHN0ZXBzIGFuZCB1c2VyIGlucHV0cy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSBkZWZhdWx0UGF5bG9hZCAtIFRoZSBiYXNlIHBheWxvYWQgb2JqZWN0IHdpdGggY29udGV4dCBhbHJlYWR5IHBvcHVsYXRlZC4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhLnVzZXJfaW5wdXRzIC0gVXNlci1wcm92aWRlZCBpbnB1dCB2YWx1ZXMgZm9yIHRoaXMgc3RlcC4KICogQHBhcmFtIHsqfSBzZXNzaW9uRGF0YS5ba2V5XSAtIEFueSBzYXZlZCBkYXRhIGZyb20gcHJldmlvdXMgc3RlcHMgKGRlZmluZWQgaW4gc2F2ZURhdGEgY29uZmlnKS4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBnZW5lcmF0ZWQgcGF5bG9hZCBvYmplY3QgdG8gYmUgc2VudCBpbiB0aGUgQVBJIHJlcXVlc3QuCiAqLwpjb25zdCBpc29EdXJUb1NlYyA9IChkdXJhdGlvbikgPT4gewogIGNvbnN0IGR1clJFID0KICAgIC9QKChcZCspWSk/KChcZCspTSk/KChcZCspVyk/KChcZCspRCk/VD8oKFxkKylIKT8oKFxkKylNKT8oKFxkKylTKT8vOwoKICBjb25zdCBzcGxpdFRpbWUgPSBkdXJSRS5leGVjKGR1cmF0aW9uKTsKICBpZiAoIXNwbGl0VGltZSkgewogICAgcmV0dXJuIDA7CiAgfQoKICBjb25zdCB5ZWFycyA9IE51bWJlcihzcGxpdFRpbWU/LlsyXSkgfHwgMDsKICBjb25zdCBtb250aHMgPSBOdW1iZXIoc3BsaXRUaW1lPy5bNF0pIHx8IDA7CiAgY29uc3Qgd2Vla3MgPSBOdW1iZXIoc3BsaXRUaW1lPy5bNl0pIHx8IDA7CiAgY29uc3QgZGF5cyA9IE51bWJlcihzcGxpdFRpbWU/Lls4XSkgfHwgMDsKICBjb25zdCBob3VycyA9IE51bWJlcihzcGxpdFRpbWU/LlsxMF0pIHx8IDA7CiAgY29uc3QgbWludXRlcyA9IE51bWJlcihzcGxpdFRpbWU/LlsxMl0pIHx8IDA7CiAgY29uc3Qgc2Vjb25kcyA9IE51bWJlcihzcGxpdFRpbWU/LlsxNF0pIHx8IDA7CgogIGNvbnN0IHJlc3VsdCA9CiAgICB5ZWFycyAqIDMxNTM2MDAwICsKICAgIG1vbnRocyAqIDI2MjgyODggKwogICAgd2Vla3MgKiA2MDQ4MDAgKwogICAgZGF5cyAqIDg2NDAwICsKICAgIGhvdXJzICogMzYwMCArCiAgICBtaW51dGVzICogNjAgKwogICAgc2Vjb25kczsKCiAgcmV0dXJuIHJlc3VsdDsKfTsKZnVuY3Rpb24gZ2V0VXBkYXRlZEJpbGxpbmcoc2F2ZWRCaWxsaW5nLCBpbml0aWFsaXplID0gZmFsc2UpIHsKICBpZiAoaW5pdGlhbGl6ZSkgewogICAgY29uc3QgbmV3SXNvID0gbmV3IERhdGUobmV3IERhdGUoKS5nZXRUaW1lKCkgLSA1ICogMTAwMCkudG9JU09TdHJpbmcoKTsKICAgIHNhdmVkQmlsbGluZy5jcmVhdGVkX2F0ID0gbmV3SXNvOwogICAgc2F2ZWRCaWxsaW5nLnVwZGF0ZWRfYXQgPSBuZXdJc287CiAgfQogIHJldHVybiBzYXZlZEJpbGxpbmc7Cn0KZnVuY3Rpb24gY3JlYXRlR2VuZXJpY09uU3RhdHVzKAoJZXhpc3RpbmdQYXlsb2FkLAoJc2Vzc2lvbkRhdGEKKSB7CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5pZCA9IHNlc3Npb25EYXRhLm9yZGVyX2lkWzBdOwoJZXhpc3RpbmdQYXlsb2FkLm1lc3NhZ2Uub3JkZXIucHJvdmlkZXIgPSBzZXNzaW9uRGF0YS5wcm92aWRlclswXTsKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLml0ZW1zID0gc2Vzc2lvbkRhdGEuaXRlbXM7CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5iaWxsaW5nID0gZ2V0VXBkYXRlZEJpbGxpbmcoCgkJc2Vzc2lvbkRhdGEuYmlsbGluZ1swXQoJKTsKCS8vIGV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLmZ1bGZpbGxtZW50cyA9IHNlc3Npb25EYXRhLmZ1bGZpbGxtZW50czsKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLnF1b3RlID0gc2Vzc2lvbkRhdGEucXVvdGVbMF07Cgljb25zdCB0aW1lSVNPID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpOwoJZXhpc3RpbmdQYXlsb2FkLm1lc3NhZ2Uub3JkZXIudXBkYXRlZF9hdCA9IHRpbWVJU087CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5jcmVhdGVkX2F0ID0gc2Vzc2lvbkRhdGEub3JkZXJfY3JlYXRlZF9hdFswXTsKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLnBheW1lbnQgPSBzZXNzaW9uRGF0YS5wYXltZW50WzBdOwoJcmV0dXJuIGV4aXN0aW5nUGF5bG9hZDsKfQpmdW5jdGlvbiBjcmVhdGVGdWxmaWxsbWVudHMoCiAgYWN0aW9uLAogIGFjdGlvbklkLAogIHNlc3Npb25EYXRhLAogIGRlZmF1bHRGdWxmaWxsbWVudHMKKSB7CiAgaWYgKGRlZmF1bHRGdWxmaWxsbWVudHMubGVuZ3RoIDwgMSkgewogICAgdGhyb3cgbmV3IEVycm9yKCJFbXB0eSBmdWxmaWxsbWVudHMgZm91bmQiKTsKICB9CiAgaWYgKGFjdGlvbiA9PT0gIm9uX3N0YXR1cyIpIHsKICAgIGxldCBmdWxmaWxsbWVudHMgPSBzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHM7CiAgICBjb25zdCB0YWdzID0gewogICAgICB0YWdzOiBbCiAgICAgICAgewogICAgICAgICAgY29kZTogInJvdXRpbmciLAogICAgICAgICAgbGlzdDogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29kZTogInR5cGUiLAogICAgICAgICAgICAgIHZhbHVlOiAiUDJIMlAiLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGNvZGU6ICJ0cmFja2luZyIsCiAgICAgICAgICBsaXN0OiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb2RlOiAiZ3BzX2VuYWJsZWQiLAogICAgICAgICAgICAgIHZhbHVlOiAibm8iLAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29kZTogInVybF9lbmFibGVkIiwKICAgICAgICAgICAgICB2YWx1ZTogInllcyIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb2RlOiAidXJsIiwKICAgICAgICAgICAgICB2YWx1ZTogImh0dHBzOi8vc2VsbGVyTlAuY29tL29uZGMvdHJhY2tpbmdfdXJsIiwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgfSwKICAgICAgXSwKICAgIH07CiAgICBsZXQgZmluYWxGdWxmaWxsbWVudHMgPSBzZXNzaW9uRGF0YS5vbl9zdGF0dXNfZnVsZmlsbG1lbnRzOwogICAgaWYgKCFzZXNzaW9uRGF0YS5vbl9zdGF0dXNfZnVsZmlsbG1lbnRzKSB7CiAgICAgIGNvbnN0IHRpbWUgPSBuZXcgRGF0ZShuZXcgRGF0ZSgpLmdldFRpbWUoKSArIDEwICogMTAwMCAqIDYwKTsKICAgICAgY29uc3Qgc3RhcnRfZW5kID0gbmV3IERhdGUodGltZS5nZXRUaW1lKCkgKyAxMCAqIDEwMDAgKiA2MCkudG9JU09TdHJpbmcoKTsKICAgICAgZmluYWxGdWxmaWxsbWVudHMgPSBmdWxmaWxsbWVudHMKICAgICAgICAvLyAuZmlsdGVyKChmKSA9PiBmLnR5cGUgPT0gIkRlbGl2ZXJ5IikKICAgICAgICAubWFwKChmKSA9PiB7CiAgICAgICAgICBpZiAoZi50eXBlID09ICJEZWxpdmVyeSIpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAuLi5mLAogICAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgICAuLi5mLnN0YXJ0LAogICAgICAgICAgICAgICAgdGltZTogewogICAgICAgICAgICAgICAgICByYW5nZTogewogICAgICAgICAgICAgICAgICAgIHN0YXJ0OiB0aW1lLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgICAgZW5kOiBzdGFydF9lbmQsCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgICAuLi5mLmVuZCwKICAgICAgICAgICAgICAgIHRpbWU6IHsKICAgICAgICAgICAgICAgICAgcmFuZ2U6IHsKICAgICAgICAgICAgICAgICAgICBzdGFydDogc3RhcnRfZW5kLAogICAgICAgICAgICAgICAgICAgIGVuZDogbmV3IERhdGUoCiAgICAgICAgICAgICAgICAgICAgICB0aW1lLmdldFRpbWUoKSArCiAgICAgICAgICAgICAgICAgICAgICAxMDAwICogaXNvRHVyVG9TZWMoZlsiQG9uZGMvb3JnL1RBVCJdIHx8ICJQVDBIIikKICAgICAgICAgICAgICAgICAgICApLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgdGFnczogdGFncy50YWdzLAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGY7CiAgICAgICAgfSk7CiAgICAgIC8vIGZ1bGZpbGxtZW50cyA9IGZ1bGZpbGxtZW50cy5maWx0ZXIoKGYpID0+IGYudHlwZSAhPSAiRGVsaXZlcnkiKTsKICAgICAgLy8gZmluYWxGdWxmaWxsbWVudHMgPSB7IC4uLmZpbmFsRnVsZmlsbG1lbnRzLCAuLi5mdWxmaWxsbWVudHMgfTsKICAgIH0KICAgIGxldCBzdGF0ZSA9ICJQZW5kaW5nIjsKICAgIHN3aXRjaCAoYWN0aW9uSWQpIHsKICAgICAgY2FzZSAib25fc3RhdHVzX3BhY2tlZCI6CiAgICAgICAgc3RhdGUgPSAiUGFja2VkIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAib25fc3RhdHVzX2FjY2VwdGVkIjoKICAgICAgICBzdGF0ZSA9ICJQZW5kaW5nIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAib25fc3RhdHVzX2FnZW50X2Fzc2lnbmVkIjoKICAgICAgICBzdGF0ZSA9ICJBZ2VudC1hc3NpZ25lZCI7CgogICAgICAgIGZpbmFsRnVsZmlsbG1lbnRzID0gZmluYWxGdWxmaWxsbWVudHMubWFwKChmKSA9PiB7CiAgICAgICAgICBpZiAoZi50eXBlID09PSAiRGVsaXZlcnkiKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgLi4uZiwKICAgICAgICAgICAgICBhZ2VudDogewogICAgICAgICAgICAgICAgbmFtZTogIm1vY2stYWdlbnQiLAogICAgICAgICAgICAgICAgcGhvbmU6ICI5ODg2MDk4ODYwIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGY7IC8vIGxlYXZlIG90aGVyIHR5cGVzIHVuY2hhbmdlZAogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJvbl9zdGF0dXNfcGlja2VkIjoKICAgICAgICBzdGF0ZSA9ICJPcmRlci1waWNrZWQtdXAiOwogICAgICAgIGZpbmFsRnVsZmlsbG1lbnRzID0gZmluYWxGdWxmaWxsbWVudHMubWFwKChmKSA9PiB7CiAgICAgICAgICBpZiAoZi50eXBlID09PSAiRGVsaXZlcnkiKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgLi4uZiwKICAgICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgICAgLi4uZi5zdGFydCwKICAgICAgICAgICAgICAgIHRpbWU6IHsKICAgICAgICAgICAgICAgICAgLi4uZi5zdGFydD8udGltZSwKICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZjsgLy8gbGVhdmUgb3RoZXIgdHlwZXMgdW5jaGFuZ2VkCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIm9uX3N0YXR1c19vdXRfZm9yX2RlbGl2ZXJ5IjoKICAgICAgICBzdGF0ZSA9ICJPdXQtZm9yLWRlbGl2ZXJ5IjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAib25fc3RhdHVzX29yZGVyX2RlbGl2ZXJlZCI6CiAgICAgICAgc3RhdGUgPSAiT3JkZXItZGVsaXZlcmVkIjsKICAgICAgICBmaW5hbEZ1bGZpbGxtZW50cyA9IGZpbmFsRnVsZmlsbG1lbnRzLm1hcCgoZikgPT4gewogICAgICAgICAgaWYgKGYudHlwZSA9PT0gIkRlbGl2ZXJ5IikgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIC4uLmYsCiAgICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgICAuLi5mLmVuZCwKICAgICAgICAgICAgICAgIHRpbWU6IHsKICAgICAgICAgICAgICAgICAgLi4uZi5lbmQ/LnRpbWUsCiAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGY7IC8vIGxlYXZlIG90aGVyIHR5cGVzIHVuY2hhbmdlZAogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJvbl9zdGF0dXNfcnRvX2RlbGl2ZXJlZCI6CiAgICAgICAgc3RhdGUgPSAiQ2FuY2VsbGVkIjsKICAgICAgICBmaW5hbEZ1bGZpbGxtZW50cyA9IGZpbmFsRnVsZmlsbG1lbnRzLm1hcCgoZikgPT4gewogICAgICAgICAgaWYgKGYudHlwZSA9PT0gIlJUTyIpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAuLi5mLAogICAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgICAgLi4uZi5lbmQsCiAgICAgICAgICAgICAgICB0aW1lOiB7CiAgICAgICAgICAgICAgICAgIC4uLmYuZW5kPy50aW1lLAogICAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzdGF0ZTogewogICAgICAgICAgICAgICAgZGVzY3JpcHRvcjogewogICAgICAgICAgICAgICAgICBjb2RlOiAiUlRPLURlbGl2ZXJlZCIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZi50eXBlID09PSAiRGVsaXZlcnkiKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgLi4uZiwKICAgICAgICAgICAgICBzdGF0ZTogewogICAgICAgICAgICAgICAgZGVzY3JpcHRvcjogewogICAgICAgICAgICAgICAgICBjb2RlOiAiQ2FuY2VsbGVkIiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmOyAvLyBsZWF2ZSBvdGhlciB0eXBlcyB1bmNoYW5nZWQKICAgICAgICB9KTsKCiAgICAgIGNhc2UgIm9uX3N0YXR1c19yZWFkeV90b19zaGlwIjoKICAgICAgICBzdGF0ZSA9ICJQYWNrZWQiOwogICAgICAgIGZpbmFsRnVsZmlsbG1lbnRzID0gZmluYWxGdWxmaWxsbWVudHMubWFwKChmKSA9PiB7CiAgICAgICAgICBpZiAoZi50eXBlID09PSAiQnV5ZXItRGVsaXZlcnkiKSB7CiAgICAgICAgICAgIGNvbnN0IHRhZ3MgPSBmLnRhZ3MgfHwgW107CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgLi4uZiwKICAgICAgICAgICAgICB0YWdzOiBbCiAgICAgICAgICAgICAgICAuLi50YWdzLAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBjb2RlOiAic3RhdGUiLAogICAgICAgICAgICAgICAgICBsaXN0OiBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgY29kZTogInJlYWR5X3RvX3NoaXAiLAogICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICJ5ZXMiLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBjb2RlOiAicm91dGluZyIsCiAgICAgICAgICAgICAgICAgIGxpc3Q6IFsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICBjb2RlOiAidHlwZSIsCiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogIlAyUCIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmOyAKICAgICAgICB9KTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBmaW5hbEZ1bGZpbGxtZW50cyA9IGZpbmFsRnVsZmlsbG1lbnRzLm1hcCgoZikgPT4gewogICAgICBpZiAoZi50eXBlID09PSAiRGVsaXZlcnkiKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIC4uLmYsCiAgICAgICAgICBzdGF0ZTogewogICAgICAgICAgICBkZXNjcmlwdG9yOiB7CiAgICAgICAgICAgICAgY29kZTogc3RhdGUsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgIH07CiAgICAgIH0KICAgICAgcmV0dXJuIGY7CiAgICB9KTsKICAgIHJldHVybiBmaW5hbEZ1bGZpbGxtZW50czsKICB9CiAgcmV0dXJuIGRlZmF1bHRGdWxmaWxsbWVudHM7Cn0KCmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlKAoJZGVmYXVsdFBheWxvYWQsCglzZXNzaW9uRGF0YQopIHsKCWNvbnN0IGdlbmVyYWxQYXlsb2FkID0gY3JlYXRlR2VuZXJpY09uU3RhdHVzKGRlZmF1bHRQYXlsb2FkLCBzZXNzaW9uRGF0YSk7CglnZW5lcmFsUGF5bG9hZC5tZXNzYWdlLm9yZGVyLmZ1bGZpbGxtZW50cyA9IGNyZWF0ZUZ1bGZpbGxtZW50cygKCQkib25fc3RhdHVzIiwKCQkib25fc3RhdHVzX3BhY2tlZCIsCgkJc2Vzc2lvbkRhdGEsCgkJZ2VuZXJhbFBheWxvYWQubWVzc2FnZS5vcmRlci5mdWxmaWxsbWVudHMKCSk7CglyZXR1cm4gZ2VuZXJhbFBheWxvYWQ7Cn0KCg==
      validate: LyoqCiAqIFZhbGlkYXRlcyB0aGUgaW5jb21pbmcgcmVxdWVzdCBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXRQYXlsb2FkIC0gVGhlIGluY29taW5nIHJlcXVlc3QgcGF5bG9hZCB0byB2YWxpZGF0ZS4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiB2YWxpZGF0ZSh0YXJnZXRQYXlsb2FkLCBzZXNzaW9uRGF0YSkgewogIHJldHVybiB7IHZhbGlkOiB0cnVlLCBjb2RlOiAyMDAsIGRlc2NyaXB0aW9uOiAiVmFsaWQgcmVxdWVzdCIgfTsKfQ==
      requirements: LyoqCiAqIENoZWNrcyBpZiB0aGUgcmVxdWlyZW1lbnRzIGZvciBwcm9jZWVkaW5nIHdpdGggdGhlIEFQSSBjYWxsIGFyZSBtZXQuCiAqIAogKiBAcGFyYW0ge09iamVjdH0gc2Vzc2lvbkRhdGEgLSBEYXRhIGNvbGxlY3RlZCBmcm9tIHByZXZpb3VzIHRyYW5zYWN0aW9uIHN0ZXBzLgogKiAKICogQHJldHVybnMge09iamVjdH0geyB2YWxpZDogYm9vbGVhbiwgY29kZTogbnVtYmVyLCBkZXNjcmlwdGlvbjogc3RyaW5nIH0KICovCmZ1bmN0aW9uIG1lZXRSZXF1aXJlbWVudHMoc2Vzc2lvbkRhdGEpIHsKICAvLyBDaGVjayBmb3Igc2VsZWN0ZWRfaXRlbXMKICBpZiAoIXNlc3Npb25EYXRhLnNlbGVjdGVkX2l0ZW1zIHx8IHNlc3Npb25EYXRhLnNlbGVjdGVkX2l0ZW1zLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHNlbGVjdGVkX2l0ZW1zIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19TRUxFQ1RFRF9JVEVNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHBheWxvYWRfY2l0eQogIGlmICghc2Vzc2lvbkRhdGEucGF5bG9hZF9jaXR5KSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gcGF5bG9hZF9jaXR5IGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19QQVlMT0FEX0NJVFkiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBzZWxlY3RlZF9mdWxmaWxsbWVudHMKICBpZiAoCiAgICAhc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfZnVsZmlsbG1lbnRzIHx8CiAgICBzZXNzaW9uRGF0YS5zZWxlY3RlZF9mdWxmaWxsbWVudHMubGVuZ3RoID09PSAwCiAgKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gc2VsZWN0ZWRfZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19TRUxFQ1RFRF9GVUxGSUxMTUVOVFMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBwcm92aWRlcgogIGlmICghc2Vzc2lvbkRhdGEucHJvdmlkZXIpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBwcm92aWRlciBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUFJPVklERVIiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBxdW90ZQogIGlmICghc2Vzc2lvbkRhdGEucXVvdGUgfHwgdHlwZW9mIHNlc3Npb25EYXRhLnF1b3RlICE9PSAib2JqZWN0IikgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHF1b3RlIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19RVU9URSIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9uX3NlbGVjdF9mdWxmaWxsbWVudHMKICBpZiAoCiAgICAhc2Vzc2lvbkRhdGEub25fc2VsZWN0X2Z1bGZpbGxtZW50cyB8fAogICAgc2Vzc2lvbkRhdGEub25fc2VsZWN0X2Z1bGZpbGxtZW50cy5sZW5ndGggPT09IDAKICApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBvbl9zZWxlY3RfZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19PTl9TRUxFQ1RfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3Igb25fc2VsZWN0X2l0ZW1zCiAgaWYgKAogICAgIXNlc3Npb25EYXRhLm9uX3NlbGVjdF9pdGVtcyB8fAogICAgc2Vzc2lvbkRhdGEub25fc2VsZWN0X2l0ZW1zLmxlbmd0aCA9PT0gMAogICkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIG9uX3NlbGVjdF9pdGVtcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfT05fU0VMRUNUX0lURU1TIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgdGF0CiAgaWYgKCFzZXNzaW9uRGF0YS50YXQpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyB0YXQgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1RBVCIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIGl0ZW1zCiAgaWYgKCFzZXNzaW9uRGF0YS5pdGVtcyB8fCBzZXNzaW9uRGF0YS5pdGVtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBpdGVtcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfSVRFTVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBiaWxsaW5nCiAgaWYgKCFzZXNzaW9uRGF0YS5iaWxsaW5nIHx8IHR5cGVvZiBzZXNzaW9uRGF0YS5iaWxsaW5nICE9PSAib2JqZWN0IikgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIGJpbGxpbmcgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0JJTExJTkciLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBmdWxmaWxsbWVudHMKICBpZiAoIXNlc3Npb25EYXRhLmZ1bGZpbGxtZW50cyB8fCBzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19GVUxGSUxMTUVOVFMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBzZWxlY3RlZF9ucF9mZWVzCiAgaWYgKCFzZXNzaW9uRGF0YS5zZWxlY3RlZF9ucF9mZWVzKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gc2VsZWN0ZWRfbnBfZmVlcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU0VMRUNURURfTlBfRkVFUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIGJwcF90ZXJtcwogIGlmICghc2Vzc2lvbkRhdGEuYnBwX3Rlcm1zIHx8IHNlc3Npb25EYXRhLmJwcF90ZXJtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBicHBfdGVybXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0JQUF9URVJNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9yZGVyX2lkCiAgaWYgKCFzZXNzaW9uRGF0YS5vcmRlcl9pZCkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIG9yZGVyX2lkIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19PUkRFUl9JRCIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIGJhcF90ZXJtcwogIGlmICghc2Vzc2lvbkRhdGEuYmFwX3Rlcm1zIHx8IHNlc3Npb25EYXRhLmJhcF90ZXJtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBiYXBfdGVybXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0JBUF9URVJNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHN0YXRlCiAgaWYgKCFzZXNzaW9uRGF0YS5zdGF0ZSkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHN0YXRlIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19TVEFURSIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHBheW1lbnQKICBpZiAoIXNlc3Npb25EYXRhLnBheW1lbnQgfHwgdHlwZW9mIHNlc3Npb25EYXRhLnBheW1lbnQgIT09ICJvYmplY3QiKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gcGF5bWVudCBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUEFZTUVOVCIsCiAgICB9OwogIH0KCiAgaWYgKAogICAgIXNlc3Npb25EYXRhLm9uX3N0YXR1c19mdWxmaWxsbWVudHMgfHwKICAgIHNlc3Npb25EYXRhLm9uX3N0YXR1c19mdWxmaWxsbWVudHMubGVuZ3RoID09PSAwCiAgKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gb25fc3RhdHVzX2Z1bGZpbGxtZW50cyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfT05fU1RBVFVTX0ZVTEZJTExNRU5UUyIsCiAgICB9OwogIH0KCiAgLy8gQWxsIHJlcXVpcmVtZW50cyBzYXRpc2ZpZWQKICByZXR1cm4gewogICAgdmFsaWQ6IHRydWUsCiAgICBkZXNjcmlwdGlvbjogIkFsbCBDaGVja3MgcGFzc2VkIHN1Y2Nlc3NmdWxseSIsCiAgICBjb2RlOiAiMjAwIiwKICB9Owp9Cg==
      defaultPayload:
        context:
          domain: ONDC:RETeB2B
          action: on_status
          timestamp: 2025-12-29T09:59:28.640Z
          transaction_id: 3cd7243a-eef8-42e1-8d12-9c76eab6fcea
          message_id: 4d630042-11e4-4944-b545-13f43c81f8f1
          bap_id: sample-bap-id
          bap_uri: https://bap.example.com
          ttl: PT30S
          bpp_id: sample-bpp-id
          bpp_uri: https://bpp.example.com
          country: IND
          city: "*"
          core_version: 1.2.5
        message:
          order:
            id: O1
            state: In-progress
            provider:
              id: P1
              locations:
                - id: L1
            items:
              - id: I1
                quantity:
                  count: 1
                fulfillment_id: F1
            billing:
              address:
                building: my building name or house
                city: Mumbai
                state: Maharashtra
                country: IND
                area_code: "400053"
                locality: my street name
                name: my house or door or floor
              phone: "9898989898"
              name: ONDC buyer
              email: nobody@nomail.com
              created_at: 2024-12-23T07:01:43.145Z
              updated_at: 2024-12-23T07:01:43.145Z
            fulfillments:
              - id: F1
                "@ondc/org/provider_name": 24x7 Wellness Forever - ANDHERI FOUR BUNGLOW
                state:
                  descriptor:
                    code: Packed
                customer:
                  id: CUST_001
                  organization:
                    descriptor:
                      name: Sharma Kirana Store
                  person:
                    creds:
                      - id: 29AABCU9603R1ZM
                        type: GSTIN
                      - id: AABCU9603R
                        type: PAN
                type: Delivery
                tracking: true
                "@ondc/org/TAT": PT60M
                start:
                  location:
                    id: L1
                    descriptor:
                      name: ABC Store
                    gps: 19.129076,72.825803
                    address:
                      building: my building name or house
                      city: Mumbai
                      state: Maharashtra
                      country: IND
                      area_code: "400053"
                      locality: my street name
                      name: my house or door or floor
                  time:
                    range:
                      start: 2024-12-23T07:03:32.230Z
                      end: 2024-12-23T07:08:32.230Z
                  contact:
                    phone: "9594663710"
                    email: nobody@nomail.com
                end:
                  person:
                    name: John Doe
                  contact:
                    email: nobody@nomail.com
                    phone: "9898989898"
                  location:
                    gps: 19.131140,72.834091
                    address:
                      building: my building name or house
                      city: Mumbai
                      state: Maharashtra
                      country: IND
                      area_code: "400053"
                      locality: my street name
                      name: my house or door or floor
                  time:
                    range:
                      start: 2024-12-23T07:33:32.230Z
                      end: 2024-12-23T07:04:32.230Z
                tags:
                  - code: routing
                    list:
                      - code: type
                        value: P2P
                  - code: tracking
                    list:
                      - code: gps_enabled
                        value: no
                      - code: url_enabled
                        value: yes
                      - code: url
                        value: https://sellerNP.com/ondc/tracking_url
            quote:
              price:
                currency: INR
                value: "100.00"
              breakup:
                - "@ondc/org/item_id": I1
                  "@ondc/org/item_quantity":
                    count: 1
                  title: Plain Atta
                  "@ondc/org/title_type": item
                  price:
                    currency: INR
                    value: "100"
                  item:
                    price:
                      currency: INR
                      value: "100.00"
                - "@ondc/org/item_id": I1
                  title: Delivery charges
                  "@ondc/org/title_type": delivery
                  price:
                    currency: INR
                    value: "00.00"
                - "@ondc/org/item_id": I1
                  title: Convenience Fee
                  "@ondc/org/title_type": misc
                  price:
                    currency: INR
                    value: "00.00"
              ttl: P1D
            payment:
              params:
                amount: "100.00"
                currency: INR
                transaction_id: order_PjggJp7MccQmAa
              status: PAID
              type: ON-ORDER
              collected_by: BAP
              "@ondc/org/buyer_app_finder_fee_type": percent
              "@ondc/org/buyer_app_finder_fee_amount": "3.0"
              "@ondc/org/settlement_details":
                - settlement_counterparty: seller-app
                  settlement_phase: sale-amount
                  settlement_type: neft
                  beneficiary_name: xxxx
                  settlement_bank_account_no: xxxx
                  settlement_ifsc_code: xxxx
                  bank_name: xxxx
                  branch_name: xxxx
            created_at: 2024-12-23T07:03:30.516Z
            updated_at: 2024-12-23T07:03:35.230Z
      saveData:
        transactionId: $.context.transaction_id
        latestMessage_id: $.context.message_id
        latestTimestamp: $.context.timestamp
        bapId: $.context.bap_id
        bapUri: $.context.bap_uri
        bppId: $.context.bpp_id
        bppUri: $.context.bpp_uri
        order_state: $.message.order.state
        on_status_fulfillments: $.message.order.fulfillments[*]
        last_updated_at: $.message.order.updated_at
      inputs: {}
  - api: on_status
    action_id: on_status_agent_assigned
    owner: BPP
    responseFor: null
    unsolicited: true
    description: On-status call which is sent when an agent is assigned
    mock:
      generate: LyoqCiAqIEdlbmVyYXRlcyB0aGUgbW9jayBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgY3VzdG9taXphdGlvbiBvZiB0aGUgZGVmYXVsdCBwYXlsb2FkIHVzaW5nIHNlc3Npb24gZGF0YQogKiBmcm9tIHByZXZpb3VzIHN0ZXBzIGFuZCB1c2VyIGlucHV0cy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSBkZWZhdWx0UGF5bG9hZCAtIFRoZSBiYXNlIHBheWxvYWQgb2JqZWN0IHdpdGggY29udGV4dCBhbHJlYWR5IHBvcHVsYXRlZC4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhLnVzZXJfaW5wdXRzIC0gVXNlci1wcm92aWRlZCBpbnB1dCB2YWx1ZXMgZm9yIHRoaXMgc3RlcC4KICogQHBhcmFtIHsqfSBzZXNzaW9uRGF0YS5ba2V5XSAtIEFueSBzYXZlZCBkYXRhIGZyb20gcHJldmlvdXMgc3RlcHMgKGRlZmluZWQgaW4gc2F2ZURhdGEgY29uZmlnKS4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBnZW5lcmF0ZWQgcGF5bG9hZCBvYmplY3QgdG8gYmUgc2VudCBpbiB0aGUgQVBJIHJlcXVlc3QuCiAqLwpjb25zdCBpc29EdXJUb1NlYyA9IChkdXJhdGlvbikgPT4gewogIGNvbnN0IGR1clJFID0KICAgIC9QKChcZCspWSk/KChcZCspTSk/KChcZCspVyk/KChcZCspRCk/VD8oKFxkKylIKT8oKFxkKylNKT8oKFxkKylTKT8vOwoKICBjb25zdCBzcGxpdFRpbWUgPSBkdXJSRS5leGVjKGR1cmF0aW9uKTsKICBpZiAoIXNwbGl0VGltZSkgewogICAgcmV0dXJuIDA7CiAgfQoKICBjb25zdCB5ZWFycyA9IE51bWJlcihzcGxpdFRpbWU/LlsyXSkgfHwgMDsKICBjb25zdCBtb250aHMgPSBOdW1iZXIoc3BsaXRUaW1lPy5bNF0pIHx8IDA7CiAgY29uc3Qgd2Vla3MgPSBOdW1iZXIoc3BsaXRUaW1lPy5bNl0pIHx8IDA7CiAgY29uc3QgZGF5cyA9IE51bWJlcihzcGxpdFRpbWU/Lls4XSkgfHwgMDsKICBjb25zdCBob3VycyA9IE51bWJlcihzcGxpdFRpbWU/LlsxMF0pIHx8IDA7CiAgY29uc3QgbWludXRlcyA9IE51bWJlcihzcGxpdFRpbWU/LlsxMl0pIHx8IDA7CiAgY29uc3Qgc2Vjb25kcyA9IE51bWJlcihzcGxpdFRpbWU/LlsxNF0pIHx8IDA7CgogIGNvbnN0IHJlc3VsdCA9CiAgICB5ZWFycyAqIDMxNTM2MDAwICsKICAgIG1vbnRocyAqIDI2MjgyODggKwogICAgd2Vla3MgKiA2MDQ4MDAgKwogICAgZGF5cyAqIDg2NDAwICsKICAgIGhvdXJzICogMzYwMCArCiAgICBtaW51dGVzICogNjAgKwogICAgc2Vjb25kczsKCiAgcmV0dXJuIHJlc3VsdDsKfTsKZnVuY3Rpb24gZ2V0VXBkYXRlZEJpbGxpbmcoc2F2ZWRCaWxsaW5nLCBpbml0aWFsaXplID0gZmFsc2UpIHsKICBpZiAoaW5pdGlhbGl6ZSkgewogICAgY29uc3QgbmV3SXNvID0gbmV3IERhdGUobmV3IERhdGUoKS5nZXRUaW1lKCkgLSA1ICogMTAwMCkudG9JU09TdHJpbmcoKTsKICAgIHNhdmVkQmlsbGluZy5jcmVhdGVkX2F0ID0gbmV3SXNvOwogICAgc2F2ZWRCaWxsaW5nLnVwZGF0ZWRfYXQgPSBuZXdJc287CiAgfQogIHJldHVybiBzYXZlZEJpbGxpbmc7Cn0KZnVuY3Rpb24gY3JlYXRlR2VuZXJpY09uU3RhdHVzKAoJZXhpc3RpbmdQYXlsb2FkLAoJc2Vzc2lvbkRhdGEKKSB7CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5pZCA9IHNlc3Npb25EYXRhLm9yZGVyX2lkWzBdOwoJZXhpc3RpbmdQYXlsb2FkLm1lc3NhZ2Uub3JkZXIucHJvdmlkZXIgPSBzZXNzaW9uRGF0YS5wcm92aWRlclswXTsKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLml0ZW1zID0gc2Vzc2lvbkRhdGEuaXRlbXM7CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5iaWxsaW5nID0gZ2V0VXBkYXRlZEJpbGxpbmcoCgkJc2Vzc2lvbkRhdGEuYmlsbGluZ1swXQoJKTsKCS8vIGV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLmZ1bGZpbGxtZW50cyA9IHNlc3Npb25EYXRhLmZ1bGZpbGxtZW50czsKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLnF1b3RlID0gc2Vzc2lvbkRhdGEucXVvdGVbMF07Cgljb25zdCB0aW1lSVNPID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpOwoJZXhpc3RpbmdQYXlsb2FkLm1lc3NhZ2Uub3JkZXIudXBkYXRlZF9hdCA9IHRpbWVJU087CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5jcmVhdGVkX2F0ID0gc2Vzc2lvbkRhdGEub3JkZXJfY3JlYXRlZF9hdFswXTsKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLnBheW1lbnQgPSBzZXNzaW9uRGF0YS5wYXltZW50WzBdOwoJcmV0dXJuIGV4aXN0aW5nUGF5bG9hZDsKfQpmdW5jdGlvbiBjcmVhdGVGdWxmaWxsbWVudHMoCiAgYWN0aW9uLAogIGFjdGlvbklkLAogIHNlc3Npb25EYXRhLAogIGRlZmF1bHRGdWxmaWxsbWVudHMKKSB7CiAgaWYgKGRlZmF1bHRGdWxmaWxsbWVudHMubGVuZ3RoIDwgMSkgewogICAgdGhyb3cgbmV3IEVycm9yKCJFbXB0eSBmdWxmaWxsbWVudHMgZm91bmQiKTsKICB9CiAgaWYgKGFjdGlvbiA9PT0gIm9uX3N0YXR1cyIpIHsKICAgIGxldCBmdWxmaWxsbWVudHMgPSBzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHM7CiAgICBjb25zdCB0YWdzID0gewogICAgICB0YWdzOiBbCiAgICAgICAgewogICAgICAgICAgY29kZTogInJvdXRpbmciLAogICAgICAgICAgbGlzdDogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29kZTogInR5cGUiLAogICAgICAgICAgICAgIHZhbHVlOiAiUDJIMlAiLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGNvZGU6ICJ0cmFja2luZyIsCiAgICAgICAgICBsaXN0OiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb2RlOiAiZ3BzX2VuYWJsZWQiLAogICAgICAgICAgICAgIHZhbHVlOiAibm8iLAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29kZTogInVybF9lbmFibGVkIiwKICAgICAgICAgICAgICB2YWx1ZTogInllcyIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb2RlOiAidXJsIiwKICAgICAgICAgICAgICB2YWx1ZTogImh0dHBzOi8vc2VsbGVyTlAuY29tL29uZGMvdHJhY2tpbmdfdXJsIiwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgfSwKICAgICAgXSwKICAgIH07CiAgICBsZXQgZmluYWxGdWxmaWxsbWVudHMgPSBzZXNzaW9uRGF0YS5vbl9zdGF0dXNfZnVsZmlsbG1lbnRzOwogICAgaWYgKCFzZXNzaW9uRGF0YS5vbl9zdGF0dXNfZnVsZmlsbG1lbnRzKSB7CiAgICAgIGNvbnN0IHRpbWUgPSBuZXcgRGF0ZShuZXcgRGF0ZSgpLmdldFRpbWUoKSArIDEwICogMTAwMCAqIDYwKTsKICAgICAgY29uc3Qgc3RhcnRfZW5kID0gbmV3IERhdGUodGltZS5nZXRUaW1lKCkgKyAxMCAqIDEwMDAgKiA2MCkudG9JU09TdHJpbmcoKTsKICAgICAgZmluYWxGdWxmaWxsbWVudHMgPSBmdWxmaWxsbWVudHMKICAgICAgICAvLyAuZmlsdGVyKChmKSA9PiBmLnR5cGUgPT0gIkRlbGl2ZXJ5IikKICAgICAgICAubWFwKChmKSA9PiB7CiAgICAgICAgICBpZiAoZi50eXBlID09ICJEZWxpdmVyeSIpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAuLi5mLAogICAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgICAuLi5mLnN0YXJ0LAogICAgICAgICAgICAgICAgdGltZTogewogICAgICAgICAgICAgICAgICByYW5nZTogewogICAgICAgICAgICAgICAgICAgIHN0YXJ0OiB0aW1lLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgICAgZW5kOiBzdGFydF9lbmQsCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgICAuLi5mLmVuZCwKICAgICAgICAgICAgICAgIHRpbWU6IHsKICAgICAgICAgICAgICAgICAgcmFuZ2U6IHsKICAgICAgICAgICAgICAgICAgICBzdGFydDogc3RhcnRfZW5kLAogICAgICAgICAgICAgICAgICAgIGVuZDogbmV3IERhdGUoCiAgICAgICAgICAgICAgICAgICAgICB0aW1lLmdldFRpbWUoKSArCiAgICAgICAgICAgICAgICAgICAgICAxMDAwICogaXNvRHVyVG9TZWMoZlsiQG9uZGMvb3JnL1RBVCJdIHx8ICJQVDBIIikKICAgICAgICAgICAgICAgICAgICApLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgdGFnczogdGFncy50YWdzLAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGY7CiAgICAgICAgfSk7CiAgICAgIC8vIGZ1bGZpbGxtZW50cyA9IGZ1bGZpbGxtZW50cy5maWx0ZXIoKGYpID0+IGYudHlwZSAhPSAiRGVsaXZlcnkiKTsKICAgICAgLy8gZmluYWxGdWxmaWxsbWVudHMgPSB7IC4uLmZpbmFsRnVsZmlsbG1lbnRzLCAuLi5mdWxmaWxsbWVudHMgfTsKICAgIH0KICAgIGxldCBzdGF0ZSA9ICJQZW5kaW5nIjsKICAgIHN3aXRjaCAoYWN0aW9uSWQpIHsKICAgICAgY2FzZSAib25fc3RhdHVzX3BhY2tlZCI6CiAgICAgICAgc3RhdGUgPSAiUGFja2VkIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAib25fc3RhdHVzX2FjY2VwdGVkIjoKICAgICAgICBzdGF0ZSA9ICJQZW5kaW5nIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAib25fc3RhdHVzX2FnZW50X2Fzc2lnbmVkIjoKICAgICAgICBzdGF0ZSA9ICJBZ2VudC1hc3NpZ25lZCI7CgogICAgICAgIGZpbmFsRnVsZmlsbG1lbnRzID0gZmluYWxGdWxmaWxsbWVudHMubWFwKChmKSA9PiB7CiAgICAgICAgICBpZiAoZi50eXBlID09PSAiRGVsaXZlcnkiKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgLi4uZiwKICAgICAgICAgICAgICBhZ2VudDogewogICAgICAgICAgICAgICAgbmFtZTogIm1vY2stYWdlbnQiLAogICAgICAgICAgICAgICAgcGhvbmU6ICI5ODg2MDk4ODYwIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGY7IC8vIGxlYXZlIG90aGVyIHR5cGVzIHVuY2hhbmdlZAogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJvbl9zdGF0dXNfcGlja2VkIjoKICAgICAgICBzdGF0ZSA9ICJPcmRlci1waWNrZWQtdXAiOwogICAgICAgIGZpbmFsRnVsZmlsbG1lbnRzID0gZmluYWxGdWxmaWxsbWVudHMubWFwKChmKSA9PiB7CiAgICAgICAgICBpZiAoZi50eXBlID09PSAiRGVsaXZlcnkiKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgLi4uZiwKICAgICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgICAgLi4uZi5zdGFydCwKICAgICAgICAgICAgICAgIHRpbWU6IHsKICAgICAgICAgICAgICAgICAgLi4uZi5zdGFydD8udGltZSwKICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZjsgLy8gbGVhdmUgb3RoZXIgdHlwZXMgdW5jaGFuZ2VkCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIm9uX3N0YXR1c19vdXRfZm9yX2RlbGl2ZXJ5IjoKICAgICAgICBzdGF0ZSA9ICJPdXQtZm9yLWRlbGl2ZXJ5IjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAib25fc3RhdHVzX29yZGVyX2RlbGl2ZXJlZCI6CiAgICAgICAgc3RhdGUgPSAiT3JkZXItZGVsaXZlcmVkIjsKICAgICAgICBmaW5hbEZ1bGZpbGxtZW50cyA9IGZpbmFsRnVsZmlsbG1lbnRzLm1hcCgoZikgPT4gewogICAgICAgICAgaWYgKGYudHlwZSA9PT0gIkRlbGl2ZXJ5IikgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIC4uLmYsCiAgICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgICAuLi5mLmVuZCwKICAgICAgICAgICAgICAgIHRpbWU6IHsKICAgICAgICAgICAgICAgICAgLi4uZi5lbmQ/LnRpbWUsCiAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGY7IC8vIGxlYXZlIG90aGVyIHR5cGVzIHVuY2hhbmdlZAogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJvbl9zdGF0dXNfcnRvX2RlbGl2ZXJlZCI6CiAgICAgICAgc3RhdGUgPSAiQ2FuY2VsbGVkIjsKICAgICAgICBmaW5hbEZ1bGZpbGxtZW50cyA9IGZpbmFsRnVsZmlsbG1lbnRzLm1hcCgoZikgPT4gewogICAgICAgICAgaWYgKGYudHlwZSA9PT0gIlJUTyIpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAuLi5mLAogICAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgICAgLi4uZi5lbmQsCiAgICAgICAgICAgICAgICB0aW1lOiB7CiAgICAgICAgICAgICAgICAgIC4uLmYuZW5kPy50aW1lLAogICAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzdGF0ZTogewogICAgICAgICAgICAgICAgZGVzY3JpcHRvcjogewogICAgICAgICAgICAgICAgICBjb2RlOiAiUlRPLURlbGl2ZXJlZCIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZi50eXBlID09PSAiRGVsaXZlcnkiKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgLi4uZiwKICAgICAgICAgICAgICBzdGF0ZTogewogICAgICAgICAgICAgICAgZGVzY3JpcHRvcjogewogICAgICAgICAgICAgICAgICBjb2RlOiAiQ2FuY2VsbGVkIiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmOyAvLyBsZWF2ZSBvdGhlciB0eXBlcyB1bmNoYW5nZWQKICAgICAgICB9KTsKCiAgICAgIGNhc2UgIm9uX3N0YXR1c19yZWFkeV90b19zaGlwIjoKICAgICAgICBzdGF0ZSA9ICJQYWNrZWQiOwogICAgICAgIGZpbmFsRnVsZmlsbG1lbnRzID0gZmluYWxGdWxmaWxsbWVudHMubWFwKChmKSA9PiB7CiAgICAgICAgICBpZiAoZi50eXBlID09PSAiQnV5ZXItRGVsaXZlcnkiKSB7CiAgICAgICAgICAgIGNvbnN0IHRhZ3MgPSBmLnRhZ3MgfHwgW107CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgLi4uZiwKICAgICAgICAgICAgICB0YWdzOiBbCiAgICAgICAgICAgICAgICAuLi50YWdzLAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBjb2RlOiAic3RhdGUiLAogICAgICAgICAgICAgICAgICBsaXN0OiBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgY29kZTogInJlYWR5X3RvX3NoaXAiLAogICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICJ5ZXMiLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBjb2RlOiAicm91dGluZyIsCiAgICAgICAgICAgICAgICAgIGxpc3Q6IFsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICBjb2RlOiAidHlwZSIsCiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogIlAyUCIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmOyAKICAgICAgICB9KTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBmaW5hbEZ1bGZpbGxtZW50cyA9IGZpbmFsRnVsZmlsbG1lbnRzLm1hcCgoZikgPT4gewogICAgICBpZiAoZi50eXBlID09PSAiRGVsaXZlcnkiKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIC4uLmYsCiAgICAgICAgICBzdGF0ZTogewogICAgICAgICAgICBkZXNjcmlwdG9yOiB7CiAgICAgICAgICAgICAgY29kZTogc3RhdGUsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgIH07CiAgICAgIH0KICAgICAgcmV0dXJuIGY7CiAgICB9KTsKICAgIHJldHVybiBmaW5hbEZ1bGZpbGxtZW50czsKICB9CiAgcmV0dXJuIGRlZmF1bHRGdWxmaWxsbWVudHM7Cn0KCmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlKAoJZGVmYXVsdFBheWxvYWQsCglzZXNzaW9uRGF0YQopIHsKCWNvbnN0IGdlbmVyYWxQYXlsb2FkID0gY3JlYXRlR2VuZXJpY09uU3RhdHVzKGRlZmF1bHRQYXlsb2FkLCBzZXNzaW9uRGF0YSk7CglnZW5lcmFsUGF5bG9hZC5tZXNzYWdlLm9yZGVyLmZ1bGZpbGxtZW50cyA9IGNyZWF0ZUZ1bGZpbGxtZW50cygKCQkib25fc3RhdHVzIiwKCQkib25fc3RhdHVzX2FnZW50X2Fzc2lnbmVkIiwKCQlzZXNzaW9uRGF0YSwKCQlnZW5lcmFsUGF5bG9hZC5tZXNzYWdlLm9yZGVyLmZ1bGZpbGxtZW50cwoJKTsKCXJldHVybiBnZW5lcmFsUGF5bG9hZDsKfQoK
      validate: LyoqCiAqIFZhbGlkYXRlcyB0aGUgaW5jb21pbmcgcmVxdWVzdCBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXRQYXlsb2FkIC0gVGhlIGluY29taW5nIHJlcXVlc3QgcGF5bG9hZCB0byB2YWxpZGF0ZS4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiB2YWxpZGF0ZSh0YXJnZXRQYXlsb2FkLCBzZXNzaW9uRGF0YSkgewogIHJldHVybiB7IHZhbGlkOiB0cnVlLCBjb2RlOiAyMDAsIGRlc2NyaXB0aW9uOiAiVmFsaWQgcmVxdWVzdCIgfTsKfQ==
      requirements: LyoqCiAqIENoZWNrcyBpZiB0aGUgcmVxdWlyZW1lbnRzIGZvciBwcm9jZWVkaW5nIHdpdGggdGhlIEFQSSBjYWxsIGFyZSBtZXQuCiAqIAogKiBAcGFyYW0ge09iamVjdH0gc2Vzc2lvbkRhdGEgLSBEYXRhIGNvbGxlY3RlZCBmcm9tIHByZXZpb3VzIHRyYW5zYWN0aW9uIHN0ZXBzLgogKiAKICogQHJldHVybnMge09iamVjdH0geyB2YWxpZDogYm9vbGVhbiwgY29kZTogbnVtYmVyLCBkZXNjcmlwdGlvbjogc3RyaW5nIH0KICovCmZ1bmN0aW9uIG1lZXRSZXF1aXJlbWVudHMoc2Vzc2lvbkRhdGEpIHsKICAvLyBDaGVjayBmb3Igc2VsZWN0ZWRfaXRlbXMKICBpZiAoIXNlc3Npb25EYXRhLnNlbGVjdGVkX2l0ZW1zIHx8IHNlc3Npb25EYXRhLnNlbGVjdGVkX2l0ZW1zLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHNlbGVjdGVkX2l0ZW1zIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19TRUxFQ1RFRF9JVEVNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHBheWxvYWRfY2l0eQogIGlmICghc2Vzc2lvbkRhdGEucGF5bG9hZF9jaXR5KSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gcGF5bG9hZF9jaXR5IGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19QQVlMT0FEX0NJVFkiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBzZWxlY3RlZF9mdWxmaWxsbWVudHMKICBpZiAoCiAgICAhc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfZnVsZmlsbG1lbnRzIHx8CiAgICBzZXNzaW9uRGF0YS5zZWxlY3RlZF9mdWxmaWxsbWVudHMubGVuZ3RoID09PSAwCiAgKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gc2VsZWN0ZWRfZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19TRUxFQ1RFRF9GVUxGSUxMTUVOVFMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBwcm92aWRlcgogIGlmICghc2Vzc2lvbkRhdGEucHJvdmlkZXIpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBwcm92aWRlciBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUFJPVklERVIiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBxdW90ZQogIGlmICghc2Vzc2lvbkRhdGEucXVvdGUgfHwgdHlwZW9mIHNlc3Npb25EYXRhLnF1b3RlICE9PSAib2JqZWN0IikgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHF1b3RlIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19RVU9URSIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9uX3NlbGVjdF9mdWxmaWxsbWVudHMKICBpZiAoCiAgICAhc2Vzc2lvbkRhdGEub25fc2VsZWN0X2Z1bGZpbGxtZW50cyB8fAogICAgc2Vzc2lvbkRhdGEub25fc2VsZWN0X2Z1bGZpbGxtZW50cy5sZW5ndGggPT09IDAKICApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBvbl9zZWxlY3RfZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19PTl9TRUxFQ1RfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3Igb25fc2VsZWN0X2l0ZW1zCiAgaWYgKAogICAgIXNlc3Npb25EYXRhLm9uX3NlbGVjdF9pdGVtcyB8fAogICAgc2Vzc2lvbkRhdGEub25fc2VsZWN0X2l0ZW1zLmxlbmd0aCA9PT0gMAogICkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIG9uX3NlbGVjdF9pdGVtcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfT05fU0VMRUNUX0lURU1TIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgdGF0CiAgaWYgKCFzZXNzaW9uRGF0YS50YXQpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyB0YXQgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1RBVCIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIGl0ZW1zCiAgaWYgKCFzZXNzaW9uRGF0YS5pdGVtcyB8fCBzZXNzaW9uRGF0YS5pdGVtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBpdGVtcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfSVRFTVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBiaWxsaW5nCiAgaWYgKCFzZXNzaW9uRGF0YS5iaWxsaW5nIHx8IHR5cGVvZiBzZXNzaW9uRGF0YS5iaWxsaW5nICE9PSAib2JqZWN0IikgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIGJpbGxpbmcgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0JJTExJTkciLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBmdWxmaWxsbWVudHMKICBpZiAoIXNlc3Npb25EYXRhLmZ1bGZpbGxtZW50cyB8fCBzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19GVUxGSUxMTUVOVFMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBzZWxlY3RlZF9ucF9mZWVzCiAgaWYgKCFzZXNzaW9uRGF0YS5zZWxlY3RlZF9ucF9mZWVzKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gc2VsZWN0ZWRfbnBfZmVlcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU0VMRUNURURfTlBfRkVFUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIGJwcF90ZXJtcwogIGlmICghc2Vzc2lvbkRhdGEuYnBwX3Rlcm1zIHx8IHNlc3Npb25EYXRhLmJwcF90ZXJtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBicHBfdGVybXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0JQUF9URVJNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9yZGVyX2lkCiAgaWYgKCFzZXNzaW9uRGF0YS5vcmRlcl9pZCkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIG9yZGVyX2lkIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19PUkRFUl9JRCIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIGJhcF90ZXJtcwogIGlmICghc2Vzc2lvbkRhdGEuYmFwX3Rlcm1zIHx8IHNlc3Npb25EYXRhLmJhcF90ZXJtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBiYXBfdGVybXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0JBUF9URVJNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHN0YXRlCiAgaWYgKCFzZXNzaW9uRGF0YS5zdGF0ZSkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHN0YXRlIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19TVEFURSIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHBheW1lbnQKICBpZiAoIXNlc3Npb25EYXRhLnBheW1lbnQgfHwgdHlwZW9mIHNlc3Npb25EYXRhLnBheW1lbnQgIT09ICJvYmplY3QiKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gcGF5bWVudCBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUEFZTUVOVCIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9uX3N0YXR1c19mdWxmaWxsbWVudHMgKE5FVykKICBpZiAoCiAgICAhc2Vzc2lvbkRhdGEub25fc3RhdHVzX2Z1bGZpbGxtZW50cyB8fAogICAgc2Vzc2lvbkRhdGEub25fc3RhdHVzX2Z1bGZpbGxtZW50cy5sZW5ndGggPT09IDAKICApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBvbl9zdGF0dXNfZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19PTl9TVEFUVVNfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBBbGwgcmVxdWlyZW1lbnRzIHNhdGlzZmllZAogIHJldHVybiB7CiAgICB2YWxpZDogdHJ1ZSwKICAgIGRlc2NyaXB0aW9uOiAiQWxsIENoZWNrcyBwYXNzZWQgc3VjY2Vzc2Z1bGx5IiwKICAgIGNvZGU6ICIyMDAiLAogIH07Cn0K
      defaultPayload:
        context:
          domain: ONDC:RETeB2B
          action: on_status
          timestamp: 2025-12-29T10:56:14.199Z
          transaction_id: 3cd7243a-eef8-42e1-8d12-9c76eab6fcea
          message_id: af2a3c40-b7cf-42d7-a761-b782fece87cd
          bap_id: sample-bap-id
          bap_uri: https://bap.example.com
          ttl: PT30S
          bpp_id: sample-bpp-id
          bpp_uri: https://bpp.example.com
          country: IND
          city: "*"
          core_version: 1.2.5
        message:
          order:
            id: O1
            state: In-progress
            provider:
              id: P1
              locations:
                - id: L1
            items:
              - id: I1
                quantity:
                  count: 1
                fulfillment_id: F1
            billing:
              address:
                building: my building name or house
                city: Mumbai
                state: Maharashtra
                country: IND
                area_code: "400053"
                locality: my street name
                name: my house or door or floor
              phone: "9898989898"
              name: ONDC buyer
              email: nobody@nomail.com
              created_at: 2024-12-23T07:01:43.145Z
              updated_at: 2024-12-23T07:01:43.145Z
            fulfillments:
              - id: F1
                "@ondc/org/provider_name": 24x7 Wellness Forever - ANDHERI FOUR BUNGLOW
                state:
                  descriptor:
                    code: Agent-assigned
                type: Delivery
                tracking: true
                "@ondc/org/TAT": PT60M
                start:
                  location:
                    id: L1
                    descriptor:
                      name: ABC Store
                    gps: 19.129076,72.825803
                    address:
                      building: my building name or house
                      city: Mumbai
                      state: Maharashtra
                      country: IND
                      area_code: "400053"
                      locality: my street name
                      name: my house or door or floor
                  time:
                    range:
                      start: 2024-12-23T07:03:32.230Z
                      end: 2024-12-23T07:08:32.230Z
                  contact:
                    phone: "9594663710"
                    email: nobody@nomail.com
                end:
                  person:
                    name: John Doe
                  contact:
                    email: nobody@nomail.com
                    phone: "9898989898"
                  location:
                    gps: 19.131140,72.834091
                    address:
                      building: my building name or house
                      city: Mumbai
                      state: Maharashtra
                      country: IND
                      area_code: "400053"
                      locality: my street name
                      name: my house or door or floor
                  time:
                    range:
                      start: 2024-12-23T07:33:32.230Z
                      end: 2024-12-23T07:04:32.230Z
                tags:
                  - code: routing
                    list:
                      - code: type
                        value: P2P
                  - code: tracking
                    list:
                      - code: gps_enabled
                        value: yes
                      - code: url_enabled
                        value: no
                      - code: url
                        value: https://sellerNP.com/ondc/tracking_url
            quote:
              price:
                currency: INR
                value: "100.00"
              breakup:
                - "@ondc/org/item_id": I1
                  "@ondc/org/item_quantity":
                    count: 1
                  title: Plain Atta
                  "@ondc/org/title_type": item
                  price:
                    currency: INR
                    value: "100"
                  item:
                    price:
                      currency: INR
                      value: "100.00"
                - "@ondc/org/item_id": I1
                  title: Delivery charges
                  "@ondc/org/title_type": delivery
                  price:
                    currency: INR
                    value: "00.00"
                - "@ondc/org/item_id": I1
                  title: Convenience Fee
                  "@ondc/org/title_type": misc
                  price:
                    currency: INR
                    value: "00.00"
              ttl: P1D
            payment:
              params:
                amount: "100.00"
                currency: INR
                transaction_id: order_PjggJp7MccQmAa
              status: PAID
              type: ON-ORDER
              collected_by: BAP
              "@ondc/org/buyer_app_finder_fee_type": percent
              "@ondc/org/buyer_app_finder_fee_amount": "3.0"
              "@ondc/org/settlement_details":
                - settlement_counterparty: seller-app
                  settlement_phase: sale-amount
                  settlement_type: neft
                  beneficiary_name: xxxx
                  settlement_bank_account_no: xxxx
                  settlement_ifsc_code: xxxx
                  bank_name: xxxx
                  branch_name: xxxx
            created_at: 2024-12-23T07:03:30.516Z
            updated_at: 2024-12-23T07:04:58.230Z
      saveData:
        transactionId: $.context.transaction_id
        latestMessage_id: $.context.message_id
        latestTimestamp: $.context.timestamp
        bapId: $.context.bap_id
        bapUri: $.context.bap_uri
        bppId: $.context.bpp_id
        bppUri: $.context.bpp_uri
        order_state: $.message.order.state
        on_status_fulfillments: $.message.order.fulfillments[*]
        last_updated_at: $.message.order.updated_at
      inputs: {}
  - api: on_status
    action_id: on_status_picked
    owner: BPP
    responseFor: null
    unsolicited: true
    description: On-status call when the rider picks up the order
    mock:
      generate: LyoqCiAqIEdlbmVyYXRlcyB0aGUgbW9jayBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgY3VzdG9taXphdGlvbiBvZiB0aGUgZGVmYXVsdCBwYXlsb2FkIHVzaW5nIHNlc3Npb24gZGF0YQogKiBmcm9tIHByZXZpb3VzIHN0ZXBzIGFuZCB1c2VyIGlucHV0cy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSBkZWZhdWx0UGF5bG9hZCAtIFRoZSBiYXNlIHBheWxvYWQgb2JqZWN0IHdpdGggY29udGV4dCBhbHJlYWR5IHBvcHVsYXRlZC4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhLnVzZXJfaW5wdXRzIC0gVXNlci1wcm92aWRlZCBpbnB1dCB2YWx1ZXMgZm9yIHRoaXMgc3RlcC4KICogQHBhcmFtIHsqfSBzZXNzaW9uRGF0YS5ba2V5XSAtIEFueSBzYXZlZCBkYXRhIGZyb20gcHJldmlvdXMgc3RlcHMgKGRlZmluZWQgaW4gc2F2ZURhdGEgY29uZmlnKS4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBnZW5lcmF0ZWQgcGF5bG9hZCBvYmplY3QgdG8gYmUgc2VudCBpbiB0aGUgQVBJIHJlcXVlc3QuCiAqLwpjb25zdCBpc29EdXJUb1NlYyA9IChkdXJhdGlvbikgPT4gewogIGNvbnN0IGR1clJFID0KICAgIC9QKChcZCspWSk/KChcZCspTSk/KChcZCspVyk/KChcZCspRCk/VD8oKFxkKylIKT8oKFxkKylNKT8oKFxkKylTKT8vOwoKICBjb25zdCBzcGxpdFRpbWUgPSBkdXJSRS5leGVjKGR1cmF0aW9uKTsKICBpZiAoIXNwbGl0VGltZSkgewogICAgcmV0dXJuIDA7CiAgfQoKICBjb25zdCB5ZWFycyA9IE51bWJlcihzcGxpdFRpbWU/LlsyXSkgfHwgMDsKICBjb25zdCBtb250aHMgPSBOdW1iZXIoc3BsaXRUaW1lPy5bNF0pIHx8IDA7CiAgY29uc3Qgd2Vla3MgPSBOdW1iZXIoc3BsaXRUaW1lPy5bNl0pIHx8IDA7CiAgY29uc3QgZGF5cyA9IE51bWJlcihzcGxpdFRpbWU/Lls4XSkgfHwgMDsKICBjb25zdCBob3VycyA9IE51bWJlcihzcGxpdFRpbWU/LlsxMF0pIHx8IDA7CiAgY29uc3QgbWludXRlcyA9IE51bWJlcihzcGxpdFRpbWU/LlsxMl0pIHx8IDA7CiAgY29uc3Qgc2Vjb25kcyA9IE51bWJlcihzcGxpdFRpbWU/LlsxNF0pIHx8IDA7CgogIGNvbnN0IHJlc3VsdCA9CiAgICB5ZWFycyAqIDMxNTM2MDAwICsKICAgIG1vbnRocyAqIDI2MjgyODggKwogICAgd2Vla3MgKiA2MDQ4MDAgKwogICAgZGF5cyAqIDg2NDAwICsKICAgIGhvdXJzICogMzYwMCArCiAgICBtaW51dGVzICogNjAgKwogICAgc2Vjb25kczsKCiAgcmV0dXJuIHJlc3VsdDsKfTsKZnVuY3Rpb24gZ2V0VXBkYXRlZEJpbGxpbmcoc2F2ZWRCaWxsaW5nLCBpbml0aWFsaXplID0gZmFsc2UpIHsKICBpZiAoaW5pdGlhbGl6ZSkgewogICAgY29uc3QgbmV3SXNvID0gbmV3IERhdGUobmV3IERhdGUoKS5nZXRUaW1lKCkgLSA1ICogMTAwMCkudG9JU09TdHJpbmcoKTsKICAgIHNhdmVkQmlsbGluZy5jcmVhdGVkX2F0ID0gbmV3SXNvOwogICAgc2F2ZWRCaWxsaW5nLnVwZGF0ZWRfYXQgPSBuZXdJc287CiAgfQogIHJldHVybiBzYXZlZEJpbGxpbmc7Cn0KZnVuY3Rpb24gY3JlYXRlR2VuZXJpY09uU3RhdHVzKAoJZXhpc3RpbmdQYXlsb2FkLAoJc2Vzc2lvbkRhdGEKKSB7CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5pZCA9IHNlc3Npb25EYXRhLm9yZGVyX2lkWzBdOwoJZXhpc3RpbmdQYXlsb2FkLm1lc3NhZ2Uub3JkZXIucHJvdmlkZXIgPSBzZXNzaW9uRGF0YS5wcm92aWRlclswXTsKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLml0ZW1zID0gc2Vzc2lvbkRhdGEuaXRlbXM7CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5iaWxsaW5nID0gZ2V0VXBkYXRlZEJpbGxpbmcoCgkJc2Vzc2lvbkRhdGEuYmlsbGluZ1swXQoJKTsKCS8vIGV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLmZ1bGZpbGxtZW50cyA9IHNlc3Npb25EYXRhLmZ1bGZpbGxtZW50czsKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLnF1b3RlID0gc2Vzc2lvbkRhdGEucXVvdGVbMF07Cgljb25zdCB0aW1lSVNPID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpOwoJZXhpc3RpbmdQYXlsb2FkLm1lc3NhZ2Uub3JkZXIudXBkYXRlZF9hdCA9IHRpbWVJU087CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5jcmVhdGVkX2F0ID0gc2Vzc2lvbkRhdGEub3JkZXJfY3JlYXRlZF9hdFswXTsKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLnBheW1lbnQgPSBzZXNzaW9uRGF0YS5wYXltZW50WzBdOwoJcmV0dXJuIGV4aXN0aW5nUGF5bG9hZDsKfQpmdW5jdGlvbiBjcmVhdGVGdWxmaWxsbWVudHMoCiAgYWN0aW9uLAogIGFjdGlvbklkLAogIHNlc3Npb25EYXRhLAogIGRlZmF1bHRGdWxmaWxsbWVudHMKKSB7CiAgaWYgKGRlZmF1bHRGdWxmaWxsbWVudHMubGVuZ3RoIDwgMSkgewogICAgdGhyb3cgbmV3IEVycm9yKCJFbXB0eSBmdWxmaWxsbWVudHMgZm91bmQiKTsKICB9CiAgaWYgKGFjdGlvbiA9PT0gIm9uX3N0YXR1cyIpIHsKICAgIGxldCBmdWxmaWxsbWVudHMgPSBzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHM7CiAgICBjb25zdCB0YWdzID0gewogICAgICB0YWdzOiBbCiAgICAgICAgewogICAgICAgICAgY29kZTogInJvdXRpbmciLAogICAgICAgICAgbGlzdDogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29kZTogInR5cGUiLAogICAgICAgICAgICAgIHZhbHVlOiAiUDJIMlAiLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGNvZGU6ICJ0cmFja2luZyIsCiAgICAgICAgICBsaXN0OiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb2RlOiAiZ3BzX2VuYWJsZWQiLAogICAgICAgICAgICAgIHZhbHVlOiAibm8iLAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29kZTogInVybF9lbmFibGVkIiwKICAgICAgICAgICAgICB2YWx1ZTogInllcyIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb2RlOiAidXJsIiwKICAgICAgICAgICAgICB2YWx1ZTogImh0dHBzOi8vc2VsbGVyTlAuY29tL29uZGMvdHJhY2tpbmdfdXJsIiwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgfSwKICAgICAgXSwKICAgIH07CiAgICBsZXQgZmluYWxGdWxmaWxsbWVudHMgPSBzZXNzaW9uRGF0YS5vbl9zdGF0dXNfZnVsZmlsbG1lbnRzOwogICAgaWYgKCFzZXNzaW9uRGF0YS5vbl9zdGF0dXNfZnVsZmlsbG1lbnRzKSB7CiAgICAgIGNvbnN0IHRpbWUgPSBuZXcgRGF0ZShuZXcgRGF0ZSgpLmdldFRpbWUoKSArIDEwICogMTAwMCAqIDYwKTsKICAgICAgY29uc3Qgc3RhcnRfZW5kID0gbmV3IERhdGUodGltZS5nZXRUaW1lKCkgKyAxMCAqIDEwMDAgKiA2MCkudG9JU09TdHJpbmcoKTsKICAgICAgZmluYWxGdWxmaWxsbWVudHMgPSBmdWxmaWxsbWVudHMKICAgICAgICAvLyAuZmlsdGVyKChmKSA9PiBmLnR5cGUgPT0gIkRlbGl2ZXJ5IikKICAgICAgICAubWFwKChmKSA9PiB7CiAgICAgICAgICBpZiAoZi50eXBlID09ICJEZWxpdmVyeSIpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAuLi5mLAogICAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgICAuLi5mLnN0YXJ0LAogICAgICAgICAgICAgICAgdGltZTogewogICAgICAgICAgICAgICAgICByYW5nZTogewogICAgICAgICAgICAgICAgICAgIHN0YXJ0OiB0aW1lLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgICAgZW5kOiBzdGFydF9lbmQsCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgICAuLi5mLmVuZCwKICAgICAgICAgICAgICAgIHRpbWU6IHsKICAgICAgICAgICAgICAgICAgcmFuZ2U6IHsKICAgICAgICAgICAgICAgICAgICBzdGFydDogc3RhcnRfZW5kLAogICAgICAgICAgICAgICAgICAgIGVuZDogbmV3IERhdGUoCiAgICAgICAgICAgICAgICAgICAgICB0aW1lLmdldFRpbWUoKSArCiAgICAgICAgICAgICAgICAgICAgICAxMDAwICogaXNvRHVyVG9TZWMoZlsiQG9uZGMvb3JnL1RBVCJdIHx8ICJQVDBIIikKICAgICAgICAgICAgICAgICAgICApLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgdGFnczogdGFncy50YWdzLAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGY7CiAgICAgICAgfSk7CiAgICAgIC8vIGZ1bGZpbGxtZW50cyA9IGZ1bGZpbGxtZW50cy5maWx0ZXIoKGYpID0+IGYudHlwZSAhPSAiRGVsaXZlcnkiKTsKICAgICAgLy8gZmluYWxGdWxmaWxsbWVudHMgPSB7IC4uLmZpbmFsRnVsZmlsbG1lbnRzLCAuLi5mdWxmaWxsbWVudHMgfTsKICAgIH0KICAgIGxldCBzdGF0ZSA9ICJQZW5kaW5nIjsKICAgIHN3aXRjaCAoYWN0aW9uSWQpIHsKICAgICAgY2FzZSAib25fc3RhdHVzX3BhY2tlZCI6CiAgICAgICAgc3RhdGUgPSAiUGFja2VkIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAib25fc3RhdHVzX2FjY2VwdGVkIjoKICAgICAgICBzdGF0ZSA9ICJQZW5kaW5nIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAib25fc3RhdHVzX2FnZW50X2Fzc2lnbmVkIjoKICAgICAgICBzdGF0ZSA9ICJBZ2VudC1hc3NpZ25lZCI7CgogICAgICAgIGZpbmFsRnVsZmlsbG1lbnRzID0gZmluYWxGdWxmaWxsbWVudHMubWFwKChmKSA9PiB7CiAgICAgICAgICBpZiAoZi50eXBlID09PSAiRGVsaXZlcnkiKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgLi4uZiwKICAgICAgICAgICAgICBhZ2VudDogewogICAgICAgICAgICAgICAgbmFtZTogIm1vY2stYWdlbnQiLAogICAgICAgICAgICAgICAgcGhvbmU6ICI5ODg2MDk4ODYwIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGY7IC8vIGxlYXZlIG90aGVyIHR5cGVzIHVuY2hhbmdlZAogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJvbl9zdGF0dXNfcGlja2VkIjoKICAgICAgICBzdGF0ZSA9ICJPcmRlci1waWNrZWQtdXAiOwogICAgICAgIGZpbmFsRnVsZmlsbG1lbnRzID0gZmluYWxGdWxmaWxsbWVudHMubWFwKChmKSA9PiB7CiAgICAgICAgICBpZiAoZi50eXBlID09PSAiRGVsaXZlcnkiKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgLi4uZiwKICAgICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgICAgLi4uZi5zdGFydCwKICAgICAgICAgICAgICAgIHRpbWU6IHsKICAgICAgICAgICAgICAgICAgLi4uZi5zdGFydD8udGltZSwKICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZjsgLy8gbGVhdmUgb3RoZXIgdHlwZXMgdW5jaGFuZ2VkCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIm9uX3N0YXR1c19vdXRfZm9yX2RlbGl2ZXJ5IjoKICAgICAgICBzdGF0ZSA9ICJPdXQtZm9yLWRlbGl2ZXJ5IjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAib25fc3RhdHVzX29yZGVyX2RlbGl2ZXJlZCI6CiAgICAgICAgc3RhdGUgPSAiT3JkZXItZGVsaXZlcmVkIjsKICAgICAgICBmaW5hbEZ1bGZpbGxtZW50cyA9IGZpbmFsRnVsZmlsbG1lbnRzLm1hcCgoZikgPT4gewogICAgICAgICAgaWYgKGYudHlwZSA9PT0gIkRlbGl2ZXJ5IikgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIC4uLmYsCiAgICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgICAuLi5mLmVuZCwKICAgICAgICAgICAgICAgIHRpbWU6IHsKICAgICAgICAgICAgICAgICAgLi4uZi5lbmQ/LnRpbWUsCiAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGY7IC8vIGxlYXZlIG90aGVyIHR5cGVzIHVuY2hhbmdlZAogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJvbl9zdGF0dXNfcnRvX2RlbGl2ZXJlZCI6CiAgICAgICAgc3RhdGUgPSAiQ2FuY2VsbGVkIjsKICAgICAgICBmaW5hbEZ1bGZpbGxtZW50cyA9IGZpbmFsRnVsZmlsbG1lbnRzLm1hcCgoZikgPT4gewogICAgICAgICAgaWYgKGYudHlwZSA9PT0gIlJUTyIpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAuLi5mLAogICAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgICAgLi4uZi5lbmQsCiAgICAgICAgICAgICAgICB0aW1lOiB7CiAgICAgICAgICAgICAgICAgIC4uLmYuZW5kPy50aW1lLAogICAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzdGF0ZTogewogICAgICAgICAgICAgICAgZGVzY3JpcHRvcjogewogICAgICAgICAgICAgICAgICBjb2RlOiAiUlRPLURlbGl2ZXJlZCIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZi50eXBlID09PSAiRGVsaXZlcnkiKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgLi4uZiwKICAgICAgICAgICAgICBzdGF0ZTogewogICAgICAgICAgICAgICAgZGVzY3JpcHRvcjogewogICAgICAgICAgICAgICAgICBjb2RlOiAiQ2FuY2VsbGVkIiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmOyAvLyBsZWF2ZSBvdGhlciB0eXBlcyB1bmNoYW5nZWQKICAgICAgICB9KTsKCiAgICAgIGNhc2UgIm9uX3N0YXR1c19yZWFkeV90b19zaGlwIjoKICAgICAgICBzdGF0ZSA9ICJQYWNrZWQiOwogICAgICAgIGZpbmFsRnVsZmlsbG1lbnRzID0gZmluYWxGdWxmaWxsbWVudHMubWFwKChmKSA9PiB7CiAgICAgICAgICBpZiAoZi50eXBlID09PSAiQnV5ZXItRGVsaXZlcnkiKSB7CiAgICAgICAgICAgIGNvbnN0IHRhZ3MgPSBmLnRhZ3MgfHwgW107CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgLi4uZiwKICAgICAgICAgICAgICB0YWdzOiBbCiAgICAgICAgICAgICAgICAuLi50YWdzLAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBjb2RlOiAic3RhdGUiLAogICAgICAgICAgICAgICAgICBsaXN0OiBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgY29kZTogInJlYWR5X3RvX3NoaXAiLAogICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICJ5ZXMiLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBjb2RlOiAicm91dGluZyIsCiAgICAgICAgICAgICAgICAgIGxpc3Q6IFsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICBjb2RlOiAidHlwZSIsCiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogIlAyUCIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmOyAKICAgICAgICB9KTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBmaW5hbEZ1bGZpbGxtZW50cyA9IGZpbmFsRnVsZmlsbG1lbnRzLm1hcCgoZikgPT4gewogICAgICBpZiAoZi50eXBlID09PSAiRGVsaXZlcnkiKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIC4uLmYsCiAgICAgICAgICBzdGF0ZTogewogICAgICAgICAgICBkZXNjcmlwdG9yOiB7CiAgICAgICAgICAgICAgY29kZTogc3RhdGUsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgIH07CiAgICAgIH0KICAgICAgcmV0dXJuIGY7CiAgICB9KTsKICAgIHJldHVybiBmaW5hbEZ1bGZpbGxtZW50czsKICB9CiAgcmV0dXJuIGRlZmF1bHRGdWxmaWxsbWVudHM7Cn0KCmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlKAoJZGVmYXVsdFBheWxvYWQsCglzZXNzaW9uRGF0YQopIHsKCWNvbnN0IGdlbmVyYWxQYXlsb2FkID0gY3JlYXRlR2VuZXJpY09uU3RhdHVzKGRlZmF1bHRQYXlsb2FkLCBzZXNzaW9uRGF0YSk7CglnZW5lcmFsUGF5bG9hZC5tZXNzYWdlLm9yZGVyLmZ1bGZpbGxtZW50cyA9IGNyZWF0ZUZ1bGZpbGxtZW50cygKCQkib25fc3RhdHVzIiwKCQkib25fc3RhdHVzX3BpY2tlZCIsCgkJc2Vzc2lvbkRhdGEsCgkJZ2VuZXJhbFBheWxvYWQubWVzc2FnZS5vcmRlci5mdWxmaWxsbWVudHMKCSk7CglyZXR1cm4gZ2VuZXJhbFBheWxvYWQ7Cn0KCg==
      validate: LyoqCiAqIFZhbGlkYXRlcyB0aGUgaW5jb21pbmcgcmVxdWVzdCBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXRQYXlsb2FkIC0gVGhlIGluY29taW5nIHJlcXVlc3QgcGF5bG9hZCB0byB2YWxpZGF0ZS4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiB2YWxpZGF0ZSh0YXJnZXRQYXlsb2FkLCBzZXNzaW9uRGF0YSkgewogIHJldHVybiB7IHZhbGlkOiB0cnVlLCBjb2RlOiAyMDAsIGRlc2NyaXB0aW9uOiAiVmFsaWQgcmVxdWVzdCIgfTsKfQ==
      requirements: LyoqCiAqIENoZWNrcyBpZiB0aGUgcmVxdWlyZW1lbnRzIGZvciBwcm9jZWVkaW5nIHdpdGggdGhlIEFQSSBjYWxsIGFyZSBtZXQuCiAqIAogKiBAcGFyYW0ge09iamVjdH0gc2Vzc2lvbkRhdGEgLSBEYXRhIGNvbGxlY3RlZCBmcm9tIHByZXZpb3VzIHRyYW5zYWN0aW9uIHN0ZXBzLgogKiAKICogQHJldHVybnMge09iamVjdH0geyB2YWxpZDogYm9vbGVhbiwgY29kZTogbnVtYmVyLCBkZXNjcmlwdGlvbjogc3RyaW5nIH0KICovCmZ1bmN0aW9uIG1lZXRSZXF1aXJlbWVudHMoc2Vzc2lvbkRhdGEpIHsKICAvLyBDaGVjayBmb3Igc2VsZWN0ZWRfaXRlbXMKICBpZiAoIXNlc3Npb25EYXRhLnNlbGVjdGVkX2l0ZW1zIHx8IHNlc3Npb25EYXRhLnNlbGVjdGVkX2l0ZW1zLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHNlbGVjdGVkX2l0ZW1zIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19TRUxFQ1RFRF9JVEVNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHBheWxvYWRfY2l0eQogIGlmICghc2Vzc2lvbkRhdGEucGF5bG9hZF9jaXR5KSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gcGF5bG9hZF9jaXR5IGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19QQVlMT0FEX0NJVFkiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBzZWxlY3RlZF9mdWxmaWxsbWVudHMKICBpZiAoCiAgICAhc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfZnVsZmlsbG1lbnRzIHx8CiAgICBzZXNzaW9uRGF0YS5zZWxlY3RlZF9mdWxmaWxsbWVudHMubGVuZ3RoID09PSAwCiAgKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gc2VsZWN0ZWRfZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19TRUxFQ1RFRF9GVUxGSUxMTUVOVFMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBwcm92aWRlcgogIGlmICghc2Vzc2lvbkRhdGEucHJvdmlkZXIpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBwcm92aWRlciBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUFJPVklERVIiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBxdW90ZQogIGlmICghc2Vzc2lvbkRhdGEucXVvdGUgfHwgdHlwZW9mIHNlc3Npb25EYXRhLnF1b3RlICE9PSAib2JqZWN0IikgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHF1b3RlIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19RVU9URSIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9uX3NlbGVjdF9mdWxmaWxsbWVudHMKICBpZiAoCiAgICAhc2Vzc2lvbkRhdGEub25fc2VsZWN0X2Z1bGZpbGxtZW50cyB8fAogICAgc2Vzc2lvbkRhdGEub25fc2VsZWN0X2Z1bGZpbGxtZW50cy5sZW5ndGggPT09IDAKICApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBvbl9zZWxlY3RfZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19PTl9TRUxFQ1RfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3Igb25fc2VsZWN0X2l0ZW1zCiAgaWYgKAogICAgIXNlc3Npb25EYXRhLm9uX3NlbGVjdF9pdGVtcyB8fAogICAgc2Vzc2lvbkRhdGEub25fc2VsZWN0X2l0ZW1zLmxlbmd0aCA9PT0gMAogICkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIG9uX3NlbGVjdF9pdGVtcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfT05fU0VMRUNUX0lURU1TIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgdGF0CiAgaWYgKCFzZXNzaW9uRGF0YS50YXQpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyB0YXQgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1RBVCIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIGl0ZW1zCiAgaWYgKCFzZXNzaW9uRGF0YS5pdGVtcyB8fCBzZXNzaW9uRGF0YS5pdGVtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBpdGVtcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfSVRFTVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBiaWxsaW5nCiAgaWYgKCFzZXNzaW9uRGF0YS5iaWxsaW5nIHx8IHR5cGVvZiBzZXNzaW9uRGF0YS5iaWxsaW5nICE9PSAib2JqZWN0IikgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIGJpbGxpbmcgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0JJTExJTkciLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBmdWxmaWxsbWVudHMKICBpZiAoIXNlc3Npb25EYXRhLmZ1bGZpbGxtZW50cyB8fCBzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19GVUxGSUxMTUVOVFMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBzZWxlY3RlZF9ucF9mZWVzCiAgaWYgKCFzZXNzaW9uRGF0YS5zZWxlY3RlZF9ucF9mZWVzKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gc2VsZWN0ZWRfbnBfZmVlcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU0VMRUNURURfTlBfRkVFUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIGJwcF90ZXJtcwogIGlmICghc2Vzc2lvbkRhdGEuYnBwX3Rlcm1zIHx8IHNlc3Npb25EYXRhLmJwcF90ZXJtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBicHBfdGVybXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0JQUF9URVJNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9yZGVyX2lkCiAgaWYgKCFzZXNzaW9uRGF0YS5vcmRlcl9pZCkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIG9yZGVyX2lkIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19PUkRFUl9JRCIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIGJhcF90ZXJtcwogIGlmICghc2Vzc2lvbkRhdGEuYmFwX3Rlcm1zIHx8IHNlc3Npb25EYXRhLmJhcF90ZXJtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBiYXBfdGVybXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0JBUF9URVJNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHN0YXRlCiAgaWYgKCFzZXNzaW9uRGF0YS5zdGF0ZSkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHN0YXRlIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19TVEFURSIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHBheW1lbnQKICBpZiAoIXNlc3Npb25EYXRhLnBheW1lbnQgfHwgdHlwZW9mIHNlc3Npb25EYXRhLnBheW1lbnQgIT09ICJvYmplY3QiKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gcGF5bWVudCBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUEFZTUVOVCIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9uX3N0YXR1c19mdWxmaWxsbWVudHMgKE5FVykKICBpZiAoCiAgICAhc2Vzc2lvbkRhdGEub25fc3RhdHVzX2Z1bGZpbGxtZW50cyB8fAogICAgc2Vzc2lvbkRhdGEub25fc3RhdHVzX2Z1bGZpbGxtZW50cy5sZW5ndGggPT09IDAKICApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBvbl9zdGF0dXNfZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19PTl9TVEFUVVNfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBBbGwgcmVxdWlyZW1lbnRzIHNhdGlzZmllZAogIHJldHVybiB7CiAgICB2YWxpZDogdHJ1ZSwKICAgIGRlc2NyaXB0aW9uOiAiQWxsIENoZWNrcyBwYXNzZWQgc3VjY2Vzc2Z1bGx5IiwKICAgIGNvZGU6ICIyMDAiLAogIH07Cn0K
      defaultPayload:
        context:
          domain: eB2B
          action: on_status
          timestamp: 2025-12-29T11:01:59.338Z
          transaction_id: 3cd7243a-eef8-42e1-8d12-9c76eab6fcea
          message_id: 4435a799-145f-4b9e-888c-0d4743f308cf
          bap_id: sample-bap-id
          bap_uri: https://bap.example.com
          ttl: PT30S
          bpp_id: sample-bpp-id
          bpp_uri: https://bpp.example.com
          country: IND
          city: "*"
          core_version: 1.2.0
        message:
          order:
            id: O1
            state: In-progress
            provider:
              id: P1
              locations:
                - id: L1
            items:
              - id: I1
                quantity:
                  count: 1
                fulfillment_id: F1
            billing:
              address:
                building: my building name or house
                city: Mumbai
                state: Maharashtra
                country: IND
                area_code: "400053"
                locality: my street name
                name: my house or door or floor
              phone: "9898989898"
              name: ONDC buyer
              email: nobody@nomail.com
              created_at: 2024-12-23T07:01:43.145Z
              updated_at: 2024-12-23T07:01:43.145Z
            fulfillments:
              - id: F1
                "@ondc/org/provider_name": 24x7 Wellness Forever - ANDHERI FOUR BUNGLOW
                state:
                  descriptor:
                    code: Order-picked-up
                type: Delivery
                tracking: true
                "@ondc/org/TAT": PT60M
                start:
                  location:
                    id: L1
                    descriptor:
                      name: ABC Store
                    gps: 19.129076,72.825803
                    address:
                      building: my building name or house
                      city: Mumbai
                      state: Maharashtra
                      country: IND
                      area_code: "400053"
                      locality: my street name
                      name: my house or door or floor
                  time:
                    range:
                      start: 2024-12-23T07:03:32.230Z
                      end: 2024-12-23T07:08:32.230Z
                    timestamp: 2024-12-23T07:25:32.230Z
                  contact:
                    phone: "9594663710"
                    email: nobody@nomail.com
                end:
                  person:
                    name: John Doe
                  contact:
                    email: nobody@nomail.com
                    phone: "9898989898"
                  location:
                    gps: 19.131140,72.834091
                    address:
                      building: my building name or house
                      city: Mumbai
                      state: Maharashtra
                      country: IND
                      area_code: "400053"
                      locality: my street name
                      name: my house or door or floor
                  time:
                    range:
                      start: 2024-12-23T07:33:32.230Z
                      end: 2024-12-23T07:04:32.230Z
                tags:
                  - code: routing
                    list:
                      - code: type
                        value: P2P
                  - code: tracking
                    list:
                      - code: gps_enabled
                        value: no
                      - code: url_enabled
                        value: yes
                      - code: url
                        value: https://MockNP.com/ondc/tracking_url
            quote:
              price:
                currency: INR
                value: "100.00"
              breakup:
                - "@ondc/org/item_id": I1
                  "@ondc/org/item_quantity":
                    count: 1
                  title: Plain Atta
                  "@ondc/org/title_type": item
                  price:
                    currency: INR
                    value: "100"
                  item:
                    price:
                      currency: INR
                      value: "100.00"
                - "@ondc/org/item_id": I1
                  title: Delivery charges
                  "@ondc/org/title_type": delivery
                  price:
                    currency: INR
                    value: "00.00"
                - "@ondc/org/item_id": I1
                  title: Convenience Fee
                  "@ondc/org/title_type": misc
                  price:
                    currency: INR
                    value: "00.00"
              ttl: P1D
            payment:
              params:
                amount: "100.00"
                currency: INR
                transaction_id: order_PjggJp7MccQmAa
              status: PAID
              type: ON-ORDER
              collected_by: BAP
              "@ondc/org/buyer_app_finder_fee_type": percent
              "@ondc/org/buyer_app_finder_fee_amount": "3.0"
              "@ondc/org/settlement_details":
                - settlement_counterparty: seller-app
                  settlement_phase: sale-amount
                  settlement_type: neft
                  beneficiary_name: xxxx
                  settlement_bank_account_no: xxxx
                  settlement_ifsc_code: xxxx
                  bank_name: xxxx
                  branch_name: xxxx
            documents:
              - url: https://invoice_url
                label: Invoice
            created_at: 2024-12-23T07:03:30.516Z
            updated_at: 2024-12-23T07:25:32.230Z
      saveData:
        transactionId: $.context.transaction_id
        latestTimestamp: $.context.timestamp
        bapId: $.context.bap_id
        bapUri: $.context.bap_uri
        bppId: $.context.bpp_id
        bppUri: $.context.bpp_uri
        message_id: $.context.message_id
      inputs: {}
  - api: on_status
    action_id: on_status_out_for_delivery
    owner: BPP
    responseFor: null
    unsolicited: true
    description: On-status which marks that the order is out for delivery
    mock:
      generate: LyoqCiAqIEdlbmVyYXRlcyB0aGUgbW9jayBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgY3VzdG9taXphdGlvbiBvZiB0aGUgZGVmYXVsdCBwYXlsb2FkIHVzaW5nIHNlc3Npb24gZGF0YQogKiBmcm9tIHByZXZpb3VzIHN0ZXBzIGFuZCB1c2VyIGlucHV0cy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSBkZWZhdWx0UGF5bG9hZCAtIFRoZSBiYXNlIHBheWxvYWQgb2JqZWN0IHdpdGggY29udGV4dCBhbHJlYWR5IHBvcHVsYXRlZC4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhLnVzZXJfaW5wdXRzIC0gVXNlci1wcm92aWRlZCBpbnB1dCB2YWx1ZXMgZm9yIHRoaXMgc3RlcC4KICogQHBhcmFtIHsqfSBzZXNzaW9uRGF0YS5ba2V5XSAtIEFueSBzYXZlZCBkYXRhIGZyb20gcHJldmlvdXMgc3RlcHMgKGRlZmluZWQgaW4gc2F2ZURhdGEgY29uZmlnKS4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBnZW5lcmF0ZWQgcGF5bG9hZCBvYmplY3QgdG8gYmUgc2VudCBpbiB0aGUgQVBJIHJlcXVlc3QuCiAqLwpjb25zdCBpc29EdXJUb1NlYyA9IChkdXJhdGlvbikgPT4gewogIGNvbnN0IGR1clJFID0KICAgIC9QKChcZCspWSk/KChcZCspTSk/KChcZCspVyk/KChcZCspRCk/VD8oKFxkKylIKT8oKFxkKylNKT8oKFxkKylTKT8vOwoKICBjb25zdCBzcGxpdFRpbWUgPSBkdXJSRS5leGVjKGR1cmF0aW9uKTsKICBpZiAoIXNwbGl0VGltZSkgewogICAgcmV0dXJuIDA7CiAgfQoKICBjb25zdCB5ZWFycyA9IE51bWJlcihzcGxpdFRpbWU/LlsyXSkgfHwgMDsKICBjb25zdCBtb250aHMgPSBOdW1iZXIoc3BsaXRUaW1lPy5bNF0pIHx8IDA7CiAgY29uc3Qgd2Vla3MgPSBOdW1iZXIoc3BsaXRUaW1lPy5bNl0pIHx8IDA7CiAgY29uc3QgZGF5cyA9IE51bWJlcihzcGxpdFRpbWU/Lls4XSkgfHwgMDsKICBjb25zdCBob3VycyA9IE51bWJlcihzcGxpdFRpbWU/LlsxMF0pIHx8IDA7CiAgY29uc3QgbWludXRlcyA9IE51bWJlcihzcGxpdFRpbWU/LlsxMl0pIHx8IDA7CiAgY29uc3Qgc2Vjb25kcyA9IE51bWJlcihzcGxpdFRpbWU/LlsxNF0pIHx8IDA7CgogIGNvbnN0IHJlc3VsdCA9CiAgICB5ZWFycyAqIDMxNTM2MDAwICsKICAgIG1vbnRocyAqIDI2MjgyODggKwogICAgd2Vla3MgKiA2MDQ4MDAgKwogICAgZGF5cyAqIDg2NDAwICsKICAgIGhvdXJzICogMzYwMCArCiAgICBtaW51dGVzICogNjAgKwogICAgc2Vjb25kczsKCiAgcmV0dXJuIHJlc3VsdDsKfTsKZnVuY3Rpb24gZ2V0VXBkYXRlZEJpbGxpbmcoc2F2ZWRCaWxsaW5nLCBpbml0aWFsaXplID0gZmFsc2UpIHsKICBpZiAoaW5pdGlhbGl6ZSkgewogICAgY29uc3QgbmV3SXNvID0gbmV3IERhdGUobmV3IERhdGUoKS5nZXRUaW1lKCkgLSA1ICogMTAwMCkudG9JU09TdHJpbmcoKTsKICAgIHNhdmVkQmlsbGluZy5jcmVhdGVkX2F0ID0gbmV3SXNvOwogICAgc2F2ZWRCaWxsaW5nLnVwZGF0ZWRfYXQgPSBuZXdJc287CiAgfQogIHJldHVybiBzYXZlZEJpbGxpbmc7Cn0KZnVuY3Rpb24gY3JlYXRlR2VuZXJpY09uU3RhdHVzKAoJZXhpc3RpbmdQYXlsb2FkLAoJc2Vzc2lvbkRhdGEKKSB7CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5pZCA9IHNlc3Npb25EYXRhLm9yZGVyX2lkWzBdOwoJZXhpc3RpbmdQYXlsb2FkLm1lc3NhZ2Uub3JkZXIucHJvdmlkZXIgPSBzZXNzaW9uRGF0YS5wcm92aWRlclswXTsKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLml0ZW1zID0gc2Vzc2lvbkRhdGEuaXRlbXM7CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5iaWxsaW5nID0gZ2V0VXBkYXRlZEJpbGxpbmcoCgkJc2Vzc2lvbkRhdGEuYmlsbGluZ1swXQoJKTsKCS8vIGV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLmZ1bGZpbGxtZW50cyA9IHNlc3Npb25EYXRhLmZ1bGZpbGxtZW50czsKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLnF1b3RlID0gc2Vzc2lvbkRhdGEucXVvdGVbMF07Cgljb25zdCB0aW1lSVNPID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpOwoJZXhpc3RpbmdQYXlsb2FkLm1lc3NhZ2Uub3JkZXIudXBkYXRlZF9hdCA9IHRpbWVJU087CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5jcmVhdGVkX2F0ID0gc2Vzc2lvbkRhdGEub3JkZXJfY3JlYXRlZF9hdFswXTsKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLnBheW1lbnQgPSBzZXNzaW9uRGF0YS5wYXltZW50WzBdOwoJcmV0dXJuIGV4aXN0aW5nUGF5bG9hZDsKfQpmdW5jdGlvbiBjcmVhdGVGdWxmaWxsbWVudHMoCiAgYWN0aW9uLAogIGFjdGlvbklkLAogIHNlc3Npb25EYXRhLAogIGRlZmF1bHRGdWxmaWxsbWVudHMKKSB7CiAgaWYgKGRlZmF1bHRGdWxmaWxsbWVudHMubGVuZ3RoIDwgMSkgewogICAgdGhyb3cgbmV3IEVycm9yKCJFbXB0eSBmdWxmaWxsbWVudHMgZm91bmQiKTsKICB9CiAgaWYgKGFjdGlvbiA9PT0gIm9uX3N0YXR1cyIpIHsKICAgIGxldCBmdWxmaWxsbWVudHMgPSBzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHM7CiAgICBjb25zdCB0YWdzID0gewogICAgICB0YWdzOiBbCiAgICAgICAgewogICAgICAgICAgY29kZTogInJvdXRpbmciLAogICAgICAgICAgbGlzdDogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29kZTogInR5cGUiLAogICAgICAgICAgICAgIHZhbHVlOiAiUDJIMlAiLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGNvZGU6ICJ0cmFja2luZyIsCiAgICAgICAgICBsaXN0OiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb2RlOiAiZ3BzX2VuYWJsZWQiLAogICAgICAgICAgICAgIHZhbHVlOiAibm8iLAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29kZTogInVybF9lbmFibGVkIiwKICAgICAgICAgICAgICB2YWx1ZTogInllcyIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb2RlOiAidXJsIiwKICAgICAgICAgICAgICB2YWx1ZTogImh0dHBzOi8vc2VsbGVyTlAuY29tL29uZGMvdHJhY2tpbmdfdXJsIiwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgfSwKICAgICAgXSwKICAgIH07CiAgICBsZXQgZmluYWxGdWxmaWxsbWVudHMgPSBzZXNzaW9uRGF0YS5vbl9zdGF0dXNfZnVsZmlsbG1lbnRzOwogICAgaWYgKCFzZXNzaW9uRGF0YS5vbl9zdGF0dXNfZnVsZmlsbG1lbnRzKSB7CiAgICAgIGNvbnN0IHRpbWUgPSBuZXcgRGF0ZShuZXcgRGF0ZSgpLmdldFRpbWUoKSArIDEwICogMTAwMCAqIDYwKTsKICAgICAgY29uc3Qgc3RhcnRfZW5kID0gbmV3IERhdGUodGltZS5nZXRUaW1lKCkgKyAxMCAqIDEwMDAgKiA2MCkudG9JU09TdHJpbmcoKTsKICAgICAgZmluYWxGdWxmaWxsbWVudHMgPSBmdWxmaWxsbWVudHMKICAgICAgICAvLyAuZmlsdGVyKChmKSA9PiBmLnR5cGUgPT0gIkRlbGl2ZXJ5IikKICAgICAgICAubWFwKChmKSA9PiB7CiAgICAgICAgICBpZiAoZi50eXBlID09ICJEZWxpdmVyeSIpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAuLi5mLAogICAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgICAuLi5mLnN0YXJ0LAogICAgICAgICAgICAgICAgdGltZTogewogICAgICAgICAgICAgICAgICByYW5nZTogewogICAgICAgICAgICAgICAgICAgIHN0YXJ0OiB0aW1lLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgICAgZW5kOiBzdGFydF9lbmQsCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgICAuLi5mLmVuZCwKICAgICAgICAgICAgICAgIHRpbWU6IHsKICAgICAgICAgICAgICAgICAgcmFuZ2U6IHsKICAgICAgICAgICAgICAgICAgICBzdGFydDogc3RhcnRfZW5kLAogICAgICAgICAgICAgICAgICAgIGVuZDogbmV3IERhdGUoCiAgICAgICAgICAgICAgICAgICAgICB0aW1lLmdldFRpbWUoKSArCiAgICAgICAgICAgICAgICAgICAgICAxMDAwICogaXNvRHVyVG9TZWMoZlsiQG9uZGMvb3JnL1RBVCJdIHx8ICJQVDBIIikKICAgICAgICAgICAgICAgICAgICApLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgdGFnczogdGFncy50YWdzLAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGY7CiAgICAgICAgfSk7CiAgICAgIC8vIGZ1bGZpbGxtZW50cyA9IGZ1bGZpbGxtZW50cy5maWx0ZXIoKGYpID0+IGYudHlwZSAhPSAiRGVsaXZlcnkiKTsKICAgICAgLy8gZmluYWxGdWxmaWxsbWVudHMgPSB7IC4uLmZpbmFsRnVsZmlsbG1lbnRzLCAuLi5mdWxmaWxsbWVudHMgfTsKICAgIH0KICAgIGxldCBzdGF0ZSA9ICJQZW5kaW5nIjsKICAgIHN3aXRjaCAoYWN0aW9uSWQpIHsKICAgICAgY2FzZSAib25fc3RhdHVzX3BhY2tlZCI6CiAgICAgICAgc3RhdGUgPSAiUGFja2VkIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAib25fc3RhdHVzX2FjY2VwdGVkIjoKICAgICAgICBzdGF0ZSA9ICJQZW5kaW5nIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAib25fc3RhdHVzX2FnZW50X2Fzc2lnbmVkIjoKICAgICAgICBzdGF0ZSA9ICJBZ2VudC1hc3NpZ25lZCI7CgogICAgICAgIGZpbmFsRnVsZmlsbG1lbnRzID0gZmluYWxGdWxmaWxsbWVudHMubWFwKChmKSA9PiB7CiAgICAgICAgICBpZiAoZi50eXBlID09PSAiRGVsaXZlcnkiKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgLi4uZiwKICAgICAgICAgICAgICBhZ2VudDogewogICAgICAgICAgICAgICAgbmFtZTogIm1vY2stYWdlbnQiLAogICAgICAgICAgICAgICAgcGhvbmU6ICI5ODg2MDk4ODYwIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGY7IC8vIGxlYXZlIG90aGVyIHR5cGVzIHVuY2hhbmdlZAogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJvbl9zdGF0dXNfcGlja2VkIjoKICAgICAgICBzdGF0ZSA9ICJPcmRlci1waWNrZWQtdXAiOwogICAgICAgIGZpbmFsRnVsZmlsbG1lbnRzID0gZmluYWxGdWxmaWxsbWVudHMubWFwKChmKSA9PiB7CiAgICAgICAgICBpZiAoZi50eXBlID09PSAiRGVsaXZlcnkiKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgLi4uZiwKICAgICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgICAgLi4uZi5zdGFydCwKICAgICAgICAgICAgICAgIHRpbWU6IHsKICAgICAgICAgICAgICAgICAgLi4uZi5zdGFydD8udGltZSwKICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZjsgLy8gbGVhdmUgb3RoZXIgdHlwZXMgdW5jaGFuZ2VkCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIm9uX3N0YXR1c19vdXRfZm9yX2RlbGl2ZXJ5IjoKICAgICAgICBzdGF0ZSA9ICJPdXQtZm9yLWRlbGl2ZXJ5IjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAib25fc3RhdHVzX29yZGVyX2RlbGl2ZXJlZCI6CiAgICAgICAgc3RhdGUgPSAiT3JkZXItZGVsaXZlcmVkIjsKICAgICAgICBmaW5hbEZ1bGZpbGxtZW50cyA9IGZpbmFsRnVsZmlsbG1lbnRzLm1hcCgoZikgPT4gewogICAgICAgICAgaWYgKGYudHlwZSA9PT0gIkRlbGl2ZXJ5IikgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIC4uLmYsCiAgICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgICAuLi5mLmVuZCwKICAgICAgICAgICAgICAgIHRpbWU6IHsKICAgICAgICAgICAgICAgICAgLi4uZi5lbmQ/LnRpbWUsCiAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGY7IC8vIGxlYXZlIG90aGVyIHR5cGVzIHVuY2hhbmdlZAogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJvbl9zdGF0dXNfcnRvX2RlbGl2ZXJlZCI6CiAgICAgICAgc3RhdGUgPSAiQ2FuY2VsbGVkIjsKICAgICAgICBmaW5hbEZ1bGZpbGxtZW50cyA9IGZpbmFsRnVsZmlsbG1lbnRzLm1hcCgoZikgPT4gewogICAgICAgICAgaWYgKGYudHlwZSA9PT0gIlJUTyIpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAuLi5mLAogICAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgICAgLi4uZi5lbmQsCiAgICAgICAgICAgICAgICB0aW1lOiB7CiAgICAgICAgICAgICAgICAgIC4uLmYuZW5kPy50aW1lLAogICAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzdGF0ZTogewogICAgICAgICAgICAgICAgZGVzY3JpcHRvcjogewogICAgICAgICAgICAgICAgICBjb2RlOiAiUlRPLURlbGl2ZXJlZCIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZi50eXBlID09PSAiRGVsaXZlcnkiKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgLi4uZiwKICAgICAgICAgICAgICBzdGF0ZTogewogICAgICAgICAgICAgICAgZGVzY3JpcHRvcjogewogICAgICAgICAgICAgICAgICBjb2RlOiAiQ2FuY2VsbGVkIiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmOyAvLyBsZWF2ZSBvdGhlciB0eXBlcyB1bmNoYW5nZWQKICAgICAgICB9KTsKCiAgICAgIGNhc2UgIm9uX3N0YXR1c19yZWFkeV90b19zaGlwIjoKICAgICAgICBzdGF0ZSA9ICJQYWNrZWQiOwogICAgICAgIGZpbmFsRnVsZmlsbG1lbnRzID0gZmluYWxGdWxmaWxsbWVudHMubWFwKChmKSA9PiB7CiAgICAgICAgICBpZiAoZi50eXBlID09PSAiQnV5ZXItRGVsaXZlcnkiKSB7CiAgICAgICAgICAgIGNvbnN0IHRhZ3MgPSBmLnRhZ3MgfHwgW107CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgLi4uZiwKICAgICAgICAgICAgICB0YWdzOiBbCiAgICAgICAgICAgICAgICAuLi50YWdzLAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBjb2RlOiAic3RhdGUiLAogICAgICAgICAgICAgICAgICBsaXN0OiBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgY29kZTogInJlYWR5X3RvX3NoaXAiLAogICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICJ5ZXMiLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBjb2RlOiAicm91dGluZyIsCiAgICAgICAgICAgICAgICAgIGxpc3Q6IFsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICBjb2RlOiAidHlwZSIsCiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogIlAyUCIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmOyAKICAgICAgICB9KTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBmaW5hbEZ1bGZpbGxtZW50cyA9IGZpbmFsRnVsZmlsbG1lbnRzLm1hcCgoZikgPT4gewogICAgICBpZiAoZi50eXBlID09PSAiRGVsaXZlcnkiKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIC4uLmYsCiAgICAgICAgICBzdGF0ZTogewogICAgICAgICAgICBkZXNjcmlwdG9yOiB7CiAgICAgICAgICAgICAgY29kZTogc3RhdGUsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgIH07CiAgICAgIH0KICAgICAgcmV0dXJuIGY7CiAgICB9KTsKICAgIHJldHVybiBmaW5hbEZ1bGZpbGxtZW50czsKICB9CiAgcmV0dXJuIGRlZmF1bHRGdWxmaWxsbWVudHM7Cn0KCmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlKAoJZGVmYXVsdFBheWxvYWQsCglzZXNzaW9uRGF0YQopIHsKCWNvbnN0IGdlbmVyYWxQYXlsb2FkID0gY3JlYXRlR2VuZXJpY09uU3RhdHVzKGRlZmF1bHRQYXlsb2FkLCBzZXNzaW9uRGF0YSk7CglnZW5lcmFsUGF5bG9hZC5tZXNzYWdlLm9yZGVyLmZ1bGZpbGxtZW50cyA9IGNyZWF0ZUZ1bGZpbGxtZW50cygKCQkib25fc3RhdHVzIiwKCQkib25fc3RhdHVzX291dF9mb3JfZGVsaXZlcnkiLAoJCXNlc3Npb25EYXRhLAoJCWdlbmVyYWxQYXlsb2FkLm1lc3NhZ2Uub3JkZXIuZnVsZmlsbG1lbnRzCgkpOwoJcmV0dXJuIGdlbmVyYWxQYXlsb2FkOwp9Cgo=
      validate: LyoqCiAqIFZhbGlkYXRlcyB0aGUgaW5jb21pbmcgcmVxdWVzdCBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXRQYXlsb2FkIC0gVGhlIGluY29taW5nIHJlcXVlc3QgcGF5bG9hZCB0byB2YWxpZGF0ZS4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiB2YWxpZGF0ZSh0YXJnZXRQYXlsb2FkLCBzZXNzaW9uRGF0YSkgewogIHJldHVybiB7IHZhbGlkOiB0cnVlLCBjb2RlOiAyMDAsIGRlc2NyaXB0aW9uOiAiVmFsaWQgcmVxdWVzdCIgfTsKfQ==
      requirements: LyoqCiAqIENoZWNrcyBpZiB0aGUgcmVxdWlyZW1lbnRzIGZvciBwcm9jZWVkaW5nIHdpdGggdGhlIEFQSSBjYWxsIGFyZSBtZXQuCiAqIAogKiBAcGFyYW0ge09iamVjdH0gc2Vzc2lvbkRhdGEgLSBEYXRhIGNvbGxlY3RlZCBmcm9tIHByZXZpb3VzIHRyYW5zYWN0aW9uIHN0ZXBzLgogKiAKICogQHJldHVybnMge09iamVjdH0geyB2YWxpZDogYm9vbGVhbiwgY29kZTogbnVtYmVyLCBkZXNjcmlwdGlvbjogc3RyaW5nIH0KICovCmZ1bmN0aW9uIG1lZXRSZXF1aXJlbWVudHMoc2Vzc2lvbkRhdGEpIHsKICAvLyBDaGVjayBmb3Igc2VsZWN0ZWRfaXRlbXMKICBpZiAoIXNlc3Npb25EYXRhLnNlbGVjdGVkX2l0ZW1zIHx8IHNlc3Npb25EYXRhLnNlbGVjdGVkX2l0ZW1zLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHNlbGVjdGVkX2l0ZW1zIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19TRUxFQ1RFRF9JVEVNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHBheWxvYWRfY2l0eQogIGlmICghc2Vzc2lvbkRhdGEucGF5bG9hZF9jaXR5KSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gcGF5bG9hZF9jaXR5IGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19QQVlMT0FEX0NJVFkiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBzZWxlY3RlZF9mdWxmaWxsbWVudHMKICBpZiAoCiAgICAhc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfZnVsZmlsbG1lbnRzIHx8CiAgICBzZXNzaW9uRGF0YS5zZWxlY3RlZF9mdWxmaWxsbWVudHMubGVuZ3RoID09PSAwCiAgKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gc2VsZWN0ZWRfZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19TRUxFQ1RFRF9GVUxGSUxMTUVOVFMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBwcm92aWRlcgogIGlmICghc2Vzc2lvbkRhdGEucHJvdmlkZXIpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBwcm92aWRlciBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUFJPVklERVIiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBxdW90ZQogIGlmICghc2Vzc2lvbkRhdGEucXVvdGUgfHwgdHlwZW9mIHNlc3Npb25EYXRhLnF1b3RlICE9PSAib2JqZWN0IikgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHF1b3RlIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19RVU9URSIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9uX3NlbGVjdF9mdWxmaWxsbWVudHMKICBpZiAoCiAgICAhc2Vzc2lvbkRhdGEub25fc2VsZWN0X2Z1bGZpbGxtZW50cyB8fAogICAgc2Vzc2lvbkRhdGEub25fc2VsZWN0X2Z1bGZpbGxtZW50cy5sZW5ndGggPT09IDAKICApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBvbl9zZWxlY3RfZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19PTl9TRUxFQ1RfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3Igb25fc2VsZWN0X2l0ZW1zCiAgaWYgKAogICAgIXNlc3Npb25EYXRhLm9uX3NlbGVjdF9pdGVtcyB8fAogICAgc2Vzc2lvbkRhdGEub25fc2VsZWN0X2l0ZW1zLmxlbmd0aCA9PT0gMAogICkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIG9uX3NlbGVjdF9pdGVtcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfT05fU0VMRUNUX0lURU1TIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgdGF0CiAgaWYgKCFzZXNzaW9uRGF0YS50YXQpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyB0YXQgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1RBVCIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIGl0ZW1zCiAgaWYgKCFzZXNzaW9uRGF0YS5pdGVtcyB8fCBzZXNzaW9uRGF0YS5pdGVtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBpdGVtcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfSVRFTVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBiaWxsaW5nCiAgaWYgKCFzZXNzaW9uRGF0YS5iaWxsaW5nIHx8IHR5cGVvZiBzZXNzaW9uRGF0YS5iaWxsaW5nICE9PSAib2JqZWN0IikgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIGJpbGxpbmcgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0JJTExJTkciLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBmdWxmaWxsbWVudHMKICBpZiAoIXNlc3Npb25EYXRhLmZ1bGZpbGxtZW50cyB8fCBzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19GVUxGSUxMTUVOVFMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBzZWxlY3RlZF9ucF9mZWVzCiAgaWYgKCFzZXNzaW9uRGF0YS5zZWxlY3RlZF9ucF9mZWVzKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gc2VsZWN0ZWRfbnBfZmVlcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU0VMRUNURURfTlBfRkVFUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIGJwcF90ZXJtcwogIGlmICghc2Vzc2lvbkRhdGEuYnBwX3Rlcm1zIHx8IHNlc3Npb25EYXRhLmJwcF90ZXJtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBicHBfdGVybXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0JQUF9URVJNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9yZGVyX2lkCiAgaWYgKCFzZXNzaW9uRGF0YS5vcmRlcl9pZCkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIG9yZGVyX2lkIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19PUkRFUl9JRCIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIGJhcF90ZXJtcwogIGlmICghc2Vzc2lvbkRhdGEuYmFwX3Rlcm1zIHx8IHNlc3Npb25EYXRhLmJhcF90ZXJtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBiYXBfdGVybXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0JBUF9URVJNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHN0YXRlCiAgaWYgKCFzZXNzaW9uRGF0YS5zdGF0ZSkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHN0YXRlIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19TVEFURSIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHBheW1lbnQKICBpZiAoIXNlc3Npb25EYXRhLnBheW1lbnQgfHwgdHlwZW9mIHNlc3Npb25EYXRhLnBheW1lbnQgIT09ICJvYmplY3QiKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gcGF5bWVudCBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUEFZTUVOVCIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9uX3N0YXR1c19mdWxmaWxsbWVudHMgKE5FVykKICBpZiAoCiAgICAhc2Vzc2lvbkRhdGEub25fc3RhdHVzX2Z1bGZpbGxtZW50cyB8fAogICAgc2Vzc2lvbkRhdGEub25fc3RhdHVzX2Z1bGZpbGxtZW50cy5sZW5ndGggPT09IDAKICApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBvbl9zdGF0dXNfZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19PTl9TVEFUVVNfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBBbGwgcmVxdWlyZW1lbnRzIHNhdGlzZmllZAogIHJldHVybiB7CiAgICB2YWxpZDogdHJ1ZSwKICAgIGRlc2NyaXB0aW9uOiAiQWxsIENoZWNrcyBwYXNzZWQgc3VjY2Vzc2Z1bGx5IiwKICAgIGNvZGU6ICIyMDAiLAogIH07Cn0K
      defaultPayload:
        context:
          domain: eB2B
          action: on_status
          timestamp: 2025-12-29T11:08:18.485Z
          transaction_id: 3cd7243a-eef8-42e1-8d12-9c76eab6fcea
          message_id: 7a8023f6-489f-4c4f-8ab9-7b528789446d
          bap_id: sample-bap-id
          bap_uri: https://bap.example.com
          ttl: PT30S
          bpp_id: sample-bpp-id
          bpp_uri: https://bpp.example.com
          country: IND
          city: "*"
          core_version: 1.2.0
        message:
          order:
            id: O1
            state: In-progress
            provider:
              id: P1
              locations:
                - id: L1
            items:
              - id: I1
                quantity:
                  count: 1
                fulfillment_id: F1
            billing:
              address:
                building: my building name or house
                city: Mumbai
                state: Maharashtra
                country: IND
                area_code: "400053"
                locality: my street name
                name: my house or door or floor
              phone: "9898989898"
              name: ONDC buyer
              email: nobody@nomail.com
              created_at: 2024-12-23T07:01:43.145Z
              updated_at: 2024-12-23T07:01:43.145Z
            fulfillments:
              - id: F1
                "@ondc/org/provider_name": 24x7 Wellness Forever - ANDHERI FOUR BUNGLOW
                state:
                  descriptor:
                    code: Out-for-delivery
                type: Delivery
                tracking: true
                "@ondc/org/TAT": PT60M
                start:
                  location:
                    id: L1
                    descriptor:
                      name: ABC Store
                    gps: 19.129076,72.825803
                    address:
                      building: my building name or house
                      city: Mumbai
                      state: Maharashtra
                      country: IND
                      area_code: "400053"
                      locality: my street name
                      name: my house or door or floor
                  time:
                    range:
                      start: 2024-12-23T07:03:32.230Z
                      end: 2024-12-23T07:08:32.230Z
                    timestamp: 2024-12-23T07:25:32.230Z
                  contact:
                    phone: "9594663710"
                    email: nobody@nomail.com
                end:
                  person:
                    name: John Doe
                  contact:
                    email: nobody@nomail.com
                    phone: "9898989898"
                  location:
                    gps: 19.131140,72.834091
                    address:
                      building: my building name or house
                      city: Mumbai
                      state: Maharashtra
                      country: IND
                      area_code: "400053"
                      locality: my street name
                      name: my house or door or floor
                  time:
                    range:
                      start: 2024-12-23T07:33:32.230Z
                      end: 2024-12-23T07:04:32.230Z
                tags:
                  - code: routing
                    list:
                      - code: type
                        value: P2P
                  - code: tracking
                    list:
                      - code: gps_enabled
                        value: yes
                      - code: url_enabled
                        value: no
                      - code: url
                        value: https://sellerNP.com/ondc/tracking_url
            quote:
              price:
                currency: INR
                value: "100.00"
              breakup:
                - "@ondc/org/item_id": I1
                  "@ondc/org/item_quantity":
                    count: 1
                  title: Plain Atta
                  "@ondc/org/title_type": item
                  price:
                    currency: INR
                    value: "100"
                  item:
                    price:
                      currency: INR
                      value: "100.00"
                - "@ondc/org/item_id": I1
                  title: Delivery charges
                  "@ondc/org/title_type": delivery
                  price:
                    currency: INR
                    value: "00.00"
                - "@ondc/org/item_id": I1
                  title: Convenience Fee
                  "@ondc/org/title_type": misc
                  price:
                    currency: INR
                    value: "00.00"
              ttl: P1D
            payment:
              params:
                amount: "100.00"
                currency: INR
                transaction_id: order_PjggJp7MccQmAa
              status: PAID
              type: ON-ORDER
              collected_by: BAP
              "@ondc/org/buyer_app_finder_fee_type": percent
              "@ondc/org/buyer_app_finder_fee_amount": "3.0"
              "@ondc/org/settlement_details":
                - settlement_counterparty: seller-app
                  settlement_phase: sale-amount
                  settlement_type: neft
                  beneficiary_name: xxxx
                  settlement_bank_account_no: xxxx
                  settlement_ifsc_code: xxxx
                  bank_name: xxxx
                  branch_name: xxxx
            documents:
              - url: https://invoice_url
                label: Invoice
            created_at: 2024-12-23T07:03:30.516Z
            updated_at: 2024-12-23T07:35:32.230Z
      saveData:
        transactionId: $.context.transaction_id
        latestMessage_id: $.context.message_id
        latestTimestamp: $.context.timestamp
        bapId: $.context.bap_id
        bapUri: $.context.bap_uri
        bppId: $.context.bpp_id
        bppUri: $.context.bpp_uri
        order_state: $.message.order.state
        on_status_fulfillments: $.message.order.fulfillments[*]
        last_updated_at: $.message.order.updated_at
      inputs: {}
  - api: on_cancel
    action_id: on_cancel_rto
    owner: BPP
    responseFor: null
    unsolicited: false
    description: please add relevant description
    mock:
      generate: Y29uc3QgcnRvRnVsZmlsbG1lbnQgPSB7CglpZDogInJ0b19tb2NrX2lkXzEyMSIsCgl0eXBlOiAiUlRPIiwKCXN0YXRlOiB7CgkJZGVzY3JpcHRvcjogewoJCQljb2RlOiAiUlRPLUluaXRpYXRlZCIsCgkJfSwKCX0sCglzdGFydDogewoJCWNvbnRhY3Q6IHsKCQkJZW1haWw6ICJtaXNocmF0YW5pc2hxNjE5QGdtYWlsLmNvbSIsCgkJCXBob25lOiAiOTM5OTc4ODYxOCIsCgkJfSwKCQlsb2NhdGlvbjogewoJCQlncHM6ICIxMi45NjY1NDUsNzcuNTkyMDc0IiwKCQkJYWRkcmVzczogewoJCQkJbmFtZTogIlRhbmlzaHEgTWlzaHJhIiwKCQkJCWJ1aWxkaW5nOiAiTmV3X0J1aWxkaW5nIiwKCQkJCWxvY2FsaXR5OiAiNnRoIENyb3NzIFJvYWQiLAoJCQkJY2l0eTogIkJlbmdhbHVydSIsCgkJCQlzdGF0ZTogIkthcm5hdGFrYSIsCgkJCQljb3VudHJ5OiAiSU5EIiwKCQkJCWFyZWFfY29kZTogIjU2MDAyNyIsCgkJCX0sCgkJfSwKCQl0aW1lOiB7CgkJCXRpbWVzdGFtcDogIjIwMjQtMDgtMDhUMTA6MTE6MjQuNzQ5WiIsCgkJfSwKCX0sCgllbmQ6IHsKCQlsb2NhdGlvbjogewoJCQlpZDogIjY2OGUyMzhlMWIxMDZkMzEwNDczZGRiMCIsCgkJCWRlc2NyaXB0b3I6IHsKCQkJCW5hbWU6ICJTZWxsZXIgQnVzaW5lc3MiLAoJCQl9LAoJCQlncHM6ICIxMi45MjU4MDk3MDE0NjYzOSw3Ny41ODM2MjQwOTcxMjk0MiIsCgkJCWFkZHJlc3M6IHsKCQkJCWxvY2FsaXR5OiAiSmF5YW5hZ2FyIiwKCQkJCWNpdHk6ICJCZW5nYWx1cnUiLAoJCQkJYXJlYV9jb2RlOiAiNTYwMDExIiwKCQkJCXN0YXRlOiAiS2FybmF0YWthIiwKCQkJfSwKCQl9LAoJCWNvbnRhY3Q6IHsKCQkJZW1haWw6ICJ0ZXN0QGdtYWlsLmNvbSIsCgkJCXBob25lOiAiOTg3NjU0MzIxMCIsCgkJfSwKCX0sCgl0YWdzOiBbCgkJewoJCQljb2RlOiAicXVvdGVfdHJhaWwiLAoJCQlsaXN0OiBbCgkJCQl7CgkJCQkJY29kZTogInR5cGUiLAoJCQkJCXZhbHVlOiAiaXRlbSIsCgkJCQl9LAoJCQkJewoJCQkJCWNvZGU6ICJpZCIsCgkJCQkJdmFsdWU6ICI4MzljYjEyOC0zNGJkLTQ0NGQtOWZmYy0wNTkwM2U2MmIzNWEiLAoJCQkJfSwKCQkJCXsKCQkJCQljb2RlOiAiY3VycmVuY3kiLAoJCQkJCXZhbHVlOiAiSU5SIiwKCQkJCX0sCgkJCQl7CgkJCQkJY29kZTogInZhbHVlIiwKCQkJCQl2YWx1ZTogIi0yMjYwLjAwIiwKCQkJCX0sCgkJCV0sCgkJfSwKCV0sCn07CgpmdW5jdGlvbiBjcmVhdGVSdG9GdWxmaWxsbWVudCgKCWRlbGl2ZXJ5RnVsZmlsbG1lbnQsCglpdGVtcywKCXF1b3RlCikgewoJY29uc3QgcnRvQ2xvbmUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJ0b0Z1bGZpbGxtZW50KSk7Cgljb25zdCBicmVha3VwID0gcXVvdGUuYnJlYWt1cCA/PyBbXTsKCWlmIChxdW90ZS5wcmljZSkgewoJCXF1b3RlLnByaWNlLnZhbHVlID0gIjAuMDAiOwoJfQoJcnRvQ2xvbmUudGFncyA9IGJyZWFrdXAKCQkubWFwKChpdGVtKSA9PiB7CgkJCWNvbnN0IHByaWNlID0gcGFyc2VGbG9hdChpdGVtLnByaWNlPy52YWx1ZSB8fCAiMCIpOwoJCQlpZiAocHJpY2UgPT09IDApIHJldHVybiBudWxsOwoJCQlpZiAoaXRlbS5wcmljZSkgewoJCQkJaXRlbS5wcmljZS52YWx1ZSA9ICIwLjAwIjsKCQkJfQoJCQlpZiAoaXRlbVsiQG9uZGMvb3JnL2l0ZW1fcXVhbnRpdHkiXSkgewoJCQkJaXRlbVsiQG9uZGMvb3JnL2l0ZW1fcXVhbnRpdHkiXS5jb3VudCA9IDA7CgkJCX0KCQkJcmV0dXJuIHsKCQkJCWNvZGU6ICJxdW90ZV90cmFpbCIsCgkJCQlsaXN0OiBbCgkJCQkJeyBjb2RlOiAidHlwZSIsIHZhbHVlOiBpdGVtWyJAb25kYy9vcmcvdGl0bGVfdHlwZSJdIH0sCgkJCQkJeyBjb2RlOiAiaWQiLCB2YWx1ZTogaXRlbVsiQG9uZGMvb3JnL2l0ZW1faWQiXSB9LAoJCQkJCXsgY29kZTogImN1cnJlbmN5IiwgdmFsdWU6ICJJTlIiIH0sCgkJCQkJeyBjb2RlOiAidmFsdWUiLCB2YWx1ZTogYCR7LTEgKiBwcmljZX1gIH0sCgkJCQldLAoJCQl9OwoJCX0pCiAgICAuZmlsdGVyKHggPT4geCAhPT0gbnVsbCkKCWRlbGV0ZSBkZWxpdmVyeUZ1bGZpbGxtZW50LmVuZD8udGltZTsKCWRlbGV0ZSBkZWxpdmVyeUZ1bGZpbGxtZW50LnN0YXJ0Py50aW1lOwoJcnRvQ2xvbmUuc3RhcnQgPSB7CgkJLi4uZGVsaXZlcnlGdWxmaWxsbWVudC5lbmQsCgkJdGltZTogewoJCQl0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKCQl9LAoJfTsKCXJ0b0Nsb25lLmVuZCA9IHsKCQkuLi5kZWxpdmVyeUZ1bGZpbGxtZW50LnN0YXJ0LAoJfTsKCglyZXR1cm4gcnRvQ2xvbmU7Cn0KCmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlKAoJZXhpc3RpbmdQYXlsb2FkLAoJc2Vzc2lvbkRhdGEKKSB7CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5pZCA9IHNlc3Npb25EYXRhLm9yZGVyX2lkWzBdOwoJZXhpc3RpbmdQYXlsb2FkLm1lc3NhZ2Uub3JkZXIuY3JlYXRlZF9hdCA9IHNlc3Npb25EYXRhLm9yZGVyX2NyZWF0ZWRfYXRbMF07CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci51cGRhdGVkX2F0ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpOwoJZXhpc3RpbmdQYXlsb2FkLm1lc3NhZ2Uub3JkZXIucGF5bWVudCA9IHNlc3Npb25EYXRhLnBheW1lbnRbMF07CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5iaWxsaW5nID0gc2Vzc2lvbkRhdGEuYmlsbGluZ1swXTsKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLnByb3ZpZGVyID0gc2Vzc2lvbkRhdGEucHJvdmlkZXJbMF07CglsZXQgbWFwUnRvSXRlbXMgPSBzZXNzaW9uRGF0YS5pdGVtcy5tYXAoKGl0ZW0pID0+IHsKCQlpZiAoaXRlbS5mdWxmaWxsbWVudF9pZCA9PT0gIkYxIiAmJiBpdGVtLnF1YW50aXR5LmNvdW50ID4gMCkgewoJCQljb25zdCBvYiA9IHsKCQkJCWlkOiBpdGVtLmlkLAoJCQkJcXVhbnRpdHk6IHsKCQkJCQljb3VudDogaXRlbS5xdWFudGl0eS5jb3VudCwKCQkJCX0sCgkJCQlmdWxmaWxsbWVudF9pZDogcnRvRnVsZmlsbG1lbnQuaWQsCgkJCX07CgkJCWl0ZW0ucXVhbnRpdHkuY291bnQgPSAwOyAvLyBTZXQgdGhlIGNvdW50IHRvIDAgZm9yIFJUTyBpdGVtcwoJCQlyZXR1cm4gb2I7CgkJfQoJCXJldHVybiB1bmRlZmluZWQ7Cgl9KTsKCW1hcFJ0b0l0ZW1zID0gbWFwUnRvSXRlbXMuZmlsdGVyKChpdGVtKSA9PiB7CgkJcmV0dXJuIGl0ZW07Cgl9KTsKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLml0ZW1zID0gWy4uLnNlc3Npb25EYXRhLml0ZW1zLCAuLi5tYXBSdG9JdGVtc107Cgljb25zdCBpdGVtcyA9IHNlc3Npb25EYXRhLml0ZW1zLm1hcCgoaXRlbSkgPT4gewoJCXJldHVybiB7CgkJCWlkOiBpdGVtLmlkLAoJCQljb3VudDogMCwKCQkJcHJpY2U6IHNlc3Npb25EYXRhLnF1b3RlWzBdLmJyZWFrdXAuZmluZCgKCQkJCShiKSA9PiBiWyJAb25kYy9vcmcvaXRlbV9pZCJdID09PSBpdGVtLmlkCgkJCSkucHJpY2UudmFsdWUsCgkJCWZ1bGZpbGxtZW50X2lkOiBpdGVtLmZ1bGZpbGxtZW50X2lkLAoJCX07Cgl9KTsKCgljb25zdCBzYXZlZEZ1bGZpbGxtZW50cyA9IHNlc3Npb25EYXRhLmZ1bGZpbGxtZW50czsKCWNvbnN0IGRlbGl2ZXJ5RnVsZmlsbG1lbnQgPSBzYXZlZEZ1bGZpbGxtZW50cy5maW5kKAoJCShmKSA9PiBmLnR5cGUgPT09ICJEZWxpdmVyeSIKCSkKCgljb25zdCBmMSA9IHNhdmVkRnVsZmlsbG1lbnRzLmZpbmQoKGYpID0+IGYuaWQgPT09ICJGMSIpOwoJY29uc3QgcHJldlN0YXRlID0gZjEuc3RhdGU/LmRlc2NyaXB0b3I/LmNvZGUgfHwgIk91dC1mb3ItZGVsaXZlcnkiOwoJY29uc3QgbGFzdF91cGRhdGVkX2F0ID0gc2Vzc2lvbkRhdGEubGFzdF91cGRhdGVkX2F0WzBdIHx8ICIiCgljb25zb2xlLmxvZyhsYXN0X3VwZGF0ZWRfYXQpCglmMS5zdGF0ZSA9IHsKCQlkZXNjcmlwdG9yOiB7CgkJCWNvZGU6ICJDYW5jZWxsZWQiLAoJCX0sCgl9OwoJZjEudGFncyA9IFsKCQkuLi4oZjEudGFncyA/PyBbXSksCgkJewoJCQljb2RlOiAiY2FuY2VsX3JlcXVlc3QiLAoJCQlsaXN0OiBbCgkJCQl7CgkJCQkJY29kZTogInJldHJ5X2NvdW50IiwKCQkJCQl2YWx1ZTogIjMiLAoJCQkJfSwKCQkJCXsKCQkJCQljb2RlOiAicnRvX2lkIiwKCQkJCQl2YWx1ZTogcnRvRnVsZmlsbG1lbnQuaWQsCgkJCQl9LAoJCQkJewoJCQkJCWNvZGU6ICJyZWFzb25faWQiLAoJCQkJCXZhbHVlOiAiMDEzIiwKCQkJCX0sCgkJCQl7CgkJCQkJY29kZTogImluaXRpYXRlZF9ieSIsCgkJCQkJdmFsdWU6IHNlc3Npb25EYXRhLmJwcF9pZCwKCQkJCX0sCgkJCV0sCgkJfSwKCQl7CgkJCWNvZGU6ICJwcmVjYW5jZWxfc3RhdGUiLAoJCQlsaXN0OiBbCgkJCQl7CgkJCQkJY29kZTogImZ1bGZpbGxtZW50X3N0YXRlIiwKCQkJCQl2YWx1ZTogcHJldlN0YXRlLAoJCQkJfSwKCQkJCXsKCQkJCQljb2RlOiAidXBkYXRlZF9hdCIsCgkJCQkJdmFsdWU6IGxhc3RfdXBkYXRlZF9hdCwKCQkJCX0sCgkJCV0sCgkJfSwKCV07CgoJZXhpc3RpbmdQYXlsb2FkLm1lc3NhZ2Uub3JkZXIuZnVsZmlsbG1lbnRzID0gWwoJCS4uLnNhdmVkRnVsZmlsbG1lbnRzLAoJCWNyZWF0ZVJ0b0Z1bGZpbGxtZW50KAoJCQlkZWxpdmVyeUZ1bGZpbGxtZW50LAoJCQlpdGVtcywKCQkJc2Vzc2lvbkRhdGEucXVvdGUKCQkpLAoJXTsKCWV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLnF1b3RlID0gc2Vzc2lvbkRhdGEucXVvdGVbMF07CglleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5jYW5jZWxsYXRpb24gPSB7CgkJY2FuY2VsbGVkX2J5OiAiQlBQIiwKCQlyZWFzb246IHsKCQkJaWQ6ICIwMDciCgkJfQoJfQoJcmV0dXJuIGV4aXN0aW5nUGF5bG9hZDsKfQo=
      validate: LyoqCiAqIFZhbGlkYXRlcyB0aGUgaW5jb21pbmcgcmVxdWVzdCBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXRQYXlsb2FkIC0gVGhlIGluY29taW5nIHJlcXVlc3QgcGF5bG9hZCB0byB2YWxpZGF0ZS4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiB2YWxpZGF0ZSh0YXJnZXRQYXlsb2FkLCBzZXNzaW9uRGF0YSkgewogIHJldHVybiB7IHZhbGlkOiB0cnVlLCBjb2RlOiAyMDAsIGRlc2NyaXB0aW9uOiAiVmFsaWQgcmVxdWVzdCIgfTsKfQ==
      requirements: LyoqCiAqIENoZWNrcyBpZiB0aGUgcmVxdWlyZW1lbnRzIGZvciBwcm9jZWVkaW5nIHdpdGggdGhlIEFQSSBjYWxsIGFyZSBtZXQuCiAqIAogKiBAcGFyYW0ge09iamVjdH0gc2Vzc2lvbkRhdGEgLSBEYXRhIGNvbGxlY3RlZCBmcm9tIHByZXZpb3VzIHRyYW5zYWN0aW9uIHN0ZXBzLgogKiAKICogQHJldHVybnMge09iamVjdH0geyB2YWxpZDogYm9vbGVhbiwgY29kZTogbnVtYmVyLCBkZXNjcmlwdGlvbjogc3RyaW5nIH0KICovCi8qKgogKiBDaGVja3MgaWYgdGhlIHJlcXVpcmVtZW50cyBmb3IgcHJvY2VlZGluZyB3aXRoIHRoZSBBUEkgY2FsbCBhcmUgbWV0LgogKiAKICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiBtZWV0UmVxdWlyZW1lbnRzKHNlc3Npb25EYXRhKSB7CiAgLy8gQ2hlY2sgZm9yIHNlbGVjdGVkX2l0ZW1zCiAgaWYgKCFzZXNzaW9uRGF0YS5zZWxlY3RlZF9pdGVtcyB8fCBzZXNzaW9uRGF0YS5zZWxlY3RlZF9pdGVtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBzZWxlY3RlZF9pdGVtcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU0VMRUNURURfSVRFTVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBwYXlsb2FkX2NpdHkKICBpZiAoIXNlc3Npb25EYXRhLnBheWxvYWRfY2l0eSkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHBheWxvYWRfY2l0eSBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUEFZTE9BRF9DSVRZIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3Igc2VsZWN0ZWRfZnVsZmlsbG1lbnRzCiAgaWYgKAogICAgIXNlc3Npb25EYXRhLnNlbGVjdGVkX2Z1bGZpbGxtZW50cyB8fAogICAgc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfZnVsZmlsbG1lbnRzLmxlbmd0aCA9PT0gMAogICkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHNlbGVjdGVkX2Z1bGZpbGxtZW50cyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU0VMRUNURURfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgcHJvdmlkZXIKICBpZiAoIXNlc3Npb25EYXRhLnByb3ZpZGVyKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gcHJvdmlkZXIgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1BST1ZJREVSIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgcXVvdGUKICBpZiAoIXNlc3Npb25EYXRhLnF1b3RlIHx8IHR5cGVvZiBzZXNzaW9uRGF0YS5xdW90ZSAhPT0gIm9iamVjdCIpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBxdW90ZSBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUVVPVEUiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBvbl9zZWxlY3RfZnVsZmlsbG1lbnRzCiAgaWYgKAogICAgIXNlc3Npb25EYXRhLm9uX3NlbGVjdF9mdWxmaWxsbWVudHMgfHwKICAgIHNlc3Npb25EYXRhLm9uX3NlbGVjdF9mdWxmaWxsbWVudHMubGVuZ3RoID09PSAwCiAgKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gb25fc2VsZWN0X2Z1bGZpbGxtZW50cyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfT05fU0VMRUNUX0ZVTEZJTExNRU5UUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9uX3NlbGVjdF9pdGVtcwogIGlmICgKICAgICFzZXNzaW9uRGF0YS5vbl9zZWxlY3RfaXRlbXMgfHwKICAgIHNlc3Npb25EYXRhLm9uX3NlbGVjdF9pdGVtcy5sZW5ndGggPT09IDAKICApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBvbl9zZWxlY3RfaXRlbXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX09OX1NFTEVDVF9JVEVNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHRhdAogIGlmICghc2Vzc2lvbkRhdGEudGF0KSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gdGF0IGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19UQVQiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBpdGVtcwogIGlmICghc2Vzc2lvbkRhdGEuaXRlbXMgfHwgc2Vzc2lvbkRhdGEuaXRlbXMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gaXRlbXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0lURU1TIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgYmlsbGluZwogIGlmICghc2Vzc2lvbkRhdGEuYmlsbGluZyB8fCB0eXBlb2Ygc2Vzc2lvbkRhdGEuYmlsbGluZyAhPT0gIm9iamVjdCIpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBiaWxsaW5nIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19CSUxMSU5HIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgZnVsZmlsbG1lbnRzCiAgaWYgKCFzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHMgfHwgc2Vzc2lvbkRhdGEuZnVsZmlsbG1lbnRzLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIGZ1bGZpbGxtZW50cyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3Igc2VsZWN0ZWRfbnBfZmVlcwogIGlmICghc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfbnBfZmVlcykgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHNlbGVjdGVkX25wX2ZlZXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1NFTEVDVEVEX05QX0ZFRVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBicHBfdGVybXMgKE5FVykKICBpZiAoIXNlc3Npb25EYXRhLmJwcF90ZXJtcyB8fCBzZXNzaW9uRGF0YS5icHBfdGVybXMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gYnBwX3Rlcm1zIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19CUFBfVEVSTVMiLAogICAgfTsKICB9CgogIC8vIEFsbCByZXF1aXJlbWVudHMgc2F0aXNmaWVkCiAgcmV0dXJuIHsKICAgIHZhbGlkOiB0cnVlLAogICAgZGVzY3JpcHRpb246ICJBbGwgQ2hlY2tzIHBhc3NlZCBzdWNjZXNzZnVsbHkiLAogICAgY29kZTogIjIwMCIsCiAgfTsKfQo=
      defaultPayload:
        context:
          domain: eB2B
          action: on_cancel
          timestamp: 2025-12-30T10:11:07.879Z
          transaction_id: 6db7d975-88a0-45f1-9c32-07c21547d7da
          message_id: dcbc0a6e-3589-49f4-a944-bce42066cc76
          bap_id: sample-bap-id
          bap_uri: https://bap.example.com
          ttl: PT30S
          bpp_id: sample-bpp-id
          bpp_uri: https://bpp.example.com
          country: IND
          city: "*"
          core_version: 1.2.0
        message:
          order:
            state: Cancelled
            items:
              - id: 839cb128-34bd-444d-9ffc-05903e62b35a
                quantity:
                  count: 0
                fulfillment_id: 3ac6a056-ceba-4c14-8e5d-ab5dd72d5239
              - id: 839cb128-34bd-444d-9ffc-05903e62b35a
                quantity:
                  count: 1
                fulfillment_id: e30fcb40-27f0-416f-b7fb-9a48e044caa0
            provider:
              id: 5b3981a7-512d-4ac4-bd75-ea48eff89a53
              locations:
                - id: 668e238e1b106d310473ddb0
            billing:
              address:
                name: Tanishq Mishra
                building: New_Building
                locality: 6th Cross Road
                city: Bengaluru
                state: Karnataka
                country: IND
                area_code: "560027"
              phone: "9399788618"
              name: Tanishq Mishra
              email: mishratanishq619@gmail.com
              created_at: 2024-08-08T10:01:24.650Z
              updated_at: 2024-08-08T10:01:24.650Z
            fulfillments:
              - id: 3ac6a056-ceba-4c14-8e5d-ab5dd72d5239
                "@ondc/org/provider_name": Seller Business
                "@ondc/org/TAT": PT96H
                state:
                  descriptor:
                    code: Cancelled
                type: Delivery
                tracking: false
                start:
                  location:
                    id: 668e238e1b106d310473ddb0
                    descriptor:
                      name: Seller Business
                    gps: 12.92580970146639,77.58362409712942
                    address:
                      locality: Jayanagar
                      city: Bengaluru
                      area_code: "560011"
                      state: Karnataka
                  contact:
                    email: test@gmail.com
                    phone: "9876543210"
                  time:
                    range:
                      start: 2024-08-08T10:09:58.799Z
                      end: 2024-08-10T10:09:58.799Z
                    timestamp: 2024-08-08T10:10:49.202Z
                end:
                  person:
                    name: Tanishq Mishra
                  contact:
                    email: mishratanishq619@gmail.com
                    phone: "9399788618"
                  location:
                    gps: 12.966545,77.592074
                    address:
                      name: Tanishq Mishra
                      building: New_Building
                      locality: 6th Cross Road
                      city: Bengaluru
                      state: Karnataka
                      country: IND
                      area_code: "560027"
                  time:
                    range:
                      start: 2024-08-12T10:09:58.799Z
                      end: 2024-08-14T10:09:58.799Z
                tags:
                  - code: cancel_request
                    list:
                      - code: retry_count
                        value: "1"
                      - code: rto_id
                        value: e30fcb40-27f0-416f-b7fb-9a48e044caa0
                      - code: reason_id
                        value: "013"
                      - code: initiated_by
                        value: sellerNP.com
                  - code: precancel_state
                    list:
                      - code: fulfillment_state
                        value: Out-for-delivery
                      - code: updated_at
                        value: 2024-08-08T10:11:08.138Z
              - id: e30fcb40-27f0-416f-b7fb-9a48e044caa0
                type: RTO
                state:
                  descriptor:
                    code: RTO-Initiated
                start:
                  contact:
                    email: mishratanishq619@gmail.com
                    phone: "9399788618"
                  location:
                    gps: 12.966545,77.592074
                    address:
                      name: Tanishq Mishra
                      building: New_Building
                      locality: 6th Cross Road
                      city: Bengaluru
                      state: Karnataka
                      country: IND
                      area_code: "560027"
                  time:
                    timestamp: 2024-08-08T10:11:24.749Z
                end:
                  location:
                    id: 668e238e1b106d310473ddb0
                    descriptor:
                      name: Seller Business
                    gps: 12.92580970146639,77.58362409712942
                    address:
                      locality: Jayanagar
                      city: Bengaluru
                      area_code: "560011"
                      state: Karnataka
                  contact:
                    email: test@gmail.com
                    phone: "9876543210"
                tags:
                  - code: quote_trail
                    list:
                      - code: type
                        value: item
                      - code: id
                        value: 839cb128-34bd-444d-9ffc-05903e62b35a
                      - code: currency
                        value: INR
                      - code: value
                        value: "-2260.00"
            quote:
              price:
                currency: INR
                value: "593.75"
              breakup:
                - "@ondc/org/item_id": 839cb128-34bd-444d-9ffc-05903e62b35a
                  "@ondc/org/item_quantity":
                    count: 0
                  title: Butterfly Beutiful 12 Gold Necklace
                  "@ondc/org/title_type": item
                  price:
                    currency: INR
                    value: "0"
                  item:
                    price:
                      currency: INR
                      value: "2260.00"
                - "@ondc/org/item_id": 3ac6a056-ceba-4c14-8e5d-ab5dd72d5239
                  title: Delivery charges
                  "@ondc/org/title_type": delivery
                  price:
                    currency: INR
                    value: "0"
                - "@ondc/org/item_id": 3ac6a056-ceba-4c14-8e5d-ab5dd72d5239
                  title: Convenience Fee
                  "@ondc/org/title_type": misc
                  price:
                    currency: INR
                    value: "0"
              ttl: P1D
            payment:
              uri: https://razorpay.com/
              tl_method: http/get
              params:
                amount: "2853.75"
                currency: INR
                transaction_id: 68079e7c-0af9-4e16-a356-2e6ec708e2cb
              status: PAID
              type: ON-ORDER
              collected_by: BAP
              "@ondc/org/buyer_app_finder_fee_type": percent
              "@ondc/org/buyer_app_finder_fee_amount": "3.0"
              "@ondc/org/settlement_details":
                - settlement_counterparty: seller-app
                  settlement_phase: sale-amount
                  settlement_type: neft
                  upi_address: gft@oksbi
                  settlement_bank_account_no: "34234343434"
                  settlement_ifsc_code: SBIN0000123
                  beneficiary_name: Seller Name
                  bank_name: SBI
                  branch_name: Nellore
            id: 2024-08-08-739546
            created_at: 2024-08-08T10:01:50.601Z
            updated_at: 2024-08-08T10:11:24.790Z
      saveData:
        transactionId: $.context.transaction_id
        latestMessage_id: $.context.message_id
        latestTimestamp: $.context.timestamp
        bapId: $.context.bap_id
        bapUri: $.context.bap_uri
        bppId: $.context.bpp_id
        bppUri: $.context.bpp_uri
        fulfillments: $.message.order.fulfillments[*]
        quote: $.message.order.quote
        items: $.message.order.items[*]
      inputs: {}
  - api: on_status
    action_id: on_status_rto_delivered
    owner: BPP
    responseFor: null
    unsolicited: false
    description: please add relevant description
    mock:
      generate: ZnVuY3Rpb24gZ2V0VXBkYXRlZEJpbGxpbmcoc2F2ZWRCaWxsaW5nLCBpbml0aWFsaXplID0gZmFsc2UpIHsKICBpZiAoaW5pdGlhbGl6ZSkgewogICAgY29uc3QgbmV3SXNvID0gbmV3IERhdGUobmV3IERhdGUoKS5nZXRUaW1lKCkgLSA1ICogMTAwMCkudG9JU09TdHJpbmcoKTsKICAgIHNhdmVkQmlsbGluZy5jcmVhdGVkX2F0ID0gbmV3SXNvOwogICAgc2F2ZWRCaWxsaW5nLnVwZGF0ZWRfYXQgPSBuZXdJc287CiAgfQogIHJldHVybiBzYXZlZEJpbGxpbmc7Cn0KCmZ1bmN0aW9uIGNyZWF0ZUZ1bGZpbGxtZW50cygKICBhY3Rpb24sCiAgYWN0aW9uSWQsCiAgc2Vzc2lvbkRhdGEsCiAgZGVmYXVsdEZ1bGZpbGxtZW50cwopIHsKICBpZiAoZGVmYXVsdEZ1bGZpbGxtZW50cy5sZW5ndGggPCAxKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIkVtcHR5IGZ1bGZpbGxtZW50cyBmb3VuZCIpOwogIH0KICBjb25zdCBvblNlbGVjdEZ1bGZpbGxtZW50cyA9CiAgICBzZXNzaW9uRGF0YS5vbl9zZWxlY3RfZnVsZmlsbG1lbnRzOwoKCiAgaWYgKGFjdGlvbiA9PT0gIm9uX3N0YXR1cyIpIHsKICAgIGxldCBmdWxmaWxsbWVudHMgPSBzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHM7CiAgICBjb25zdCB0YWdzID0gewogICAgICB0YWdzOiBbCiAgICAgICAgewogICAgICAgICAgY29kZTogInJvdXRpbmciLAogICAgICAgICAgbGlzdDogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29kZTogInR5cGUiLAogICAgICAgICAgICAgIHZhbHVlOiAiUDJIMlAiLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGNvZGU6ICJ0cmFja2luZyIsCiAgICAgICAgICBsaXN0OiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb2RlOiAiZ3BzX2VuYWJsZWQiLAogICAgICAgICAgICAgIHZhbHVlOiAibm8iLAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29kZTogInVybF9lbmFibGVkIiwKICAgICAgICAgICAgICB2YWx1ZTogInllcyIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb2RlOiAidXJsIiwKICAgICAgICAgICAgICB2YWx1ZTogImh0dHBzOi8vc2VsbGVyTlAuY29tL29uZGMvdHJhY2tpbmdfdXJsIiwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgfSwKICAgICAgXSwKICAgIH07CiAgICBsZXQgZmluYWxGdWxmaWxsbWVudHMgPSBzZXNzaW9uRGF0YS5vbl9zdGF0dXNfZnVsZmlsbG1lbnRzOwogICAgaWYgKHNlc3Npb25EYXRhLm9uX3N0YXR1c19mdWxmaWxsbWVudHMubGVuZ3RoIDw9IDApIHsKICAgICAgY29uc3QgdGltZSA9IG5ldyBEYXRlKG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgMTAgKiAxMDAwICogNjApOwogICAgICBjb25zdCBzdGFydF9lbmQgPSBuZXcgRGF0ZSh0aW1lLmdldFRpbWUoKSArIDEwICogMTAwMCAqIDYwKS50b0lTT1N0cmluZygpOwogICAgICBmaW5hbEZ1bGZpbGxtZW50cyA9IGZ1bGZpbGxtZW50cwogICAgICAgIC8vIC5maWx0ZXIoKGYpID0+IGYudHlwZSA9PSAiRGVsaXZlcnkiKQogICAgICAgIC5tYXAoKGYpID0+IHsKICAgICAgICAgIGlmIChmLnR5cGUgPT0gIkRlbGl2ZXJ5IikgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIC4uLmYsCiAgICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICAgIC4uLmYuc3RhcnQsCiAgICAgICAgICAgICAgICB0aW1lOiB7CiAgICAgICAgICAgICAgICAgIHJhbmdlOiB7CiAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IHRpbWUudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgICAgICAgICBlbmQ6IHN0YXJ0X2VuZCwKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICAgIC4uLmYuZW5kLAogICAgICAgICAgICAgICAgdGltZTogewogICAgICAgICAgICAgICAgICByYW5nZTogewogICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBzdGFydF9lbmQsCiAgICAgICAgICAgICAgICAgICAgZW5kOiBuZXcgRGF0ZSgKICAgICAgICAgICAgICAgICAgICAgIHRpbWUuZ2V0VGltZSgpICsKICAgICAgICAgICAgICAgICAgICAgIDEwMDAgKiBpc29EdXJUb1NlYyhmWyJAb25kYy9vcmcvVEFUIl0gfHwgIlBUMEgiKQogICAgICAgICAgICAgICAgICAgICkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB0YWdzOiB0YWdzLnRhZ3MsCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZjsKICAgICAgICB9KTsKICAgICAgLy8gZnVsZmlsbG1lbnRzID0gZnVsZmlsbG1lbnRzLmZpbHRlcigoZikgPT4gZi50eXBlICE9ICJEZWxpdmVyeSIpOwogICAgICAvLyBmaW5hbEZ1bGZpbGxtZW50cyA9IHsgLi4uZmluYWxGdWxmaWxsbWVudHMsIC4uLmZ1bGZpbGxtZW50cyB9OwogICAgfQogICAgbGV0IHN0YXRlID0gIlBlbmRpbmciOwogICAgc3dpdGNoIChhY3Rpb25JZCkgewogICAgICBjYXNlICJvbl9zdGF0dXNfcGFja2VkIjoKICAgICAgICBzdGF0ZSA9ICJQYWNrZWQiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJvbl9zdGF0dXNfYWNjZXB0ZWQiOgogICAgICAgIHN0YXRlID0gIlBlbmRpbmciOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJvbl9zdGF0dXNfYWdlbnRfYXNzaWduZWQiOgogICAgICAgIHN0YXRlID0gIkFnZW50LWFzc2lnbmVkIjsKCiAgICAgICAgZmluYWxGdWxmaWxsbWVudHMgPSBmaW5hbEZ1bGZpbGxtZW50cy5tYXAoKGYpID0+IHsKICAgICAgICAgIGlmIChmLnR5cGUgPT09ICJEZWxpdmVyeSIpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAuLi5mLAogICAgICAgICAgICAgIGFnZW50OiB7CiAgICAgICAgICAgICAgICBuYW1lOiAibW9jay1hZ2VudCIsCiAgICAgICAgICAgICAgICBwaG9uZTogIjk4ODYwOTg4NjAiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZjsgLy8gbGVhdmUgb3RoZXIgdHlwZXMgdW5jaGFuZ2VkCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIm9uX3N0YXR1c19waWNrZWQiOgogICAgICAgIHN0YXRlID0gIk9yZGVyLXBpY2tlZC11cCI7CiAgICAgICAgZmluYWxGdWxmaWxsbWVudHMgPSBmaW5hbEZ1bGZpbGxtZW50cy5tYXAoKGYpID0+IHsKICAgICAgICAgIGlmIChmLnR5cGUgPT09ICJEZWxpdmVyeSIpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAuLi5mLAogICAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgICAuLi5mLnN0YXJ0LAogICAgICAgICAgICAgICAgdGltZTogewogICAgICAgICAgICAgICAgICAuLi5mLnN0YXJ0Py50aW1lLAogICAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmOyAvLyBsZWF2ZSBvdGhlciB0eXBlcyB1bmNoYW5nZWQKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAib25fc3RhdHVzX291dF9mb3JfZGVsaXZlcnkiOgogICAgICAgIHN0YXRlID0gIk91dC1mb3ItZGVsaXZlcnkiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJvbl9zdGF0dXNfb3JkZXJfZGVsaXZlcmVkIjoKICAgICAgICBzdGF0ZSA9ICJPcmRlci1kZWxpdmVyZWQiOwogICAgICAgIGZpbmFsRnVsZmlsbG1lbnRzID0gZmluYWxGdWxmaWxsbWVudHMubWFwKChmKSA9PiB7CiAgICAgICAgICBpZiAoZi50eXBlID09PSAiRGVsaXZlcnkiKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgLi4uZiwKICAgICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICAgIC4uLmYuZW5kLAogICAgICAgICAgICAgICAgdGltZTogewogICAgICAgICAgICAgICAgICAuLi5mLmVuZD8udGltZSwKICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZjsgLy8gbGVhdmUgb3RoZXIgdHlwZXMgdW5jaGFuZ2VkCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIm9uX3N0YXR1c19ydG9fZGVsaXZlcmVkIjoKICAgICAgICBzdGF0ZSA9ICJDYW5jZWxsZWQiOwogICAgICAgIGZpbmFsRnVsZmlsbG1lbnRzID0gZmluYWxGdWxmaWxsbWVudHMubWFwKChmKSA9PiB7CiAgICAgICAgICBpZiAoZi50eXBlID09PSAiUlRPIikgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIC4uLmYsCiAgICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgICAuLi5mLmVuZCwKICAgICAgICAgICAgICAgIHRpbWU6IHsKICAgICAgICAgICAgICAgICAgLi4uZi5lbmQ/LnRpbWUsCiAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHN0YXRlOiB7CiAgICAgICAgICAgICAgICBkZXNjcmlwdG9yOiB7CiAgICAgICAgICAgICAgICAgIGNvZGU6ICJSVE8tRGVsaXZlcmVkIiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChmLnR5cGUgPT09ICJEZWxpdmVyeSIpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAuLi5mLAogICAgICAgICAgICAgIHN0YXRlOiB7CiAgICAgICAgICAgICAgICBkZXNjcmlwdG9yOiB7CiAgICAgICAgICAgICAgICAgIGNvZGU6ICJDYW5jZWxsZWQiLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGY7IC8vIGxlYXZlIG90aGVyIHR5cGVzIHVuY2hhbmdlZAogICAgICAgIH0pOwoKICAgICAgY2FzZSAib25fc3RhdHVzX3JlYWR5X3RvX3NoaXAiOgogICAgICAgIHN0YXRlID0gIlBhY2tlZCI7CiAgICAgICAgZmluYWxGdWxmaWxsbWVudHMgPSBmaW5hbEZ1bGZpbGxtZW50cy5tYXAoKGYpID0+IHsKICAgICAgICAgIGlmIChmLnR5cGUgPT09ICJCdXllci1EZWxpdmVyeSIpIHsKICAgICAgICAgICAgY29uc3QgdGFncyA9IGYudGFncyB8fCBbXTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAuLi5mLAogICAgICAgICAgICAgIHRhZ3M6IFsKICAgICAgICAgICAgICAgIC4uLnRhZ3MsCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGNvZGU6ICJzdGF0ZSIsCiAgICAgICAgICAgICAgICAgIGxpc3Q6IFsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICBjb2RlOiAicmVhZHlfdG9fc2hpcCIsCiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogInllcyIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGNvZGU6ICJyb3V0aW5nIiwKICAgICAgICAgICAgICAgICAgbGlzdDogWwogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgIGNvZGU6ICJ0eXBlIiwKICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAiUDJQIiwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGY7IC8vIGxlYXZlIG90aGVyIHR5cGVzIHVuY2hhbmdlZAogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwoKICAgICAgZGVmYXVsdDoKICAgICAgICBicmVhazsKICAgIH0KICAgIGZpbmFsRnVsZmlsbG1lbnRzID0gZmluYWxGdWxmaWxsbWVudHMubWFwKChmKSA9PiB7CiAgICAgIGlmIChmLnR5cGUgPT09ICJEZWxpdmVyeSIpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgLi4uZiwKICAgICAgICAgIHN0YXRlOiB7CiAgICAgICAgICAgIGRlc2NyaXB0b3I6IHsKICAgICAgICAgICAgICBjb2RlOiBzdGF0ZSwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgfTsKICAgICAgfQogICAgICByZXR1cm4gZjsKICAgIH0pOwogICAgcmV0dXJuIGZpbmFsRnVsZmlsbG1lbnRzOwogIH0KICByZXR1cm4gZGVmYXVsdEZ1bGZpbGxtZW50czsKfQoKZnVuY3Rpb24gY3JlYXRlR2VuZXJpY09uU3RhdHVzKAogIGV4aXN0aW5nUGF5bG9hZCwKICBzZXNzaW9uRGF0YQopIHsKICBleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5pZCA9IHNlc3Npb25EYXRhLm9yZGVyX2lkWzBdOwogIGV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLnByb3ZpZGVyID0gc2Vzc2lvbkRhdGEucHJvdmlkZXJbMF07CiAgZXhpc3RpbmdQYXlsb2FkLm1lc3NhZ2Uub3JkZXIuaXRlbXMgPSBzZXNzaW9uRGF0YS5pdGVtczsKICBleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5iaWxsaW5nID0gZ2V0VXBkYXRlZEJpbGxpbmcoCiAgICBzZXNzaW9uRGF0YS5iaWxsaW5nWzBdCiAgKTsKICAvLyBleGlzdGluZ1BheWxvYWQubWVzc2FnZS5vcmRlci5mdWxmaWxsbWVudHMgPSBzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHM7CiAgZXhpc3RpbmdQYXlsb2FkLm1lc3NhZ2Uub3JkZXIucXVvdGUgPSBzZXNzaW9uRGF0YS5xdW90ZVswXTsKICBjb25zdCB0aW1lSVNPID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpOwogIGV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLnVwZGF0ZWRfYXQgPSB0aW1lSVNPOwogIGV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLmNyZWF0ZWRfYXQgPSBzZXNzaW9uRGF0YS5vcmRlcl9jcmVhdGVkX2F0WzBdOwogIGV4aXN0aW5nUGF5bG9hZC5tZXNzYWdlLm9yZGVyLnBheW1lbnQgPSBzZXNzaW9uRGF0YS5wYXltZW50WzBdOwogIHJldHVybiBleGlzdGluZ1BheWxvYWQ7Cn0KYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGUoCglleGlzdGluZ1BheWxvYWQsCglzZXNzaW9uRGF0YQopIHsKCWNvbnN0IGdlbmVyYWxQYXlsb2FkID0gY3JlYXRlR2VuZXJpY09uU3RhdHVzKGV4aXN0aW5nUGF5bG9hZCwgc2Vzc2lvbkRhdGEpOwoJZ2VuZXJhbFBheWxvYWQubWVzc2FnZS5vcmRlci5mdWxmaWxsbWVudHMgPSBjcmVhdGVGdWxmaWxsbWVudHMoCgkJIm9uX3N0YXR1cyIsCgkJIm9uX3N0YXR1c19ydG9fZGVsaXZlcmVkIiwKCQlzZXNzaW9uRGF0YSwKCQlnZW5lcmFsUGF5bG9hZC5tZXNzYWdlLm9yZGVyLmZ1bGZpbGxtZW50cwoJKTsKCXJldHVybiBleGlzdGluZ1BheWxvYWQ7Cn0K
      validate: LyoqCiAqIFZhbGlkYXRlcyB0aGUgaW5jb21pbmcgcmVxdWVzdCBwYXlsb2FkIGZvciBhbiBBUEkgY2FsbCBpbiB0aGUgdHJhbnNhY3Rpb24gZmxvdy4KICogCiAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXRQYXlsb2FkIC0gVGhlIGluY29taW5nIHJlcXVlc3QgcGF5bG9hZCB0byB2YWxpZGF0ZS4KICogQHBhcmFtIHtPYmplY3R9IHNlc3Npb25EYXRhIC0gRGF0YSBjb2xsZWN0ZWQgZnJvbSBwcmV2aW91cyB0cmFuc2FjdGlvbiBzdGVwcy4KICogCiAqIEByZXR1cm5zIHtPYmplY3R9IHsgdmFsaWQ6IGJvb2xlYW4sIGNvZGU6IG51bWJlciwgZGVzY3JpcHRpb246IHN0cmluZyB9CiAqLwpmdW5jdGlvbiB2YWxpZGF0ZSh0YXJnZXRQYXlsb2FkLCBzZXNzaW9uRGF0YSkgewogIHJldHVybiB7IHZhbGlkOiB0cnVlLCBjb2RlOiAyMDAsIGRlc2NyaXB0aW9uOiAiVmFsaWQgcmVxdWVzdCIgfTsKfQ==
      requirements: LyoqCiAqIENoZWNrcyBpZiB0aGUgcmVxdWlyZW1lbnRzIGZvciBwcm9jZWVkaW5nIHdpdGggdGhlIEFQSSBjYWxsIGFyZSBtZXQuCiAqIAogKiBAcGFyYW0ge09iamVjdH0gc2Vzc2lvbkRhdGEgLSBEYXRhIGNvbGxlY3RlZCBmcm9tIHByZXZpb3VzIHRyYW5zYWN0aW9uIHN0ZXBzLgogKiAKICogQHJldHVybnMge09iamVjdH0geyB2YWxpZDogYm9vbGVhbiwgY29kZTogbnVtYmVyLCBkZXNjcmlwdGlvbjogc3RyaW5nIH0KICovCmZ1bmN0aW9uIG1lZXRSZXF1aXJlbWVudHMoc2Vzc2lvbkRhdGEpIHsKICAvLyBDaGVjayBmb3Igc2VsZWN0ZWRfaXRlbXMKICBpZiAoIXNlc3Npb25EYXRhLnNlbGVjdGVkX2l0ZW1zIHx8IHNlc3Npb25EYXRhLnNlbGVjdGVkX2l0ZW1zLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHNlbGVjdGVkX2l0ZW1zIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19TRUxFQ1RFRF9JVEVNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHBheWxvYWRfY2l0eQogIGlmICghc2Vzc2lvbkRhdGEucGF5bG9hZF9jaXR5KSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gcGF5bG9hZF9jaXR5IGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19QQVlMT0FEX0NJVFkiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBzZWxlY3RlZF9mdWxmaWxsbWVudHMKICBpZiAoCiAgICAhc2Vzc2lvbkRhdGEuc2VsZWN0ZWRfZnVsZmlsbG1lbnRzIHx8CiAgICBzZXNzaW9uRGF0YS5zZWxlY3RlZF9mdWxmaWxsbWVudHMubGVuZ3RoID09PSAwCiAgKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gc2VsZWN0ZWRfZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19TRUxFQ1RFRF9GVUxGSUxMTUVOVFMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBwcm92aWRlcgogIGlmICghc2Vzc2lvbkRhdGEucHJvdmlkZXIpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBwcm92aWRlciBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUFJPVklERVIiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBxdW90ZQogIGlmICghc2Vzc2lvbkRhdGEucXVvdGUgfHwgdHlwZW9mIHNlc3Npb25EYXRhLnF1b3RlICE9PSAib2JqZWN0IikgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHF1b3RlIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19RVU9URSIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9uX3NlbGVjdF9mdWxmaWxsbWVudHMKICBpZiAoCiAgICAhc2Vzc2lvbkRhdGEub25fc2VsZWN0X2Z1bGZpbGxtZW50cyB8fAogICAgc2Vzc2lvbkRhdGEub25fc2VsZWN0X2Z1bGZpbGxtZW50cy5sZW5ndGggPT09IDAKICApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBvbl9zZWxlY3RfZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19PTl9TRUxFQ1RfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3Igb25fc2VsZWN0X2l0ZW1zCiAgaWYgKAogICAgIXNlc3Npb25EYXRhLm9uX3NlbGVjdF9pdGVtcyB8fAogICAgc2Vzc2lvbkRhdGEub25fc2VsZWN0X2l0ZW1zLmxlbmd0aCA9PT0gMAogICkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIG9uX3NlbGVjdF9pdGVtcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfT05fU0VMRUNUX0lURU1TIiwKICAgIH07CiAgfQoKICAvLyBDaGVjayBmb3IgdGF0CiAgaWYgKCFzZXNzaW9uRGF0YS50YXQpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyB0YXQgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX1RBVCIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIGl0ZW1zCiAgaWYgKCFzZXNzaW9uRGF0YS5pdGVtcyB8fCBzZXNzaW9uRGF0YS5pdGVtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBpdGVtcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfSVRFTVMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBiaWxsaW5nCiAgaWYgKCFzZXNzaW9uRGF0YS5iaWxsaW5nIHx8IHR5cGVvZiBzZXNzaW9uRGF0YS5iaWxsaW5nICE9PSAib2JqZWN0IikgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIGJpbGxpbmcgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0JJTExJTkciLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBmdWxmaWxsbWVudHMKICBpZiAoIXNlc3Npb25EYXRhLmZ1bGZpbGxtZW50cyB8fCBzZXNzaW9uRGF0YS5mdWxmaWxsbWVudHMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19GVUxGSUxMTUVOVFMiLAogICAgfTsKICB9CgogIC8vIENoZWNrIGZvciBzZWxlY3RlZF9ucF9mZWVzCiAgaWYgKCFzZXNzaW9uRGF0YS5zZWxlY3RlZF9ucF9mZWVzKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gc2VsZWN0ZWRfbnBfZmVlcyBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfU0VMRUNURURfTlBfRkVFUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIGJwcF90ZXJtcwogIGlmICghc2Vzc2lvbkRhdGEuYnBwX3Rlcm1zIHx8IHNlc3Npb25EYXRhLmJwcF90ZXJtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBicHBfdGVybXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0JQUF9URVJNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9yZGVyX2lkCiAgaWYgKCFzZXNzaW9uRGF0YS5vcmRlcl9pZCkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIG9yZGVyX2lkIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19PUkRFUl9JRCIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIGJhcF90ZXJtcwogIGlmICghc2Vzc2lvbkRhdGEuYmFwX3Rlcm1zIHx8IHNlc3Npb25EYXRhLmJhcF90ZXJtcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBiYXBfdGVybXMgYXZhaWxhYmxlIGluIHNlc3Npb24gZGF0YSIsCiAgICAgIGNvZGU6ICJNSVNTSU5HX0JBUF9URVJNUyIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHN0YXRlCiAgaWYgKCFzZXNzaW9uRGF0YS5zdGF0ZSkgewogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogIk5vIHN0YXRlIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19TVEFURSIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIHBheW1lbnQKICBpZiAoIXNlc3Npb25EYXRhLnBheW1lbnQgfHwgdHlwZW9mIHNlc3Npb25EYXRhLnBheW1lbnQgIT09ICJvYmplY3QiKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogZmFsc2UsCiAgICAgIGRlc2NyaXB0aW9uOiAiTm8gcGF5bWVudCBhdmFpbGFibGUgaW4gc2Vzc2lvbiBkYXRhIiwKICAgICAgY29kZTogIk1JU1NJTkdfUEFZTUVOVCIsCiAgICB9OwogIH0KCiAgLy8gQ2hlY2sgZm9yIG9uX3N0YXR1c19mdWxmaWxsbWVudHMgKE5FVykKICBpZiAoCiAgICAhc2Vzc2lvbkRhdGEub25fc3RhdHVzX2Z1bGZpbGxtZW50cyB8fAogICAgc2Vzc2lvbkRhdGEub25fc3RhdHVzX2Z1bGZpbGxtZW50cy5sZW5ndGggPT09IDAKICApIHsKICAgIHJldHVybiB7CiAgICAgIHZhbGlkOiBmYWxzZSwKICAgICAgZGVzY3JpcHRpb246ICJObyBvbl9zdGF0dXNfZnVsZmlsbG1lbnRzIGF2YWlsYWJsZSBpbiBzZXNzaW9uIGRhdGEiLAogICAgICBjb2RlOiAiTUlTU0lOR19PTl9TVEFUVVNfRlVMRklMTE1FTlRTIiwKICAgIH07CiAgfQoKICAvLyBBbGwgcmVxdWlyZW1lbnRzIHNhdGlzZmllZAogIHJldHVybiB7CiAgICB2YWxpZDogdHJ1ZSwKICAgIGRlc2NyaXB0aW9uOiAiQWxsIENoZWNrcyBwYXNzZWQgc3VjY2Vzc2Z1bGx5IiwKICAgIGNvZGU6ICIyMDAiLAogIH07Cn0=
      defaultPayload:
        context:
          domain: eB2B
          action: on_status
          timestamp: 2025-12-30T10:12:17.027Z
          transaction_id: 6db7d975-88a0-45f1-9c32-07c21547d7da
          message_id: 9c180f53-781a-49b7-9510-a70783378e7a
          bap_id: sample-bap-id
          bap_uri: https://bap.example.com
          ttl: PT30S
          bpp_id: sample-bpp-id
          bpp_uri: https://bpp.example.com
          country: IND
          city: "*"
          core_version: 1.2.0
        message:
          order:
            provider:
              id: 5b3981a7-512d-4ac4-bd75-ea48eff89a53
              locations:
                - id: 668e238e1b106d310473ddb0
            state: Cancelled
            items:
              - id: 839cb128-34bd-444d-9ffc-05903e62b35a
                quantity:
                  count: 0
                fulfillment_id: 3ac6a056-ceba-4c14-8e5d-ab5dd72d5239
              - id: 839cb128-34bd-444d-9ffc-05903e62b35a
                quantity:
                  count: 1
                fulfillment_id: e30fcb40-27f0-416f-b7fb-9a48e044caa0
            billing:
              address:
                name: Tanishq Mishra
                building: New_Building
                locality: 6th Cross Road
                city: Bengaluru
                state: Karnataka
                country: IND
                area_code: "560027"
              phone: "9399788618"
              name: Tanishq Mishra
              email: mishratanishq619@gmail.com
              created_at: 2024-08-08T10:01:24.650Z
              updated_at: 2024-08-08T10:01:24.650Z
            fulfillments:
              - id: 3ac6a056-ceba-4c14-8e5d-ab5dd72d5239
                "@ondc/org/provider_name": Seller Business
                "@ondc/org/TAT": PT96H
                state:
                  descriptor:
                    code: Cancelled
                type: Delivery
                tracking: false
                start:
                  location:
                    id: 668e238e1b106d310473ddb0
                    descriptor:
                      name: Seller Business
                    gps: 12.92580970146639,77.58362409712942
                    address:
                      locality: Jayanagar
                      city: Bengaluru
                      area_code: "560011"
                      state: Karnataka
                  contact:
                    email: test@gmail.com
                    phone: "9876543210"
                  time:
                    range:
                      start: 2024-08-08T10:09:58.799Z
                      end: 2024-08-10T10:09:58.799Z
                    timestamp: 2024-08-08T10:10:49.202Z
                end:
                  person:
                    name: Tanishq Mishra
                  contact:
                    email: mishratanishq619@gmail.com
                    phone: "9399788618"
                  location:
                    gps: 12.966545,77.592074
                    address:
                      name: Tanishq Mishra
                      building: New_Building
                      locality: 6th Cross Road
                      city: Bengaluru
                      state: Karnataka
                      country: IND
                      area_code: "560027"
                  time:
                    range:
                      start: 2024-08-12T10:09:58.799Z
                      end: 2024-08-14T10:09:58.799Z
                tags:
                  - code: cancel_request
                    list:
                      - code: retry_count
                        value: "1"
                      - code: rto_id
                        value: e30fcb40-27f0-416f-b7fb-9a48e044caa0
                      - code: reason_id
                        value: "013"
                      - code: initiated_by
                        value: sellerNP.com
                  - code: precancel_state
                    list:
                      - code: fulfillment_state
                        value: Out-for-delivery
                      - code: updated_at
                        value: 2024-08-08T10:11:08.138Z
              - id: e30fcb40-27f0-416f-b7fb-9a48e044caa0
                type: RTO
                state:
                  descriptor:
                    code: RTO-Delivered
                start:
                  contact:
                    email: mishratanishq619@gmail.com
                    phone: "9399788618"
                  location:
                    gps: 12.966545,77.592074
                    address:
                      name: Tanishq Mishra
                      building: New_Building
                      locality: 6th Cross Road
                      city: Bengaluru
                      state: Karnataka
                      country: IND
                      area_code: "560027"
                  time:
                    timestamp: 2024-08-08T10:11:24.749Z
                end:
                  location:
                    id: 668e238e1b106d310473ddb0
                    descriptor:
                      name: Seller Business
                    gps: 12.92580970146639,77.58362409712942
                    address:
                      locality: Jayanagar
                      city: Bengaluru
                      area_code: "560011"
                      state: Karnataka
                  contact:
                    email: test@gmail.com
                    phone: "9876543210"
                  time:
                    timestamp: 2024-08-08T10:14:24.156Z
                tags:
                  - code: quote_trail
                    list:
                      - code: type
                        value: item
                      - code: id
                        value: 839cb128-34bd-444d-9ffc-05903e62b35a
                      - code: currency
                        value: INR
                      - code: value
                        value: "-2260.00"
            quote:
              price:
                currency: INR
                value: "593.75"
              breakup:
                - "@ondc/org/item_id": 839cb128-34bd-444d-9ffc-05903e62b35a
                  "@ondc/org/item_quantity":
                    count: 0
                  title: Butterfly Beutiful 12 Gold Necklace
                  "@ondc/org/title_type": item
                  price:
                    currency: INR
                    value: "0"
                  item:
                    price:
                      currency: INR
                      value: "2260.00"
                - "@ondc/org/item_id": 3ac6a056-ceba-4c14-8e5d-ab5dd72d5239
                  title: Delivery charges
                  "@ondc/org/title_type": delivery
                  price:
                    currency: INR
                    value: "493.75"
                - "@ondc/org/item_id": 3ac6a056-ceba-4c14-8e5d-ab5dd72d5239
                  title: Convenience Fee
                  "@ondc/org/title_type": misc
                  price:
                    currency: INR
                    value: "100"
              ttl: P1D
            payment:
              uri: https://razorpay.com/
              tl_method: http/get
              params:
                amount: "2853.75"
                currency: INR
                transaction_id: 68079e7c-0af9-4e16-a356-2e6ec708e2cb
              status: PAID
              type: ON-ORDER
              collected_by: BAP
              "@ondc/org/buyer_app_finder_fee_type": percent
              "@ondc/org/buyer_app_finder_fee_amount": "3.0"
              "@ondc/org/settlement_details":
                - settlement_counterparty: seller-app
                  settlement_phase: sale-amount
                  settlement_type: neft
                  upi_address: gft@oksbi
                  settlement_bank_account_no: "34234343434"
                  settlement_ifsc_code: SBIN0000123
                  beneficiary_name: Seller Name
                  bank_name: SBI
                  branch_name: Nellore
            id: 2024-08-08-739546
            created_at: 2024-08-08T10:01:50.601Z
            updated_at: 2024-08-08T10:14:29.454Z
            documents:
              - url: https://invoice_url
                label: Invoice
      saveData:
        transactionId: $.context.transaction_id
        latestMessage_id: $.context.message_id
        latestTimestamp: $.context.timestamp
        bapId: $.context.bap_id
        bapUri: $.context.bap_uri
        bppId: $.context.bpp_id
        bppUri: $.context.bpp_uri
        order_state: $.message.order.state
        fulfillments: $.message.order.fulfillments[*]
        last_updated_at: $.message.order.updated_at
      inputs: {}
transaction_history:
  - action_id: select
    payload:
      context:
        domain: ONDC:RETeB2B
        action: select
        timestamp: 2026-02-23T15:24:42.983Z
        transaction_id: 6db7d975-88a0-45f1-9c32-07c21547d7da
        message_id: 6e445d2c-0d03-47d7-a72e-bd3f61a8645b
        bap_id: sample-bap-id
        bap_uri: https://bap.example.com
        ttl: PT30S
        bpp_id: sample-bpp-id
        bpp_uri: https://bpp.example.com
        country: IND
        city: std:011
        core_version: 1.2.5
      message:
        order:
          provider:
            id: P1
            locations:
              - id: L1
          items:
            - id: I1
              quantity:
                count: 1
              location: L1
          fulfillments:
            - type: Delivery
              customer:
                id: CUST_001
                organization:
                  descriptor:
                    name: Sharma Kirana Store
                person:
                  creds:
                    - id: 29AABCU9603R1ZM
                      type: GSTIN
                    - id: AABCU9603R
                      type: PAN
              end:
                location:
                  gps: 19.129076,72.825803
                  address:
                    area_code: "400053"
    action: select
    saved_info: {}
  - action_id: on_select
    payload:
      context:
        domain: ONDC:RETeB2B
        action: on_select
        timestamp: 2026-02-23T15:24:43.032Z
        transaction_id: 6db7d975-88a0-45f1-9c32-07c21547d7da
        message_id: 6e445d2c-0d03-47d7-a72e-bd3f61a8645b
        bap_id: sample-bap-id
        bap_uri: https://bap.example.com
        ttl: PT30S
        bpp_id: sample-bpp-id
        bpp_uri: https://bpp.example.com
        country: IND
        city: "*"
        core_version: 1.2.5
      message:
        order:
          provider:
            id: P1
            locations:
              - id: L1
          fulfillments:
            - id: F1
              type: Delivery
              "@ondc/org/provider_name": LSP or Provider Name
              tracking: true
              "@ondc/org/category": Standard Delivery
              "@ondc/org/TAT": P2D
              state:
                descriptor:
                  code: Serviceable
              customer:
                id: CUST_001
                organization:
                  descriptor:
                    name: Sharma Kirana Store
                person:
                  creds:
                    - id: 29AABCU9603R1ZM
                      type: GSTIN
                    - id: AABCU9603R
                      type: PAN
          quote:
            breakup:
              - "@ondc/org/item_id": I1
                "@ondc/org/item_quantity":
                  count: 1
                title: Plain Atta
                "@ondc/org/title_type": item
                price:
                  currency: INR
                  value: "200.00"
                item:
                  quantity:
                    available:
                      count: "99"
                    maximum:
                      count: "99"
                  price:
                    currency: INR
                    value: "200.00"
              - "@ondc/org/item_id": F1
                title: Delivery charges
                "@ondc/org/title_type": delivery
                price:
                  currency: INR
                  value: "00.00"
              - "@ondc/org/item_id": F1
                title: Convenience Fee
                "@ondc/org/title_type": misc
                price:
                  currency: INR
                  value: "00.00"
            price:
              currency: INR
              value: "200.00"
            ttl: P1D
          items:
            - id: I1
              fulfillment_id: F1
    action: on_select
    saved_info: {}
  - action_id: init
    payload:
      context:
        domain: ONDC:RETeB2B
        action: init
        timestamp: 2026-02-23T15:24:43.059Z
        transaction_id: 6db7d975-88a0-45f1-9c32-07c21547d7da
        message_id: fcf8d41c-68b4-4395-a2d6-e227f2797b1c
        bap_id: sample-bap-id
        bap_uri: https://bap.example.com
        ttl: PT30S
        bpp_id: sample-bpp-id
        bpp_uri: https://bpp.example.com
        country: IND
        city: "*"
        core_version: 1.2.5
      message:
        order:
          provider:
            id: P1
            locations:
              - id: L1
          items:
            - id: I1
              fulfillment_id: F1
              quantity:
                count: 1
          billing:
            address:
              building: my building name or house
              city: Mumbai
              state: Maharashtra
              country: IND
              area_code: "400053"
              locality: my street name
              name: my house or door or floor
            phone: "9898989898"
            name: ONDC buyer
            email: nobody@nomail.com
            created_at: 2026-02-23T15:24:38.078Z
            updated_at: 2026-02-23T15:24:38.078Z
          fulfillments:
            - id: F1
              type: Delivery
              end:
                contact:
                  email: nobody@nomail.com
                  phone: "9898989898"
                location:
                  gps: 19.129076,72.825803
                  address:
                    building: mock-building
                    city: mock-city
                    state: mock-state
                    country: IND
                    area_code: "400053"
                    locality: mock-locality
                    name: mock-house-name
          offers: []
    action: init
    saved_info: {}
  - action_id: on_init
    payload:
      context:
        domain: ONDC:RETeB2B
        action: on_init
        timestamp: 2026-02-23T15:24:43.110Z
        transaction_id: 6db7d975-88a0-45f1-9c32-07c21547d7da
        message_id: fcf8d41c-68b4-4395-a2d6-e227f2797b1c
        bap_id: sample-bap-id
        bap_uri: https://bap.example.com
        ttl: PT30S
        bpp_id: sample-bpp-id
        bpp_uri: https://bpp.example.com
        country: IND
        city: "*"
        core_version: 1.2.5
      message:
        order:
          provider:
            id: P1
            locations:
              - id: L1
          items:
            - id: I1
              fulfillment_id: F1
              quantity:
                count: 1
          billing:
            address:
              building: my building name or house
              city: Mumbai
              state: Maharashtra
              country: IND
              area_code: "400053"
              locality: my street name
              name: my house or door or floor
            phone: "9898989898"
            name: ONDC buyer
            email: nobody@nomail.com
            created_at: 2026-02-23T15:24:38.078Z
            updated_at: 2026-02-23T15:24:38.078Z
          fulfillments:
            - id: F1
              type: Delivery
              end:
                contact:
                  email: nobody@nomail.com
                  phone: "9898989898"
                location:
                  gps: 19.129076,72.825803
                  address:
                    building: mock-building
                    city: mock-city
                    state: mock-state
                    country: IND
                    area_code: "400053"
                    locality: mock-locality
                    name: mock-house-name
              tracking: true
          quote:
            breakup:
              - "@ondc/org/item_id": I1
                "@ondc/org/item_quantity":
                  count: 1
                title: Plain Atta
                "@ondc/org/title_type": item
                price:
                  currency: INR
                  value: "200.00"
                item:
                  price:
                    currency: INR
                    value: "200.00"
              - "@ondc/org/item_id": F1
                title: Delivery charges
                "@ondc/org/title_type": delivery
                price:
                  currency: INR
                  value: "00.00"
              - "@ondc/org/item_id": F1
                title: Convenience Fee
                "@ondc/org/title_type": misc
                price:
                  currency: INR
                  value: "00.00"
            price:
              currency: INR
              value: "200.00"
            ttl: P1D
          payment:
            "@ondc/org/buyer_app_finder_fee_type": percent
            "@ondc/org/buyer_app_finder_fee_amount": "3"
            "@ondc/org/settlement_details":
              - settlement_counterparty: seller-app
                settlement_phase: sale-amount
                settlement_type: neft
                beneficiary_name: xxxx
                settlement_bank_account_no: XXXX
                settlement_ifsc_code: XXXX
                bank_name: XXXX
                branch_name: XXXX
          tags:
            - code: bpp_terms
              list:
                - code: np_type
                  value: MSN
                - code: tax_number
                  value: 00ABCCH7409R1ZZ
                - code: provider_tax_number
                  value: ABCDE1234F
    action: on_init
    saved_info: {}
  - action_id: confirm
    payload:
      context:
        domain: ONDC:RETeB2B
        action: confirm
        timestamp: 2026-02-23T15:24:43.138Z
        transaction_id: 6db7d975-88a0-45f1-9c32-07c21547d7da
        message_id: 43508b15-3cf9-48e0-b0ae-2f9c5558f555
        bap_id: sample-bap-id
        bap_uri: https://bap.example.com
        ttl: PT30S
        bpp_id: sample-bpp-id
        bpp_uri: https://bpp.example.com
        country: IND
        city: "*"
        core_version: 1.2.5
      message:
        order:
          id: "936334"
          state: Created
          billing:
            address:
              building: my building name or house
              city: Mumbai
              state: Maharashtra
              country: IND
              area_code: "400053"
              locality: my street name
              name: my house or door or floor
            phone: "9898989898"
            name: ONDC buyer
            email: nobody@nomail.com
            created_at: 2026-02-23T15:24:38.078Z
            updated_at: 2026-02-23T15:24:38.078Z
          items:
            - id: I1
              fulfillment_id: F1
              quantity:
                count: 1
          provider:
            id: P1
            locations:
              - id: L1
          fulfillments:
            - id: F1
              type: Delivery
              end:
                contact:
                  email: nobody@nomail.com
                  phone: "9898989898"
                person:
                  name: mock-person
                location:
                  gps: 19.129076,72.825803
                  address:
                    building: mock-building
                    city: mock-city
                    state: mock-state
                    country: IND
                    area_code: "400053"
                    locality: mock-locality
                    name: mock-house-name
              tracking: true
              "@ondc/org/category": Standard Delivery
              "@ondc/org/TAT": P2D
          payment:
            params:
              amount: "200.00"
              currency: INR
              transaction_id: mock_payment_id_123
            status: PAID
            type: ON-ORDER
            collected_by: BAP
            "@ondc/org/buyer_app_finder_fee_type": percent
            "@ondc/org/buyer_app_finder_fee_amount": "3.0"
            "@ondc/org/settlement_basis": delivery
            "@ondc/org/settlement_window": P1D
            "@ondc/org/withholding_amount": "00.00"
            "@ondc/org/settlement_details":
              - settlement_counterparty: seller-app
                settlement_phase: sale-amount
                settlement_type: neft
                beneficiary_name: xxxx
                settlement_bank_account_no: xxxx
                settlement_ifsc_code: xxxx
                bank_name: xxxx
                branch_name: xxxx
          quote:
            breakup:
              - "@ondc/org/item_id": I1
                "@ondc/org/item_quantity":
                  count: 1
                title: Plain Atta
                "@ondc/org/title_type": item
                price:
                  currency: INR
                  value: "200.00"
                item:
                  price:
                    currency: INR
                    value: "200.00"
              - "@ondc/org/item_id": F1
                title: Delivery charges
                "@ondc/org/title_type": delivery
                price:
                  currency: INR
                  value: "00.00"
              - "@ondc/org/item_id": F1
                title: Convenience Fee
                "@ondc/org/title_type": misc
                price:
                  currency: INR
                  value: "00.00"
            price:
              currency: INR
              value: "200.00"
            ttl: P1D
          tags:
            - code: bpp_terms
            - code: bap_terms
              list:
                - code: accept_bpp_terms
                  value: Y
                - code: static_terms
                  value: https://github.com/ONDC-Official/NP-Static-Terms/buyerNP_BNP/1.0/tc.pdf
                - code: tax_number
                  value: 00ABCCH7409R1ZZ
          created_at: 2026-02-23T15:24:43.141Z
          updated_at: 2026-02-23T15:24:43.141Z
    action: confirm
    saved_info: {}
  - action_id: on_confirm
    payload:
      context:
        domain: ONDC:RETeB2B
        action: on_confirm
        timestamp: 2026-02-23T15:24:43.172Z
        transaction_id: 6db7d975-88a0-45f1-9c32-07c21547d7da
        message_id: 43508b15-3cf9-48e0-b0ae-2f9c5558f555
        bap_id: sample-bap-id
        bap_uri: https://bap.example.com
        ttl: PT30S
        bpp_id: sample-bpp-id
        bpp_uri: https://bpp.example.com
        country: IND
        city: "*"
        core_version: 1.2.5
      message:
        order:
          id: "936334"
          state: Created
          provider:
            id: P1
            locations:
              - id: L1
          items:
            - id: I1
              fulfillment_id: F1
              quantity:
                count: 1
          billing:
            address:
              building: my building name or house
              city: Mumbai
              state: Maharashtra
              country: IND
              area_code: "400053"
              locality: my street name
              name: my house or door or floor
            phone: "9898989898"
            name: ONDC buyer
            email: nobody@nomail.com
            created_at: 2026-02-23T15:24:38.078Z
            updated_at: 2026-02-23T15:24:38.078Z
          fulfillments:
            - id: F1
              type: Delivery
              tracking: true
              state:
                descriptor:
                  code: Pending
              "@ondc/org/TAT": P2D
              "@ondc/org/provider_name": Store 1
              start:
                location:
                  id: L1
                  descriptor:
                    name: Store 1
                  gps: 19.129076,72.825803
                  address:
                    street: 1 & 2,AMAR JYOTI CHS.BLDG.,OPP.NAND KRIPA HALL
                    locality: ANDHERI FOUR BUNGLOW AMAR JYOTI CHS
                    city: mock-seller-city
                    state: mock-state
                    area_code: "400053"
                contact:
                  phone: "9594663710"
                  email: nobody@nomail.com
              end:
                contact:
                  email: nobody@nomail.com
                  phone: "9898989898"
                person:
                  name: mock-person
                location:
                  gps: 19.129076,72.825803
                  address:
                    building: mock-building
                    city: mock-city
                    state: mock-state
                    country: IND
                    area_code: "400053"
                    locality: mock-locality
                    name: mock-house-name
          quote:
            breakup:
              - "@ondc/org/item_id": I1
                "@ondc/org/item_quantity":
                  count: 1
                title: Plain Atta
                "@ondc/org/title_type": item
                price:
                  currency: INR
                  value: "200.00"
                item:
                  price:
                    currency: INR
                    value: "200.00"
              - "@ondc/org/item_id": F1
                title: Delivery charges
                "@ondc/org/title_type": delivery
                price:
                  currency: INR
                  value: "00.00"
              - "@ondc/org/item_id": F1
                title: Convenience Fee
                "@ondc/org/title_type": misc
                price:
                  currency: INR
                  value: "00.00"
            price:
              currency: INR
              value: "200.00"
            ttl: P1D
          payment:
            params:
              amount: "200.00"
              currency: INR
              transaction_id: mock_payment_id_123
            status: PAID
            type: ON-ORDER
            collected_by: BAP
            "@ondc/org/buyer_app_finder_fee_type": percent
            "@ondc/org/buyer_app_finder_fee_amount": "3.0"
            "@ondc/org/settlement_basis": delivery
            "@ondc/org/settlement_window": P1D
            "@ondc/org/withholding_amount": "00.00"
            "@ondc/org/settlement_details":
              - settlement_counterparty: seller-app
                settlement_phase: sale-amount
                settlement_type: neft
                beneficiary_name: xxxx
                settlement_bank_account_no: xxxx
                settlement_ifsc_code: xxxx
                bank_name: xxxx
                branch_name: xxxx
          tags:
            - code: bpp_terms
              list:
                - code: np_type
                  value: MSN
                - code: tax_number
                  value: 00ABCCH7409R1ZZ
                - code: provider_tax_number
                  value: ABCDE1234F
                - code: accept_bap_terms
                  value: Y
            - code: bap_terms
              list:
                - code: static_terms
                  value: https://github.com/ONDC-Official/protocol-network-extension/discussions/79
                - code: tax_number
                  value: 00ABCCH7409R1ZZ
          created_at: 2026-02-23T15:24:43.141Z
          updated_at: 2026-02-23T15:24:43.180Z
    action: on_confirm
    saved_info: {}
  - action_id: on_update_part_cancel
    payload:
      context:
        domain: ONDC:RETeB2B
        action: on_update
        timestamp: 2026-02-23T15:24:43.205Z
        transaction_id: 6db7d975-88a0-45f1-9c32-07c21547d7da
        message_id: 05eb7d45-a640-4258-ba5b-e267411fd8a8
        bap_id: sample-bap-id
        bap_uri: https://bap.example.com
        ttl: PT30S
        bpp_id: sample-bpp-id
        bpp_uri: https://bpp.example.com
        country: IND
        city: "*"
        core_version: 1.2.5
      message:
        order:
          id: "936334"
          state: Accepted
          provider:
            id: P1
            locations:
              - id: L1
          items:
            - id: I1
              fulfillment_id: F1
              quantity:
                count: 0
            - id: I1
              fulfillment_id: part_cancel_id_12391
              quantity:
                count: 1
          billing:
            address:
              building: my building name or house
              city: Mumbai
              state: Maharashtra
              country: IND
              area_code: "400053"
              locality: my street name
              name: my house or door or floor
            phone: "9898989898"
            name: ONDC buyer
            email: nobody@nomail.com
            created_at: 2026-02-23T15:24:38.078Z
            updated_at: 2026-02-23T15:24:38.078Z
          fulfillments:
            - id: F1
              type: Delivery
              tracking: true
              state:
                descriptor:
                  code: Pending
              "@ondc/org/TAT": P2D
              "@ondc/org/provider_name": Store 1
              start:
                location:
                  id: L1
                  descriptor:
                    name: Store 1
                  gps: 19.129076,72.825803
                  address:
                    street: 1 & 2,AMAR JYOTI CHS.BLDG.,OPP.NAND KRIPA HALL
                    locality: ANDHERI FOUR BUNGLOW AMAR JYOTI CHS
                    city: mock-seller-city
                    state: mock-state
                    area_code: "400053"
                contact:
                  phone: "9594663710"
                  email: nobody@nomail.com
              end:
                contact:
                  email: nobody@nomail.com
                  phone: "9898989898"
                person:
                  name: mock-person
                location:
                  gps: 19.129076,72.825803
                  address:
                    building: mock-building
                    city: mock-city
                    state: mock-state
                    country: IND
                    area_code: "400053"
                    locality: mock-locality
                    name: mock-house-name
            - id: part_cancel_id_12391
              type: Cancel
              state:
                descriptor:
                  code: Cancelled
              tags:
                - code: cancel_request
                  list:
                    - code: reason_id
                      value: "002"
                    - code: initiated_by
                      value: sample-bpp-id
                - code: quote_trail
                  list:
                    - code: type
                      value: item
                    - code: id
                      value: I1
                    - code: currency
                      value: INR
                    - code: value
                      value: "-200.00"
          quote:
            breakup:
              - "@ondc/org/item_id": I1
                "@ondc/org/item_quantity":
                  count: 0
                title: Plain Atta
                "@ondc/org/title_type": item
                price:
                  currency: INR
                  value: "0.00"
                item:
                  quantity:
                    available:
                      count: "99"
                    maximum:
                      count: "99"
                  price:
                    currency: INR
                    value: "200.00"
              - "@ondc/org/item_id": F1
                title: Delivery charges
                "@ondc/org/title_type": delivery
                price:
                  currency: INR
                  value: "00.00"
              - "@ondc/org/item_id": F1
                title: Convenience Fee
                "@ondc/org/title_type": misc
                price:
                  currency: INR
                  value: "00.00"
            price:
              currency: INR
              value: "0.00"
            ttl: P1D
          payment:
            params:
              amount: "200.00"
              currency: INR
              transaction_id: mock_payment_id_123
            status: PAID
            type: ON-ORDER
            collected_by: BAP
            "@ondc/org/buyer_app_finder_fee_type": percent
            "@ondc/org/buyer_app_finder_fee_amount": "3.0"
            "@ondc/org/settlement_basis": delivery
            "@ondc/org/settlement_window": P1D
            "@ondc/org/withholding_amount": "00.00"
            "@ondc/org/settlement_details":
              - settlement_counterparty: seller-app
                settlement_phase: sale-amount
                settlement_type: neft
                beneficiary_name: xxxx
                settlement_bank_account_no: xxxx
                settlement_ifsc_code: xxxx
                bank_name: xxxx
                branch_name: xxxx
          created_at: 2026-02-23T15:24:43.141Z
          updated_at: 2026-02-23T15:24:43.210Z
    action: on_update
    saved_info: {}
  - action_id: update_settlement_trail
    payload:
      context:
        domain: ONDC:RETeB2B
        action: update
        timestamp: 2026-02-23T15:24:43.238Z
        transaction_id: 6db7d975-88a0-45f1-9c32-07c21547d7da
        message_id: 4f0d10be-c8c5-40a0-be33-dde05e07a2a9
        bap_id: sample-bap-id
        bap_uri: https://bap.example.com
        ttl: PT30S
        bpp_id: sample-bpp-id
        bpp_uri: https://bpp.example.com
        country: IND
        city: "*"
        core_version: 1.2.5
      message:
        update_target: payment
        order:
          id: "936334"
          fulfillments:
            - id: part_cancel_id_12391
              type: Cancel
          payment:
            "@ondc/org/settlement_details":
              - settlement_counterparty: buyer
                settlement_phase: refund
                settlement_type: netbanking
                settlement_amount: "200"
                settlement_timestamp: 2026-02-23T15:24:43.244Z
    action: update
    saved_info: {}
  - action_id: on_status_packed
    payload:
      context:
        domain: ONDC:RETeB2B
        action: on_status
        timestamp: 2026-02-23T15:24:43.269Z
        transaction_id: 6db7d975-88a0-45f1-9c32-07c21547d7da
        message_id: 5ede5f38-d6ee-4062-8fff-89b7bdbd9071
        bap_id: sample-bap-id
        bap_uri: https://bap.example.com
        ttl: PT30S
        bpp_id: sample-bpp-id
        bpp_uri: https://bpp.example.com
        country: IND
        city: "*"
        core_version: 1.2.5
      message:
        order:
          id: "936334"
          state: In-progress
          provider:
            id: P1
            locations:
              - id: L1
          items:
            - id: I1
              fulfillment_id: F1
              quantity:
                count: 0
            - id: I1
              fulfillment_id: part_cancel_id_12391
              quantity:
                count: 1
          billing:
            address:
              building: my building name or house
              city: Mumbai
              state: Maharashtra
              country: IND
              area_code: "400053"
              locality: my street name
              name: my house or door or floor
            phone: "9898989898"
            name: ONDC buyer
            email: nobody@nomail.com
            created_at: 2026-02-23T15:24:38.078Z
            updated_at: 2026-02-23T15:24:38.078Z
          fulfillments:
            - id: F1
              type: Delivery
              tracking: true
              state:
                descriptor:
                  code: Packed
              "@ondc/org/TAT": P2D
              "@ondc/org/provider_name": Store 1
              start:
                location:
                  id: L1
                  descriptor:
                    name: Store 1
                  gps: 19.129076,72.825803
                  address:
                    street: 1 & 2,AMAR JYOTI CHS.BLDG.,OPP.NAND KRIPA HALL
                    locality: ANDHERI FOUR BUNGLOW AMAR JYOTI CHS
                    city: mock-seller-city
                    state: mock-state
                    area_code: "400053"
                contact:
                  phone: "9594663710"
                  email: nobody@nomail.com
                time:
                  range:
                    start: 2026-02-23T15:34:43.288Z
                    end: 2026-02-23T15:44:43.288Z
              end:
                contact:
                  email: nobody@nomail.com
                  phone: "9898989898"
                person:
                  name: mock-person
                location:
                  gps: 19.129076,72.825803
                  address:
                    building: mock-building
                    city: mock-city
                    state: mock-state
                    country: IND
                    area_code: "400053"
                    locality: mock-locality
                    name: mock-house-name
                time:
                  range:
                    start: 2026-02-23T15:44:43.288Z
                    end: 2026-02-25T15:34:43.288Z
              tags:
                - code: routing
                  list:
                    - code: type
                      value: P2H2P
                - code: tracking
                  list:
                    - code: gps_enabled
                      value: no
                    - code: url_enabled
                      value: yes
                    - code: url
                      value: https://sellerNP.com/ondc/tracking_url
            - id: part_cancel_id_12391
              type: Cancel
              state:
                descriptor:
                  code: Cancelled
              tags:
                - code: cancel_request
                  list:
                    - code: reason_id
                      value: "002"
                    - code: initiated_by
                      value: sample-bpp-id
                - code: quote_trail
                  list:
                    - code: type
                      value: item
                    - code: id
                      value: I1
                    - code: currency
                      value: INR
                    - code: value
                      value: "-200.00"
          quote:
            breakup:
              - "@ondc/org/item_id": I1
                "@ondc/org/item_quantity":
                  count: 0
                title: Plain Atta
                "@ondc/org/title_type": item
                price:
                  currency: INR
                  value: "0.00"
                item:
                  quantity:
                    available:
                      count: "99"
                    maximum:
                      count: "99"
                  price:
                    currency: INR
                    value: "200.00"
              - "@ondc/org/item_id": F1
                title: Delivery charges
                "@ondc/org/title_type": delivery
                price:
                  currency: INR
                  value: "00.00"
              - "@ondc/org/item_id": F1
                title: Convenience Fee
                "@ondc/org/title_type": misc
                price:
                  currency: INR
                  value: "00.00"
            price:
              currency: INR
              value: "0.00"
            ttl: P1D
          payment:
            params:
              amount: "200.00"
              currency: INR
              transaction_id: mock_payment_id_123
            status: PAID
            type: ON-ORDER
            collected_by: BAP
            "@ondc/org/buyer_app_finder_fee_type": percent
            "@ondc/org/buyer_app_finder_fee_amount": "3.0"
            "@ondc/org/settlement_basis": delivery
            "@ondc/org/settlement_window": P1D
            "@ondc/org/withholding_amount": "00.00"
            "@ondc/org/settlement_details":
              - settlement_counterparty: seller-app
                settlement_phase: sale-amount
                settlement_type: neft
                beneficiary_name: xxxx
                settlement_bank_account_no: xxxx
                settlement_ifsc_code: xxxx
                bank_name: xxxx
                branch_name: xxxx
          created_at: 2026-02-23T15:24:43.141Z
          updated_at: 2026-02-23T15:24:43.288Z
    action: on_status
    saved_info: {}
validationLib: ""
helperLib: ""
